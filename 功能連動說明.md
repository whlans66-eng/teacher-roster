# 🔄 功能連動說明 - 您可以看到的實際效果

## 📺 打開 demo-integrated.html 查看完整演示

我創建了一個視覺化演示頁面，展示所有功能如何連動！

## 🎯 在您的美觀介面中，功能如何連動

### 場景 1：新增課程時

```
用戶操作：點擊「➕ 新增課程」→ 填寫資料 → 確認
                    ↓
第1步：檢查衝堂 checkTeacherConflict()
                    ↓
        有衝突？ → 顯示警告對話框 → 用戶選擇
                    ↓
第2步：新增到派課 teacher.courses.push(newCourse)
                    ↓
第3步：同步到行事曆 calendarEvents.push({...})
                    ↓
第4步：更新所有視圖
    - 課程時間軸 ✅
    - 統計卡片 ✅
    - 本週課表 ✅  ← 側邊欄立即顯示
    - 行事曆 ✅    ← 月曆上立即顯示
                    ↓
第5步：保存數據 localStorage
```

### 場景 2：切換到行事曆視圖

```
用戶操作：點擊側邊欄「📅 行事曆」按鈕
                    ↓
    系統自動：switchView('calendar')
                    ↓
    行事曆顯示所有事件：
    - 藍色：正課（從派課自動同步） ✅
    - 黃色：補課（從派課自動同步） ✅
    - 紫色：實驗課（從派課自動同步） ✅
    - 綠色：實作課（從派課自動同步） ✅
    - 粉色：專題（從派課自動同步） ✅
```

### 場景 3：查看老師課表

```
用戶操作：選擇「王小明老師」
                    ↓
側邊欄「本週課表」區塊自動更新：
                    ↓
週一 15日
  09:00-11:00 高等數學    ← 從派課讀取
  14:00-16:00 物理實驗    ← 從派課讀取
週三 17日
  10:00-12:00 微積分      ← 從派課讀取
週五 19日
  15:00-17:00 機率論      ← 從派課讀取
```

### 場景 4：嘗試衝堂派課

```
步驟 1：王小明老師已有課程
    2024-01-15 09:00-11:00 高等數學
                    ↓
步驟 2：嘗試再派一門課
    2024-01-15 10:00-12:00 物理實驗
                    ↓
步驟 3：系統自動檢測
    checkTeacherConflict() 發現時間重疊
                    ↓
步驟 4：彈出警告對話框
    ⚠️ 衝堂警告！

    該老師在此時段已有以下課程：
    - 高等數學 (09:00-11:00) [正課] 來源：派課管理

    是否仍要繼續派課？
                    ↓
用戶選擇：[取消] 或 [繼續派課]
```

## 🔧 實際代碼運作方式

### 在您的 addCourse 函數中

```javascript
function addCourse(courseData) {
    const teacher = teachersData[currentTeacher];

    // 🆕 第1步：衝堂檢查（新增）
    const conflicts = checkTeacherConflict(
        currentTeacher,
        courseData.date,
        courseData.startTime,
        courseData.endTime
    );

    if (conflicts.length > 0) {
        // 顯示衝堂警告
        const confirmMessage = `⚠️ 衝堂警告！\n\n...`;
        if (!confirm(confirmMessage)) {
            return; // 用戶取消
        }
    }

    // 第2步：原有功能 - 新增課程
    const newCourse = {
        date: courseData.date,
        time: `${courseData.startTime}-${courseData.endTime}`,
        subject: courseData.name,
        type: courseData.type,
        id: Date.now()
    };
    teacher.courses.push(newCourse);

    // 🆕 第3步：同步到行事曆（新增）
    calendarEvents.push({
        id: newCourse.id,
        date: courseData.date,
        title: `${courseData.name} - ${teacher.name}`,
        time: `${courseData.startTime}-${courseData.endTime}`,
        teacherId: currentTeacher,
        type: courseData.type,
        color: getCourseTypeColor(courseData.type),
        courseId: newCourse.id  // 重要：標記為派課事件
    });

    // 第4步：保存
    saveData();  // 原有
    saveCalendarEvents();  // 🆕 新增

    // 第5步：更新視圖
    updateAllViews();  // 原有，但現在會包含行事曆和本週課表
}
```

### 衝堂檢查函數

```javascript
function checkTeacherConflict(teacherId, date, startTime, endTime) {
    const conflicts = [];

    // 將時間轉為分鐘數比較
    const timeToMinutes = (timeStr) => {
        const [hours, minutes] = timeStr.split(':').map(Number);
        return hours * 60 + minutes;
    };

    const newStart = timeToMinutes(startTime);
    const newEnd = timeToMinutes(endTime);

    // 檢查派課管理中的課程
    const teacher = teachersData[teacherId];
    teacher.courses.forEach(course => {
        if (course.date === date) {
            const [courseStart, courseEnd] = course.time.split('-');
            const existingStart = timeToMinutes(courseStart);
            const existingEnd = timeToMinutes(courseEnd);

            // 時間重疊檢查
            if (!(newEnd <= existingStart || newStart >= existingEnd)) {
                conflicts.push({
                    name: course.subject,
                    time: course.time,
                    type: course.type,
                    source: '派課管理'
                });
            }
        }
    });

    // 也檢查行事曆中的事件
    calendarEvents.forEach(event => {
        if (event.teacherId === teacherId && event.date === date && event.time) {
            // ... 類似邏輯
        }
    });

    return conflicts;
}
```

## 💡 為什麼您看不到連動？

因為我提供的是**模組化方案**：

1. **您的HTML** - 完整的美觀介面和功能
2. **integrated-features.js** - 擴展功能模組
3. **需要整合** - 將兩者連接起來

## ✅ 如何看到實際連動效果

### 方法 1：使用演示文件（最快）

```bash
# 打開瀏覽器查看
open demo-integrated.html
```

這個文件視覺化展示所有連動流程

### 方法 2：整合到您的HTML（3步驟）

#### 步驟 1：添加行事曆視圖HTML

在您的主內容區添加（儀表板視圖之後）：

```html
<!-- 行事曆視圖 -->
<div id="calendarView" class="page-view">
    <div class="glass-effect rounded-2xl p-6 card-hover mb-8">
        <!-- 完整結構請參考 QUICK-START.md -->
    </div>
</div>
```

#### 步驟 2：添加側邊欄導航

在側邊欄Logo下方添加：

```html
<!-- 導航選單 -->
<div class="mb-6 space-y-2">
    <button onclick="switchView('dashboard')" id="nav-dashboard"
            class="nav-btn active w-full text-left text-white flex items-center space-x-2">
        <span>📊</span><span>儀表板</span>
    </button>
    <button onclick="switchView('calendar')" id="nav-calendar"
            class="nav-btn w-full text-left text-white flex items-center space-x-2">
        <span>📅</span><span>行事曆</span>
    </button>
</div>
```

#### 步驟 3：引入功能模組

在 `</body>` 之前添加：

```html
<script src="integrated-features.js"></script>
```

### 完成！

現在：
1. 新增課程 → 自動檢查衝堂 → 自動同步到行事曆 ✅
2. 切換到行事曆視圖 → 看到所有派課 ✅
3. 側邊欄本週課表 → 自動更新 ✅
4. 刪除課程 → 自動清理行事曆 ✅

## 🎬 實際測試

整合完成後，試試這樣測試：

1. **測試衝堂檢查**
   ```
   選擇王小明老師 → 新增課程：
   - 2024-01-15 09:00-11:00 高等數學

   再次新增課程：
   - 2024-01-15 10:00-12:00 物理實驗

   預期：看到衝堂警告對話框 ⚠️
   ```

2. **測試自動同步**
   ```
   新增任意課程 → 點擊側邊欄「📅 行事曆」按鈕

   預期：在行事曆上看到剛才的課程，
         使用對應課程類型的顏色
   ```

3. **測試本週課表**
   ```
   選擇有本週課程的老師

   預期：側邊欄「本週課表」區塊顯示
         該老師本週所有課程
   ```

## 📞 需要幫助？

- 打開 `demo-integrated.html` 查看視覺化演示
- 閱讀 `QUICK-START.md` 查看整合步驟
- 閱讀 `HOW-TO-INTEGRATE.md` 查看詳細文檔

所有功能都已準備好，只需要整合即可看到完整連動效果！ 🎉
