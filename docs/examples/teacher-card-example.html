<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ•™å¸«å¡ç‰‡ç¯„ä¾‹ - è§’è‰²æ¬Šé™å·®ç•°åŒ–</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    /* è§’è‰²åˆ‡æ›å™¨ */
    .role-switcher {
      background: white;
      padding: 20px;
      border-radius: 8px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .role-switcher h2 {
      margin-bottom: 15px;
      color: #333;
    }

    .role-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .role-btn {
      padding: 10px 20px;
      border: 2px solid #ddd;
      background: white;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }

    .role-btn:hover {
      background: #f0f0f0;
    }

    .role-btn.active {
      background: #007bff;
      color: white;
      border-color: #007bff;
    }

    .current-role-info {
      margin-top: 15px;
      padding: 10px;
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      border-radius: 4px;
    }

    /* æ•™å¸«å¡ç‰‡ç¶²æ ¼ */
    .teachers-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    /* æ•™å¸«å¡ç‰‡ */
    .teacher-card {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .teacher-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }

    .teacher-photo {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 15px;
      background: #ddd;
    }

    .teacher-name {
      font-size: 20px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }

    .teacher-type {
      display: inline-block;
      padding: 4px 12px;
      background: #e0e0e0;
      border-radius: 12px;
      font-size: 12px;
      color: #666;
      margin-bottom: 10px;
    }

    .teacher-type.full-time { background: #c8e6c9; color: #2e7d32; }
    .teacher-type.part-time { background: #fff9c4; color: #f57f17; }
    .teacher-type.adjunct { background: #bbdefb; color: #1565c0; }

    .teacher-email {
      font-size: 14px;
      color: #666;
      margin-bottom: 10px;
    }

    .teacher-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      margin-bottom: 15px;
    }

    .tag {
      padding: 4px 10px;
      background: #f0f0f0;
      border-radius: 12px;
      font-size: 12px;
      color: #555;
    }

    .teacher-actions {
      display: flex;
      gap: 8px;
      margin-top: 15px;
      padding-top: 15px;
      border-top: 1px solid #eee;
    }

    .btn {
      flex: 1;
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #007bff;
      color: white;
    }

    .btn-primary:hover {
      background: #0056b3;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn-secondary:hover {
      background: #545b62;
    }

    .btn-danger {
      background: #dc3545;
      color: white;
    }

    .btn-danger:hover {
      background: #c82333;
    }

    .btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* æ¬Šé™æç¤º */
    .permission-hint {
      background: #fff3cd;
      border: 1px solid #ffc107;
      padding: 10px;
      border-radius: 4px;
      font-size: 12px;
      color: #856404;
      text-align: center;
    }

    /* éš±è—å…ƒç´  */
    [data-require-role]:not([data-role-granted]) {
      display: none !important;
    }

    .blur-for-visitor {
      filter: blur(4px);
      user-select: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- è§’è‰²åˆ‡æ›å™¨ (åƒ…ä¾›ç¤ºç¯„) -->
    <div class="role-switcher">
      <h2>ğŸ­ è§’è‰²åˆ‡æ›å™¨ï¼ˆç¤ºç¯„ç”¨ï¼‰</h2>
      <div class="role-buttons">
        <button class="role-btn" onclick="switchRole('visitor')">ğŸ‘¤ è¨ªå®¢</button>
        <button class="role-btn" onclick="switchRole('student')">ğŸ“ å­¸å“¡</button>
        <button class="role-btn" onclick="switchRole('teacher')">ğŸ‘¨â€ğŸ« æ•™å¸«</button>
        <button class="role-btn" onclick="switchRole('admin')">âš™ï¸ ç®¡ç†è€…</button>
      </div>
      <div class="current-role-info">
        <strong>ç•¶å‰è§’è‰²ï¼š</strong><span id="current-role-display">è¨ªå®¢</span>
        <span id="current-user-display"></span>
      </div>
    </div>

    <!-- æ•™å¸«å¡ç‰‡åˆ—è¡¨ -->
    <div class="teachers-grid" id="teachers-container">
      <!-- æ•™å¸«å¡ç‰‡æœƒç”± JavaScript å‹•æ…‹ç”Ÿæˆ -->
    </div>
  </div>

  <!-- å¼•å…¥æ¬Šé™æ§åˆ¶è¼”åŠ©å‡½æ•¸ -->
  <script src="auth-helpers.js"></script>

  <script>
    // ============================================
    // ç¤ºç¯„è³‡æ–™
    // ============================================

    const DEMO_TEACHERS = [
      {
        id: '1',
        userId: 'teacher-001',
        name: 'ç‹å¤§æ˜',
        email: 'wang@example.com',
        teacherType: 'full-time',
        teacherTypeLabel: 'å°ˆä»»',
        workLocation: 'å°åŒ—æ ¡å€',
        photoUrl: 'https://via.placeholder.com/300x200?text=ç‹å¤§æ˜',
        tags: ['èˆ¹èˆ¶æ“ç¸±', 'GMDSS', 'æµ·äº‹è‹±æ–‡', 'èˆªæµ·å­¸', 'æ°£è±¡å­¸'],
        experiences: ['é æ´‹èˆ¹é•· 10å¹´', 'ç”²ç´šèˆ¹å“¡è¨“ç·´ä¸­å¿ƒæ•™å®˜'],
        certificates: ['èˆ¹é•·åŸ·ç…§', 'ä¸€ç­‰ç®¡è¼ª', 'GMDSSè­‰æ›¸']
      },
      {
        id: '2',
        userId: 'teacher-002',
        name: 'æå°è¯',
        email: 'lee@example.com',
        teacherType: 'part-time',
        teacherTypeLabel: 'å…¼ä»»',
        workLocation: 'é«˜é›„æ ¡å€',
        photoUrl: 'https://via.placeholder.com/300x200?text=æå°è¯',
        tags: ['è¼ªæ©Ÿå·¥ç¨‹', 'æŸ´æ²¹æ©Ÿ', 'èˆ¹èˆ¶è‡ªå‹•åŒ–'],
        experiences: ['è¼ªæ©Ÿé•· 15å¹´'],
        certificates: ['è¼ªæ©Ÿé•·åŸ·ç…§', 'äºŒç­‰ç®¡è¼ª']
      },
      {
        id: '3',
        userId: 'teacher-003',
        name: 'å¼µå¿—æ˜',
        email: 'chang@example.com',
        teacherType: 'adjunct',
        teacherTypeLabel: 'å¤–è˜',
        workLocation: 'åŸºéš†æ ¡å€',
        photoUrl: 'https://via.placeholder.com/300x200?text=å¼µå¿—æ˜',
        tags: ['æµ·äº‹æ³•è¦', 'èˆªé‹ç®¡ç†', 'æµ·å•†æ³•'],
        experiences: ['æµ·äº‹å¾‹å¸« 8å¹´'],
        certificates: ['å¾‹å¸«åŸ·ç…§', 'æµ·äº‹ä»²è£äºº']
      }
    ];

    // ============================================
    // è§’è‰²åˆ‡æ›ï¼ˆåƒ…ä¾›ç¤ºç¯„ï¼‰
    // ============================================

    function switchRole(role) {
      // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
      document.querySelectorAll('.role-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      event.target.classList.add('active');

      // æ¨¡æ“¬ä¸åŒç”¨æˆ¶
      const demoUsers = {
        visitor: null,
        student: {
          id: 'student-001',
          username: 'student001',
          email: 'student@example.com',
          full_name: 'å­¸å“¡å¼µä¸‰',
          role: 'student',
          permissions: ['teacher.view', 'course.view']
        },
        teacher: {
          id: 'teacher-001',
          username: 'teacher001',
          email: 'wang@example.com',
          full_name: 'ç‹å¤§æ˜',
          role: 'teacher',
          permissions: ['teacher.view', 'teacher.update_own', 'course.view']
        },
        admin: {
          id: 'admin-001',
          username: 'admin',
          email: 'admin@example.com',
          full_name: 'ç®¡ç†å“¡',
          role: 'admin',
          permissions: ['*']
        }
      };

      if (role === 'visitor') {
        clearAuthState();
      } else {
        setAuthState(demoUsers[role], 'demo-token-' + role);
      }

      // æ›´æ–°é¡¯ç¤º
      updateRoleDisplay();
      renderTeachers();
    }

    function updateRoleDisplay() {
      const roleNames = {
        'visitor': 'ğŸ‘¤ è¨ªå®¢',
        'student': 'ğŸ“ å­¸å“¡',
        'teacher': 'ğŸ‘¨â€ğŸ« æ•™å¸«',
        'admin': 'âš™ï¸ ç®¡ç†è€…'
      };

      const currentRole = getCurrentRole();
      document.getElementById('current-role-display').textContent = roleNames[currentRole];

      const userDisplay = document.getElementById('current-user-display');
      if (AuthState.user) {
        userDisplay.textContent = ` | ç”¨æˆ¶ï¼š${AuthState.user.full_name}`;
      } else {
        userDisplay.textContent = '';
      }
    }

    // ============================================
    // æ¸²æŸ“æ•™å¸«å¡ç‰‡
    // ============================================

    function renderTeachers() {
      const container = document.getElementById('teachers-container');
      const currentRole = getCurrentRole();
      const currentUserId = getCurrentUserId();

      container.innerHTML = DEMO_TEACHERS.map(teacher => {
        return renderTeacherCard(teacher, currentRole, currentUserId);
      }).join('');
    }

    function renderTeacherCard(teacher, role, currentUserId) {
      const isOwnProfile = currentUserId === teacher.userId;
      const teacherTypeClass = teacher.teacherType.replace('_', '-');

      // æ ¹æ“šè§’è‰²æ±ºå®šè¦é¡¯ç¤ºçš„æ¨™ç±¤æ•¸é‡
      const tagsToShow = role === 'visitor' ? teacher.tags.slice(0, 3) : teacher.tags;

      // æ ¹æ“šè§’è‰²æ±ºå®šæ˜¯å¦é¡¯ç¤º email
      const showEmail = role !== 'visitor';
      const emailDisplay = showEmail ? teacher.email : '***@***.com';

      // åˆ¤æ–·æ˜¯å¦å¯ä»¥æŸ¥çœ‹è©³æƒ…
      const canViewDetail = canViewDetails('teacher');

      // åˆ¤æ–·æ˜¯å¦å¯ä»¥ç·¨è¼¯
      const canEditTeacher = canEdit({ type: 'teacher', userId: teacher.userId });

      // åˆ¤æ–·æ˜¯å¦å¯ä»¥åˆªé™¤
      const canDeleteTeacher = canDelete('teacher');

      return `
        <div class="teacher-card">
          <img src="${teacher.photoUrl}" alt="${teacher.name}" class="teacher-photo">

          <h3 class="teacher-name">${teacher.name}</h3>

          <!-- æ•™å¸«é¡å‹ï¼šè¨ªå®¢çœ‹ä¸åˆ° -->
          ${role !== 'visitor' ? `
            <span class="teacher-type ${teacherTypeClass}">
              ${teacher.teacherTypeLabel}
            </span>
          ` : ''}

          <!-- Emailï¼šè¨ªå®¢çœ‹åˆ°æ¨¡ç³Šçš„ -->
          <div class="teacher-email ${role === 'visitor' ? 'blur-for-visitor' : ''}">
            ğŸ“§ ${emailDisplay}
          </div>

          <!-- æ¨™ç±¤ï¼šè¨ªå®¢åªçœ‹åˆ° 3 å€‹ -->
          <div class="teacher-tags">
            ${tagsToShow.map(tag => `<span class="tag">${tag}</span>`).join('')}
            ${role === 'visitor' && teacher.tags.length > 3 ? `
              <span class="tag" style="background: #ffc107; color: #000;">
                +${teacher.tags.length - 3} æ›´å¤š
              </span>
            ` : ''}
          </div>

          <!-- è¨ªå®¢æç¤º -->
          ${role === 'visitor' ? `
            <div class="permission-hint">
              ğŸ”’ ç™»å…¥å¾Œå¯æŸ¥çœ‹å®Œæ•´è³‡æ–™
            </div>
          ` : ''}

          <!-- æ“ä½œæŒ‰éˆ• -->
          <div class="teacher-actions">
            <!-- æŸ¥çœ‹è©³æƒ…ï¼šå­¸å“¡ä»¥ä¸Šå¯è¦‹ -->
            ${canViewDetail ? `
              <button class="btn btn-primary" onclick="viewTeacherDetails('${teacher.id}')">
                æŸ¥çœ‹è©³æƒ…
              </button>
            ` : ''}

            <!-- ç·¨è¼¯ï¼šç®¡ç†è€…æˆ–æœ¬äººå¯è¦‹ -->
            ${canEditTeacher ? `
              <button class="btn btn-secondary" onclick="editTeacher('${teacher.id}')">
                ${isOwnProfile ? 'ç·¨è¼¯æˆ‘çš„è³‡æ–™' : 'ç·¨è¼¯'}
              </button>
            ` : ''}

            <!-- åˆªé™¤ï¼šåƒ…ç®¡ç†è€…å¯è¦‹ -->
            ${canDeleteTeacher ? `
              <button class="btn btn-danger" onclick="deleteTeacher('${teacher.id}')">
                åˆªé™¤
              </button>
            ` : ''}
          </div>

          <!-- æœ¬äººæ¨™è¨˜ -->
          ${isOwnProfile ? `
            <div style="margin-top: 10px; text-align: center; color: #28a745; font-weight: bold;">
              âœ“ é€™æ˜¯æ‚¨çš„è³‡æ–™
            </div>
          ` : ''}
        </div>
      `;
    }

    // ============================================
    // æŒ‰éˆ•äº‹ä»¶è™•ç†
    // ============================================

    function viewTeacherDetails(teacherId) {
      const teacher = DEMO_TEACHERS.find(t => t.id === teacherId);
      const role = getCurrentRole();

      if (role === 'visitor') {
        alert('è«‹å…ˆç™»å…¥ä»¥æŸ¥çœ‹æ•™å¸«è©³ç´°è³‡æ–™');
        return;
      }

      // é¡¯ç¤ºè©³ç´°è³‡è¨Š
      let details = `
æ•™å¸«è©³ç´°è³‡æ–™
================

å§“åï¼š${teacher.name}
Emailï¼š${teacher.email}
é¡å‹ï¼š${teacher.teacherTypeLabel}
å·¥ä½œåœ°é»ï¼š${teacher.workLocation}

å°ˆé•·é ˜åŸŸï¼š
${teacher.tags.join(', ')}

æ•™å­¸ç¶“æ­·ï¼š
${teacher.experiences.join('\n')}

è­‰ç…§è³‡æ ¼ï¼š
${teacher.certificates.join('\n')}
      `;

      alert(details);
    }

    function editTeacher(teacherId) {
      const teacher = DEMO_TEACHERS.find(t => t.id === teacherId);
      alert(`é–‹å•Ÿç·¨è¼¯æ•™å¸«ç•Œé¢ï¼š${teacher.name}\n(æ­¤ç‚ºç¤ºç¯„ï¼Œå¯¦éš›æ‡‰å°å‘ç·¨è¼¯é é¢)`);
    }

    function deleteTeacher(teacherId) {
      const teacher = DEMO_TEACHERS.find(t => t.id === teacherId);

      if (confirm(`ç¢ºå®šè¦åˆªé™¤æ•™å¸«ã€Œ${teacher.name}ã€å—ï¼Ÿ\næ­¤æ“ä½œç„¡æ³•å¾©åŸï¼`)) {
        alert(`å·²åˆªé™¤æ•™å¸«ï¼š${teacher.name}\n(æ­¤ç‚ºç¤ºç¯„ï¼Œå¯¦éš›æ‡‰å‘¼å« API)`);
      }
    }

    // ============================================
    // åˆå§‹åŒ–
    // ============================================

    document.addEventListener('DOMContentLoaded', function() {
      // é è¨­ç‚ºè¨ªå®¢
      switchRole('visitor');

      console.log('=== æ•™å¸«å¡ç‰‡æ¬Šé™ç¤ºç¯„ ===');
      console.log('è«‹ä½¿ç”¨ä¸Šæ–¹çš„è§’è‰²åˆ‡æ›å™¨ï¼ŒæŸ¥çœ‹ä¸åŒè§’è‰²çœ‹åˆ°çš„ç•«é¢å·®ç•°');
      console.log('');
      console.log('è§’è‰²èªªæ˜ï¼š');
      console.log('- è¨ªå®¢ï¼šåªèƒ½çœ‹åˆ°åŸºæœ¬è³‡è¨Šï¼ˆå§“åã€éƒ¨åˆ†æ¨™ç±¤ï¼‰');
      console.log('- å­¸å“¡ï¼šå¯æŸ¥çœ‹å®Œæ•´è³‡æ–™ï¼ŒåŒ…å« emailã€ç¶“æ­·ã€è­‰ç…§');
      console.log('- æ•™å¸«ï¼šå¯ç·¨è¼¯è‡ªå·±çš„è³‡æ–™');
      console.log('- ç®¡ç†è€…ï¼šå¯ç·¨è¼¯å’Œåˆªé™¤æ‰€æœ‰æ•™å¸«');
    });
  </script>
</body>
</html>
