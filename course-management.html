<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸«è³‡æ´¾èª²ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'SF Pro Text', 'Helvetica Neue', 'Helvetica', 'Arial', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background: #f5f5f7;
        }

        /* Apple-style glass effect */
        .apple-card {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: saturate(180%) blur(20px);
            border: 0.5px solid rgba(0, 0, 0, 0.04);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .apple-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.08);
        }

        /* Hero section gradient */
        .hero-gradient {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
        }

        /* Apple-style button */
        .apple-btn {
            background: #0071e3;
            color: white;
            border: none;
            border-radius: 980px;
            padding: 12px 24px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            letter-spacing: -0.01em;
        }

        .apple-btn:hover {
            background: #0077ED;
            transform: scale(1.02);
        }

        .apple-btn:active {
            transform: scale(0.98);
        }

        .apple-btn-secondary {
            background: rgba(0, 0, 0, 0.04);
            color: #1d1d1f;
        }

        .apple-btn-secondary:hover {
            background: rgba(0, 0, 0, 0.08);
        }

        /* Smooth animations */
        .fade-in {
            animation: fadeIn 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .slide-up {
            animation: slideUp 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Apple-style input */
        .apple-input {
            background: rgba(255, 255, 255, 0.9);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 14px;
            transition: all 0.2s ease;
            outline: none;
        }

        .apple-input:focus {
            border-color: #0071e3;
            box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.1);
        }

        /* Course type cards with Apple styling */
        .course-type-card {
            background: linear-gradient(135deg, var(--start-color), var(--end-color));
            border-radius: 20px;
            padding: 24px;
            color: white;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .course-type-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at top right, rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .course-type-card:hover::before {
            opacity: 1;
        }

        .course-type-card:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
        }

        /* Timeline styling */
        .timeline-item {
            position: relative;
            padding-left: 40px;
            padding-bottom: 32px;
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: 12px;
            top: 30px;
            bottom: 0;
            width: 2px;
            background: linear-gradient(to bottom, #e5e5e7, transparent);
        }

        .timeline-item:last-child::before {
            display: none;
        }

        .timeline-dot {
            position: absolute;
            left: 0;
            top: 8px;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Progress bar Apple style */
        .apple-progress {
            height: 6px;
            background: rgba(0, 0, 0, 0.06);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .apple-progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #0071e3, #00a8e3);
            border-radius: 10px;
            transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .apple-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Modal backdrop */
        .modal-backdrop {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(8px);
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 0, 0, 0.3);
        }

        /* Badge styling */
        .apple-badge {
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
            letter-spacing: -0.01em;
        }

        /* Teacher avatar */
        .teacher-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        /* Status colors */
        .status-completed { background: #34c759; }
        .status-ongoing { background: #ff9500; }
        .status-upcoming { background: #007aff; }

        /* Hover effects */
        .hover-lift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .hover-lift:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Hero Section -->
    <div class="hero-gradient text-white py-16 mb-8">
        <div class="max-w-7xl mx-auto px-6">
            <div class="text-center fade-in">
                <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-white/20 backdrop-blur-lg mb-6">
                    <span class="text-4xl">ğŸ“š</span>
                </div>
                <h1 class="text-5xl font-bold mb-4 tracking-tight">å¸«è³‡æ´¾èª²ç®¡ç†</h1>
                <p class="text-xl opacity-90 font-light">æ™ºèƒ½åŒ–çš„èª²ç¨‹èˆ‡å¸«è³‡ç®¡ç†å¹³å°</p>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 pb-12">
        <!-- Control Panel -->
        <div class="apple-card rounded-3xl p-6 mb-8 slide-up">
            <div class="flex flex-wrap gap-4 items-center justify-between">
                <div class="flex items-center gap-4">
                    <div class="teacher-avatar" id="heroTeacherAvatar">ğŸ‘¨</div>
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900" id="heroTeacherName">ç‹å°æ˜è€å¸«</h2>
                        <p class="text-sm text-gray-500" id="heroTeacherSpecialty">æ•¸ç†å°ˆå®¶</p>
                    </div>
                </div>
                <div class="flex gap-3">
                    <button onclick="toggleAddCourseModal()" class="apple-btn">æ–°å¢èª²ç¨‹</button>
                    <button onclick="toggleTeacherModal()" class="apple-btn-secondary apple-btn">å¸«è³‡ç®¡ç†</button>
                    <button id="updateView" class="apple-btn-secondary apple-btn">æ›´æ–°</button>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <!-- Total Hours -->
            <div class="apple-card rounded-3xl p-6 hover-lift">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-1" id="totalHoursLabel">æœŸé–“æˆèª²æ™‚æ•¸</p>
                <p id="totalHours" class="text-3xl font-bold text-gray-900">0</p>
                <p class="text-xs text-gray-400 mt-1">å°æ™‚</p>
            </div>

            <!-- Total Courses -->
            <div class="apple-card rounded-3xl p-6 hover-lift">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-1" id="totalCoursesLabel">æœŸé–“èª²ç¨‹æ•¸é‡</p>
                <p id="totalCourses" class="text-3xl font-bold text-gray-900">0</p>
                <p class="text-xs text-gray-400 mt-1">é–€èª²ç¨‹</p>
            </div>

            <!-- Monthly Hours -->
            <div class="apple-card rounded-3xl p-6 hover-lift">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-full bg-green-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-1">æœ¬æœˆæ™‚æ•¸</p>
                <p id="monthlyHours" class="text-3xl font-bold text-gray-900">0</p>
                <p class="text-xs text-gray-400 mt-1">/ 12 å°æ™‚</p>
            </div>

            <!-- Today Courses -->
            <div class="apple-card rounded-3xl p-6 hover-lift">
                <div class="flex items-center justify-between mb-4">
                    <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center">
                        <svg class="w-6 h-6 text-orange-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                        </svg>
                    </div>
                </div>
                <p class="text-sm text-gray-500 mb-1">ä»Šæ—¥èª²ç¨‹</p>
                <p id="todayCoursesCount" class="text-3xl font-bold text-gray-900">0</p>
                <p class="text-xs text-gray-400 mt-1">é–€èª²ç¨‹</p>
            </div>
        </div>

        <!-- Date Range Selector -->
        <div class="apple-card rounded-3xl p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-4">æŸ¥è©¢ç¯„åœ</h3>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
                <input type="date" id="startDate" class="apple-input text-sm">
                <input type="date" id="endDate" class="apple-input text-sm">
                <button onclick="setDateRange('thisMonth')" class="apple-btn-secondary apple-btn text-sm">æœ¬æœˆ</button>
                <button onclick="setDateRange('last3Months')" class="apple-btn-secondary apple-btn text-sm">è¿‘3æœˆ</button>
            </div>
            <div class="grid grid-cols-2 md:grid-cols-3 gap-3">
                <button onclick="setDateRange('last6Months')" class="apple-btn-secondary apple-btn text-sm">è¿‘åŠå¹´</button>
                <button onclick="setDateRange('thisYear')" class="apple-btn-secondary apple-btn text-sm">ä»Šå¹´</button>
                <button onclick="setDateRange('lastMonth')" class="apple-btn-secondary apple-btn text-sm">ä¸Šæœˆ</button>
            </div>
        </div>

        <!-- Course Type Analysis (replacing Canvas chart) -->
        <div class="apple-card rounded-3xl p-6 mb-8">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">èª²ç¨‹é¡å‹åˆ†æ</h3>
            <div id="courseTypeAnalysis" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                <!-- Course type cards will be inserted here -->
            </div>
        </div>

        <!-- Teachers List -->
        <div class="apple-card rounded-3xl p-6 mb-8">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900">å¸«è³‡åˆ—è¡¨</h3>
                <select id="teacherSelect" class="apple-input text-sm" style="width: auto;">
                    <option value="teacher1">ç‹å°æ˜è€å¸«</option>
                    <option value="teacher2">æç¾è¯è€å¸«</option>
                    <option value="teacher3">å¼µå¿—å¼·è€å¸«</option>
                    <option value="teacher4">é™³é›…å©·è€å¸«</option>
                </select>
            </div>
            <div id="teachersList" class="grid grid-cols-2 md:grid-cols-4 gap-4">
                <!-- Teachers will be inserted here -->
            </div>
        </div>

        <!-- Timeline -->
        <div class="apple-card rounded-3xl p-6">
            <h3 class="text-lg font-semibold text-gray-900 mb-6">èª²ç¨‹æ™‚é–“è»¸</h3>
            <div id="timeline" class="space-y-0">
                <!-- Timeline items will be inserted here -->
            </div>
        </div>
    </div>

    <!-- Add Course Modal -->
    <div id="addCourseModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50" style="display: none;">
        <div class="apple-card rounded-3xl p-8 max-w-md w-full mx-4 slide-up">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">æ–°å¢èª²ç¨‹</h3>
            <form id="courseForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹åç¨±</label>
                    <input type="text" id="courseName" class="apple-input w-full" placeholder="è«‹è¼¸å…¥èª²ç¨‹åç¨±">
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹æ—¥æœŸ</label>
                        <input type="date" id="courseDate" class="apple-input w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹é¡å‹</label>
                        <select id="courseType" class="apple-input w-full">
                            <option value="æ­£èª²">æ­£èª²</option>
                            <option value="è£œèª²">è£œèª²</option>
                            <option value="å¯¦é©—èª²">å¯¦é©—èª²</option>
                            <option value="å¯¦ä½œèª²">å¯¦ä½œèª²</option>
                            <option value="å°ˆé¡Œ">å°ˆé¡Œ</option>
                        </select>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">é–‹å§‹æ™‚é–“</label>
                        <input type="time" id="startTime" class="apple-input w-full">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">çµæŸæ™‚é–“</label>
                        <input type="time" id="endTime" class="apple-input w-full">
                    </div>
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="cancelAdd" class="apple-btn-secondary apple-btn">å–æ¶ˆ</button>
                    <button type="submit" class="apple-btn">ç¢ºèªæ–°å¢</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Teacher Modal -->
    <div id="addTeacherModal" class="fixed inset-0 modal-backdrop hidden items-center justify-center z-50" style="display: none;">
        <div class="apple-card rounded-3xl p-8 max-w-md w-full mx-4 slide-up">
            <h3 class="text-2xl font-bold text-gray-900 mb-6">æ–°å¢å¸«è³‡</h3>
            <form id="teacherForm" class="space-y-4">
                <div class="text-center mb-6">
                    <div id="avatarPreview" onclick="document.getElementById('teacherAvatar').click()" class="w-24 h-24 mx-auto rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center cursor-pointer hover:shadow-lg transition-all">
                        <span class="text-white text-2xl">ğŸ“·</span>
                    </div>
                    <input type="file" id="teacherAvatar" accept="image/*" class="hidden">
                    <p class="text-xs text-gray-500 mt-2">é»æ“Šä¸Šå‚³é ­åƒ</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å¸«è³‡å§“å</label>
                    <input type="text" id="teacherName" class="apple-input w-full" placeholder="è«‹è¼¸å…¥å§“å">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">å°ˆæ¥­é ˜åŸŸ</label>
                    <input type="text" id="teacherSpecialty" class="apple-input w-full" placeholder="ä¾‹å¦‚ï¼šæ•¸ç†å°ˆå®¶">
                </div>
                <div class="flex justify-end gap-3 pt-4">
                    <button type="button" id="cancelTeacherAdd" class="apple-btn-secondary apple-btn">å–æ¶ˆ</button>
                    <button type="submit" class="apple-btn">ç¢ºèªæ–°å¢</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Data structure (same as before)
        const teachersData = {
            teacher1: {
                name: 'ç‹å°æ˜è€å¸«',
                specialty: 'æ•¸ç†å°ˆå®¶',
                avatar: null,
                courses: [
                    { date: '2024-01-15', time: '09:00-11:00', subject: 'é«˜ç­‰æ•¸å­¸', students: 25, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-15', time: '14:00-16:00', subject: 'ç‰©ç†å¯¦é©—', students: 20, type: 'å¯¦é©—èª²', status: 'completed' },
                    { date: '2024-01-16', time: '10:00-12:00', subject: 'å¾®ç©åˆ†', students: 22, type: 'è£œèª²', status: 'completed' },
                    { date: '2024-01-17', time: '09:00-10:30', subject: 'ç·šæ€§ä»£æ•¸', students: 18, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-18', time: '13:00-15:00', subject: 'çµ±è¨ˆå­¸', students: 24, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-19', time: '15:00-17:00', subject: 'æ©Ÿç‡è«–', students: 26, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-20', time: '10:00-12:00', subject: 'æ•¸å­¸å»ºæ¨¡', students: 15, type: 'å°ˆé¡Œ', status: 'completed' },
                    { date: '2023-12-05', time: '09:00-11:00', subject: 'é«˜ç­‰æ•¸å­¸', students: 28, type: 'æ­£èª²', status: 'completed' },
                    { date: '2023-12-08', time: '14:00-16:00', subject: 'ç‰©ç†å¯¦é©—', students: 22, type: 'å¯¦é©—èª²', status: 'completed' },
                    { date: '2023-12-12', time: '10:00-12:00', subject: 'å¾®ç©åˆ†', students: 25, type: 'æ­£èª²', status: 'completed' },
                ]
            },
            teacher2: {
                name: 'æç¾è¯è€å¸«',
                specialty: 'èªè¨€å¤§å¸«',
                avatar: null,
                courses: [
                    { date: '2024-01-15', time: '08:00-10:00', subject: 'å•†ç”¨è‹±æ–‡', students: 30, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-16', time: '14:00-16:00', subject: 'è‹±èªæœƒè©±', students: 28, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-17', time: '10:00-12:00', subject: 'TOEICæº–å‚™', students: 25, type: 'è£œèª²', status: 'ongoing' },
                ]
            },
            teacher3: {
                name: 'å¼µå¿—å¼·è€å¸«',
                specialty: 'å•†ç®¡èè‹±',
                avatar: null,
                courses: [
                    { date: '2024-01-15', time: '13:00-15:00', subject: 'ä¼æ¥­ç®¡ç†', students: 35, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-16', time: '09:00-11:00', subject: 'è¡ŒéŠ·ç­–ç•¥', students: 28, type: 'æ­£èª²', status: 'completed' },
                ]
            },
            teacher4: {
                name: 'é™³é›…å©·è€å¸«',
                specialty: 'ç§‘å­¸é”äºº',
                avatar: null,
                courses: [
                    { date: '2024-01-15', time: '10:00-12:00', subject: 'æœ‰æ©ŸåŒ–å­¸', students: 24, type: 'æ­£èª²', status: 'completed' },
                    { date: '2024-01-16', time: '13:00-15:00', subject: 'ç”Ÿç‰©å¯¦é©—', students: 18, type: 'å¯¦é©—èª²', status: 'completed' },
                ]
            }
        };

        let currentTeacher = 'teacher1';
        let currentStartDate, currentEndDate;

        // Initialize dates
        function initializeDates() {
            const today = new Date();
            const startDate = new Date('2023-01-01');
            const endDate = new Date('2024-12-31');

            currentStartDate = startDate.toISOString().split('T')[0];
            currentEndDate = endDate.toISOString().split('T')[0];

            document.getElementById('startDate').value = currentStartDate;
            document.getElementById('endDate').value = currentEndDate;
        }

        // Calculate hours from time range
        function calculateHours(timeRange) {
            const [start, end] = timeRange.split('-');
            const startTime = new Date(`2024-01-01 ${start}`);
            const endTime = new Date(`2024-01-01 ${end}`);
            return (endTime - startTime) / (1000 * 60 * 60);
        }

        // Filter courses by date range
        function getFilteredCourses(teacherId) {
            const teacher = teachersData[teacherId];
            if (!teacher || !teacher.courses) return [];

            if (!currentStartDate || !currentEndDate) {
                return teacher.courses;
            }

            return teacher.courses.filter(course => {
                return course.date >= currentStartDate && course.date <= currentEndDate;
            });
        }

        // Calculate period hours
        function calculatePeriodHours(teacherId) {
            const filteredCourses = getFilteredCourses(teacherId);
            return filteredCourses.reduce((total, course) => total + calculateHours(course.time), 0);
        }

        // Calculate monthly hours
        function calculateMonthlyHours(teacherId, year, month) {
            const teacher = teachersData[teacherId];
            if (!teacher) return 0;

            return teacher.courses
                .filter(course => {
                    const courseDate = new Date(course.date);
                    return courseDate.getFullYear() === year && courseDate.getMonth() === month;
                })
                .reduce((total, course) => total + calculateHours(course.time), 0);
        }

        // Update stats
        function updateStats() {
            const teacher = teachersData[currentTeacher];
            if (!teacher) return;

            const filteredCourses = getFilteredCourses(currentTeacher);
            const totalCourses = filteredCourses.length;
            const periodHours = calculatePeriodHours(currentTeacher);

            const now = new Date();
            const monthlyHours = calculateMonthlyHours(currentTeacher, now.getFullYear(), now.getMonth());

            const today = now.toISOString().split('T')[0];
            const todayCourses = filteredCourses.filter(course => course.date === today).length;

            document.getElementById('totalHours').textContent = Math.round(periodHours);
            document.getElementById('totalCourses').textContent = totalCourses;
            document.getElementById('monthlyHours').textContent = monthlyHours.toFixed(1);
            document.getElementById('todayCoursesCount').textContent = todayCourses;
        }

        // Create course type analysis (replacing canvas chart)
        function createCourseTypeAnalysis() {
            const filteredCourses = getFilteredCourses(currentTeacher);
            const typeCount = {};

            filteredCourses.forEach(course => {
                typeCount[course.type] = (typeCount[course.type] || 0) + 1;
            });

            const colors = {
                'æ­£èª²': { start: '#667eea', end: '#764ba2' },
                'è£œèª²': { start: '#f093fb', end: '#f5576c' },
                'å¯¦é©—èª²': { start: '#4facfe', end: '#00f2fe' },
                'å¯¦ä½œèª²': { start: '#43e97b', end: '#38f9d7' },
                'å°ˆé¡Œ': { start: '#fa709a', end: '#fee140' }
            };

            const total = Object.values(typeCount).reduce((a, b) => a + b, 0);
            const container = document.getElementById('courseTypeAnalysis');
            container.innerHTML = '';

            Object.entries(typeCount).forEach(([type, count]) => {
                const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
                const color = colors[type] || { start: '#6c757d', end: '#495057' };

                const card = document.createElement('div');
                card.className = 'course-type-card';
                card.style.setProperty('--start-color', color.start);
                card.style.setProperty('--end-color', color.end);
                card.innerHTML = `
                    <div class="relative z-10">
                        <h4 class="text-lg font-semibold mb-2">${type}</h4>
                        <p class="text-3xl font-bold mb-1">${count}</p>
                        <p class="text-sm opacity-90">é–€èª²ç¨‹ Â· ${percentage}%</p>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Create timeline
        function createTimeline() {
            const teacher = teachersData[currentTeacher];
            const timeline = document.getElementById('timeline');

            if (!teacher || !teacher.courses) {
                timeline.innerHTML = '<p class="text-center text-gray-500 py-8">ç„¡èª²ç¨‹è³‡æ–™</p>';
                return;
            }

            const filteredCourses = getFilteredCourses(currentTeacher);
            const sortedCourses = [...filteredCourses].sort((a, b) => new Date(b.date) - new Date(a.date));

            if (sortedCourses.length === 0) {
                timeline.innerHTML = '<p class="text-center text-gray-500 py-8">é¸å®šæ™‚é–“ç¯„åœå…§ç„¡èª²ç¨‹è³‡æ–™</p>';
                return;
            }

            timeline.innerHTML = '';

            sortedCourses.forEach((course, index) => {
                const hours = calculateHours(course.time);
                const statusColors = {
                    'completed': { bg: 'bg-green-500', text: 'å·²å®Œæˆ', icon: 'âœ“' },
                    'ongoing': { bg: 'bg-orange-500', text: 'é€²è¡Œä¸­', icon: 'â—' },
                    'upcoming': { bg: 'bg-blue-500', text: 'æœªä¾†', icon: 'â—‹' }
                };

                const status = statusColors[course.status] || statusColors.upcoming;

                const item = document.createElement('div');
                item.className = 'timeline-item fade-in';
                item.style.animationDelay = `${index * 0.05}s`;
                item.innerHTML = `
                    <div class="timeline-dot ${status.bg} text-white">${status.icon}</div>
                    <div class="apple-card rounded-2xl p-4 hover-lift">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="text-lg font-semibold text-gray-900">${course.subject}</h4>
                            <span class="apple-badge bg-gray-100 text-gray-700">${course.type}</span>
                        </div>
                        <div class="flex flex-wrap gap-4 text-sm text-gray-600">
                            <span>ğŸ“… ${new Date(course.date).toLocaleDateString('zh-TW')}</span>
                            <span>ğŸ• ${course.time}</span>
                            <span>â±ï¸ ${hours.toFixed(1)}å°æ™‚</span>
                            <span>ğŸ‘¥ ${course.students}äºº</span>
                        </div>
                    </div>
                `;
                timeline.appendChild(item);
            });
        }

        // Create teachers list
        function createTeachersList() {
            const teachersList = document.getElementById('teachersList');
            teachersList.innerHTML = '';

            Object.keys(teachersData).forEach(teacherId => {
                const teacher = teachersData[teacherId];
                const isActive = teacherId === currentTeacher;

                const card = document.createElement('div');
                card.className = `apple-card rounded-2xl p-4 cursor-pointer hover-lift ${isActive ? 'ring-2 ring-blue-500' : ''}`;
                card.onclick = () => selectTeacher(teacherId);
                card.innerHTML = `
                    <div class="text-center">
                        <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-gradient-to-br from-purple-400 to-pink-400 flex items-center justify-center text-white text-2xl">
                            ${teacher.avatar ? `<img src="${teacher.avatar}" class="w-full h-full rounded-full object-cover" alt="${teacher.name}">` : 'ğŸ‘¤'}
                        </div>
                        <h4 class="font-semibold text-gray-900 text-sm mb-1">${teacher.name}</h4>
                        <p class="text-xs text-gray-500 mb-2">${teacher.specialty}</p>
                        <span class="apple-badge bg-gray-100 text-gray-600 text-xs">${teacher.courses.length} é–€èª²ç¨‹</span>
                    </div>
                `;
                teachersList.appendChild(card);
            });
        }

        // Select teacher
        function selectTeacher(teacherId) {
            currentTeacher = teacherId;
            document.getElementById('teacherSelect').value = teacherId;
            updateAllViews();
            showToast(`å·²åˆ‡æ›åˆ° ${teachersData[teacherId].name}`);
        }

        // Update all views
        function updateAllViews() {
            const teacher = teachersData[currentTeacher];
            if (!teacher) return;

            document.getElementById('heroTeacherName').textContent = teacher.name;
            document.getElementById('heroTeacherSpecialty').textContent = teacher.specialty;

            updateStats();
            createCourseTypeAnalysis();
            createTimeline();
            createTeachersList();
        }

        // Set date range
        function setDateRange(range) {
            const today = new Date();
            let startDate, endDate;

            switch(range) {
                case 'thisMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth(), 1);
                    endDate = today;
                    break;
                case 'lastMonth':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
                    endDate = new Date(today.getFullYear(), today.getMonth(), 0);
                    break;
                case 'last3Months':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 2, 1);
                    endDate = today;
                    break;
                case 'last6Months':
                    startDate = new Date(today.getFullYear(), today.getMonth() - 5, 1);
                    endDate = today;
                    break;
                case 'thisYear':
                    startDate = new Date(today.getFullYear(), 0, 1);
                    endDate = today;
                    break;
            }

            currentStartDate = startDate.toISOString().split('T')[0];
            currentEndDate = endDate.toISOString().split('T')[0];

            document.getElementById('startDate').value = currentStartDate;
            document.getElementById('endDate').value = currentEndDate;

            updateAllViews();
            showToast('æ—¥æœŸç¯„åœå·²æ›´æ–°');
        }

        // Modal functions
        function toggleAddCourseModal() {
            const modal = document.getElementById('addCourseModal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                modal.style.display = 'flex';
            }
        }

        function toggleTeacherModal() {
            const modal = document.getElementById('addTeacherModal');
            modal.classList.toggle('hidden');
            if (!modal.classList.contains('hidden')) {
                modal.style.display = 'flex';
            }
        }

        // Toast notification
        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'fixed top-4 right-4 apple-card rounded-2xl px-6 py-4 shadow-lg z-50 fade-in';
            toast.textContent = message;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.opacity = '0';
                setTimeout(() => toast.remove(), 300);
            }, 2000);
        }

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            initializeDates();
            updateAllViews();

            document.getElementById('teacherSelect').addEventListener('change', function(e) {
                selectTeacher(e.target.value);
            });

            document.getElementById('startDate').addEventListener('change', function(e) {
                currentStartDate = e.target.value;
                updateAllViews();
            });

            document.getElementById('endDate').addEventListener('change', function(e) {
                currentEndDate = e.target.value;
                updateAllViews();
            });

            document.getElementById('updateView').addEventListener('click', function() {
                updateAllViews();
                showToast('è³‡æ–™å·²æ›´æ–°');
            });

            document.getElementById('cancelAdd').addEventListener('click', toggleAddCourseModal);
            document.getElementById('cancelTeacherAdd').addEventListener('click', toggleTeacherModal);

            document.getElementById('courseForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const courseData = {
                    name: document.getElementById('courseName').value,
                    date: document.getElementById('courseDate').value,
                    startTime: document.getElementById('startTime').value,
                    endTime: document.getElementById('endTime').value,
                    type: document.getElementById('courseType').value
                };

                if (!courseData.name || !courseData.date || !courseData.startTime || !courseData.endTime) {
                    showToast('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
                    return;
                }

                const teacher = teachersData[currentTeacher];
                teacher.courses.push({
                    date: courseData.date,
                    time: `${courseData.startTime}-${courseData.endTime}`,
                    subject: courseData.name,
                    students: 25,
                    type: courseData.type,
                    status: 'upcoming'
                });

                toggleAddCourseModal();
                updateAllViews();
                showToast('èª²ç¨‹æ–°å¢æˆåŠŸ');
                this.reset();
            });

            document.getElementById('teacherForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const teacherData = {
                    name: document.getElementById('teacherName').value,
                    specialty: document.getElementById('teacherSpecialty').value,
                    avatar: null
                };

                if (!teacherData.name || !teacherData.specialty) {
                    showToast('è«‹å¡«å¯«æ‰€æœ‰æ¬„ä½');
                    return;
                }

                const newId = `teacher${Object.keys(teachersData).length + 1}`;
                teachersData[newId] = {
                    ...teacherData,
                    courses: []
                };

                currentTeacher = newId;
                toggleTeacherModal();
                updateAllViews();
                showToast('å¸«è³‡æ–°å¢æˆåŠŸ');
                this.reset();
            });

            // Avatar preview
            document.getElementById('teacherAvatar').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        document.getElementById('avatarPreview').innerHTML =
                            `<img src="${e.target.result}" class="w-full h-full rounded-full object-cover" alt="é è¦½">`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Click outside modal to close
            document.getElementById('addCourseModal').addEventListener('click', function(e) {
                if (e.target === this) toggleAddCourseModal();
            });

            document.getElementById('addTeacherModal').addEventListener('click', function(e) {
                if (e.target === this) toggleTeacherModal();
            });
        });

        // Save to localStorage
        function saveData() {
            localStorage.setItem('teachersData', JSON.stringify(teachersData));
            localStorage.setItem('currentTeacher', currentTeacher);
        }

        // Load from localStorage
        function loadData() {
            const saved = localStorage.getItem('teachersData');
            if (saved) {
                Object.assign(teachersData, JSON.parse(saved));
            }
            const savedTeacher = localStorage.getItem('currentTeacher');
            if (savedTeacher && teachersData[savedTeacher]) {
                currentTeacher = savedTeacher;
            }
        }

        // Auto-save
        window.addEventListener('beforeunload', saveData);
        loadData();
    </script>
</body>
</html>
