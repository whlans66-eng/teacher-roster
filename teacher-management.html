<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>å¸«è³‡é™£å®¹ç®¡ç†ç³»çµ±</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- å­—é«” -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
       body{font-family:-apple-system,BlinkMacSystemFont,'Inter','Segoe UI','Roboto','Helvetica Neue',Arial,sans-serif;background-color:#f5f5f7;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    .fade-in{animation:fadeIn .3s ease-in}
    @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
    .slide-in{animation:slideIn .3s ease-out}
    @keyframes slideIn{from{transform:translateX(100%)}to{transform:translateX(0)}}
    .move-transition{transition:transform .2s ease-in-out}
    .location-option.selected{border-color:#007aff;background-color:#f0f5ff}
    .location-option.selected.onboard{border-color:#007aff;background-color:#e6f0ff}
    .location-option.selected.onshore{border-color:#34c759;background-color:#e8f9ed}
    .teacher-type-option.selected{border-color:#007aff;background-color:#f0f5ff}
    .teacher-type-option.selected.internal{border-color:#007aff;background-color:#e6f0ff}
    .teacher-type-option.selected.external{border-color:#5856d6;background-color:#f0efff}
    .calendar-cell{min-height:110px;border:1px solid rgba(0,0,0,.06);border-radius:12px;transition:all .3s cubic-bezier(0.4,0,0.2,1)}
    .calendar-cell:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,0.08)}

    .status-badge{display:inline-flex;align-items:center;justify-content:center;padding:0.25rem 0.75rem;border-radius:9999px;font-size:0.875rem;font-weight:600;transition:all .2s ease;border-width:1px;border-style:solid}

    /* æµ·äº‹èª²ç¨‹ç³»çµ±æ¨£å¼ */
    .highlight{background-color:#fef3c7;padding:2px 4px;border-radius:3px}
    .chart-container{position:relative;width:280px;height:280px;margin:0 auto;padding:20px}
    .pie-chart{width:280px;height:280px;border-radius:50%;background:conic-gradient(from 0deg,#4f46e5 0deg,#4f46e5 var(--angle1,0deg),#06b6d4 var(--angle1,0deg),#06b6d4 var(--angle2,0deg),#10b981 var(--angle2,0deg),#10b981 var(--angle3,0deg),#f59e0b var(--angle3,0deg),#f59e0b var(--angle4,0deg),#ef4444 var(--angle4,0deg),#ef4444 var(--angle5,0deg),#8b5cf6 var(--angle5,0deg),#8b5cf6 var(--angle6,0deg),#f97316 var(--angle6,0deg),#f97316 var(--angle7,0deg),#84cc16 var(--angle7,0deg),#84cc16 var(--angle8,0deg),#ec4899 var(--angle8,0deg),#ec4899 360deg);box-shadow:0 20px 60px rgba(0,0,0,0.15),0 8px 25px rgba(0,0,0,0.1),inset 0 1px 0 rgba(255,255,255,0.1);position:relative;transition:all .3s ease}
    .pie-chart:hover{transform:scale(1.05);box-shadow:0 25px 80px rgba(0,0,0,0.2),0 12px 35px rgba(0,0,0,0.15),inset 0 1px 0 rgba(255,255,255,0.2)}
    .pie-chart::before{content:'';position:absolute;top:50%;left:50%;width:120px;height:120px;background:linear-gradient(135deg,#ffffff 0%,#f8fafc 100%);border-radius:50%;transform:translate(-50%,-50%);box-shadow:0 8px 32px rgba(0,0,0,0.1),inset 0 2px 8px rgba(0,0,0,0.05);border:3px solid rgba(255,255,255,0.8)}
    .pie-chart::after{content:'ğŸ“Š\Aèª²ç¨‹åˆ†å¸ƒ';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:14px;font-weight:bold;color:#374151;z-index:1;text-align:center;white-space:pre;line-height:1.3}
    .legend-item{transition:all .2s ease;padding:8px;border-radius:8px;cursor:pointer}
    .legend-item:hover{background-color:#f3f4f6;transform:translateX(5px)}
    .legend-color{width:16px;height:16px;border-radius:50%;box-shadow:0 2px 8px rgba(0,0,0,0.2);border:2px solid rgba(255,255,255,0.8)}
    .bar-chart{background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:8px;padding:4px}
    .bar-fill{border-radius:4px;transition:all .3s ease;position:relative;overflow:hidden}
    .bar-fill::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);animation:shimmer 2s infinite}
    @keyframes shimmer{0%{left:-100%}100%{left:100%}}
    .donut-chart{position:relative;width:120px;height:120px;border-radius:50%;display:flex;align-items:center;justify-content:center;background:conic-gradient(from 0deg,var(--color) 0deg,var(--color) var(--angle,0deg),#e5e7eb var(--angle,0deg),#e5e7eb 360deg);box-shadow:0 4px 20px rgba(0,0,0,0.1)}
    .donut-chart::before{content:'';position:absolute;width:70px;height:70px;background:white;border-radius:50%;box-shadow:inset 0 2px 8px rgba(0,0,0,0.1)}
    .donut-chart-label{position:absolute;font-size:14px;font-weight:bold;color:#374151;z-index:1}
    .method-card{background:linear-gradient(135deg,#f8fafc 0%,#e2e8f0 100%);border-radius:12px;padding:20px;text-align:center;transition:all .3s ease;border:1px solid rgba(255,255,255,0.2)}
    .method-card:hover{transform:translateY(-5px);box-shadow:0 10px 30px rgba(0,0,0,0.15)}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.05)}}
    .pulse-animation{animation:pulse 2s infinite}
  </style>

  <!-- API å±¤ï¼šèˆ‡å¾Œç«¯é€šè¨Š -->
  <script src="js/api.js"></script>
</head>
<body class="min-h-screen">
  <div class="container mx-auto px-4 py-8">
    <!-- è¿”å›é¦–é æŒ‰éˆ• -->
    <div class="mb-6">
      <a href="index.html" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-gray-50 transition-colors">
        <span class="mr-2">â†</span> è¿”å›é¦–é 
      </a>
    </div>

    <!-- æ¨™é¡Œå€åŸŸ -->
    <div class="text-center mb-8">
      <h1 class="text-4xl font-bold text-gray-900 mb-2" style="letter-spacing:-0.02em">å¸«è³‡é™£å®¹ç®¡ç†</h1>
      <p class="text-gray-600">ç®¡ç†æ‚¨çš„æ•™å¸«åœ˜éšŠè³‡è¨Š</p>
    </div>

    <!-- å¸«è³‡åˆ—è¡¨é é¢ -->
    <div id="teacherList" class="fade-in">
      <div class="flex flex-col space-y-4 mb-6">
        <!-- æ¨™é¡Œå’Œæ¨¡å¼åˆ‡æ› -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center space-y-4 md:space-y-0">
          <div class="flex items-center space-x-4">
            <h2 class="text-2xl font-semibold text-gray-800">å¸«è³‡åˆ—è¡¨</h2>

            <!-- æ¨¡å¼åˆ‡æ› -->
            <div class="flex bg-gray-100 rounded-lg p-1">
              <button onclick="switchMode('edit')" id="editModeBtn" class="px-4 py-2 rounded-md text-sm font-medium transition-all bg-blue-600 text-white" style="background-color:#007aff">âœï¸ ç·¨è¼¯æ¨¡å¼</button>
              <button onclick="switchMode('display')" id="displayModeBtn" class="px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-600 hover:text-gray-800">ğŸ‘ï¸ å‘ˆç¾æ¨¡å¼</button>
            </div>

            <div class="flex space-x-3">
             <!-- çµ±è¨ˆ + è¡Œäº‹æ›† -->
              <button onclick="showStatisticsView()" class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm border border-gray-200 flex items-center space-x-2">
                <span>ğŸ“ˆ</span><span>çµ±è¨ˆåˆ†æ</span>
              </button>

              <button onclick="showCalendarView()"
                class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-lg font-medium transition-all duration-200 shadow-sm border border-gray-200 flex items-center space-x-2">
                  <span>ğŸ“…</span><span>è¡Œäº‹æ›†</span>
                 </button>
            </div>
          </div>

          <!-- æœå°‹ + æ–°å¢ -->
          <div class="flex flex-col md:flex-row items-stretch md:items-center space-y-3 md:space-y-0 md:space-x-4 w-full md:w-auto">
            <div class="relative">
              <input id="searchInput" type="text" placeholder="æœå°‹æ‰€æœ‰æ¬„ä½ï¼ˆæ”¯æ´å¤šå€‹é—œéµå­—ï¼Œç”¨ç©ºæ ¼åˆ†éš”ï¼‰" class="w-full md:w-80 px-4 py-3 pl-10 border border-gray-300 rounded-lg focus:ring-2 transition-all" style="outline:none;--tw-ring-color:#007aff" oninput="searchTeachers()">
              <div class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-400">ğŸ”</div>
              <button onclick="clearSearch()" id="clearBtn" class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 hidden">âœ•</button>
            </div>
            <button onclick="addNewTeacher()" id="addTeacherBtn" class="text-white px-6 py-3 rounded-lg font-medium transition-colors duration-200 shadow-sm whitespace-nowrap" style="background-color:#007aff">
              â• æ–°å¢å¸«è³‡
            </button>
          </div>
        </div>

        <!-- æ¨¡å¼èªªæ˜ -->
        <div id="modeDescription" class="bg-blue-50 border border-blue-100 rounded-lg p-3">
          <div class="flex items-center space-x-2">
            <span style="color:#007aff">â„¹ï¸</span>
            <span class="text-sm font-medium" style="color:#007aff">ç·¨è¼¯æ¨¡å¼ï¼šå¯ä»¥æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€è¤‡è£½å’Œæ’åºå¸«è³‡</span>
          </div>
        </div>

      </div>

      <!-- æœå°‹æç¤º -->
      <div id="searchResults" class="hidden mb-4 p-3 bg-blue-50 border border-blue-100 rounded-lg">
        <span class="font-medium" style="color:#007aff"></span>
      </div>

      <!-- å¡ç‰‡ç¶²æ ¼ -->
      <div id="teacherGrid" class="grid gap-6"></div>
    </div>

    <!-- çµ±è¨ˆé  -->
    <div id="executiveView" class="hidden fade-in">
      <div class="rounded-xl shadow-sm border border-purple-200 p-8 max-w-7xl mx-auto" style="background: linear-gradient(135deg, #f3e7f9 0%, #e9d5f5 100%);">
        <button onclick="backToListFromExecutive()" class="mb-6 font-medium flex items-center transition-colors" style="color:#007aff">â† è¿”å›å¸«è³‡ç®¡ç†</button>
        <div class="text-center mb-8">
          <h1 class="text-4xl font-bold text-gray-900 mb-2" style="letter-spacing:-0.02em">å¸«è³‡çµ±è¨ˆåˆ†æ</h1>
          <p class="text-gray-600">æ·±åº¦åˆ†æå¸«è³‡é™£å®¹çµæ§‹èˆ‡åˆ†å¸ƒ</p>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
          <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">ç¸½å¸«è³‡æ•¸é‡</p>
                <p id="totalCount" class="text-3xl font-bold text-gray-900">0</p>
              </div><div class="text-4xl opacity-60">ğŸ‘¥</div>
            </div>
          </div>
          <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">å…§éƒ¨å¸«è³‡</p>
                <p id="internalCount" class="text-3xl font-bold text-gray-900">0</p>
                <p id="internalPercent" class="text-gray-500 text-xs">0%</p>
              </div><div class="text-4xl opacity-60">ğŸ‘¨â€ğŸ’¼</div>
            </div>
          </div>
          <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">å¤–éƒ¨å¸«è³‡</p>
                <p id="externalCount" class="text-3xl font-bold text-gray-900">0</p>
                <p id="externalPercent" class="text-gray-500 text-xs">0%</p>
              </div><div class="text-4xl opacity-60">ğŸ‘¨â€ğŸ“</div>
            </div>
          </div>
          <div class="bg-white border border-gray-200 rounded-xl p-6 shadow-sm">
            <div class="flex items-center justify-between">
              <div>
                <p class="text-gray-600 text-sm font-medium">æµ·ä¸Š/é™¸åœ°</p>
                <p class="text-lg font-bold text-gray-900"><span id="onboardCount">0</span>/<span id="onshoreCount">0</span></p>
                <p id="locationRatio" class="text-gray-500 text-xs">æ¯”ä¾‹ 0:0</p>
              </div><div class="text-4xl opacity-60">ğŸš¢</div>
            </div>
          </div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
          <div class="bg-white bg-opacity-70 rounded-xl p-6 shadow-sm">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">ğŸ“Š</span>å¸«è³‡é¡å‹åˆ†æ</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm border border-gray-100">
                <div class="flex items-center space-x-3"><div class="w-4 h-4 rounded-full" style="background-color:#007aff"></div><span class="font-medium text-gray-700">å…§éƒ¨å¸«è³‡</span></div>
                <div class="text-right"><div class="font-bold text-gray-900" id="internalCountDetail">0 ä½</div><div class="text-sm text-gray-500" id="internalPercentDetail">0%</div></div>
              </div>
              <div class="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm border border-gray-100">
                <div class="flex items-center space-x-3"><div class="w-4 h-4 rounded-full" style="background-color:#5856d6"></div><span class="font-medium text-gray-700">å¤–éƒ¨å¸«è³‡</span></div>
                <div class="text-right"><div class="font-bold text-gray-900" id="externalCountDetail">0 ä½</div><div class="text-sm text-gray-500" id="externalPercentDetail">0%</div></div>
              </div>
            </div>
          </div>
          <div class="bg-white bg-opacity-70 rounded-xl p-6 shadow-sm">
            <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">ğŸ—ºï¸</span>å·¥ä½œåœ°é»åˆ†æ</h3>
            <div class="space-y-4">
              <div class="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm">
                <div class="flex items-center space-x-3"><div class="w-4 h-4 bg-orange-500 rounded-full"></div><span class="font-medium text-gray-700">æµ·ä¸Šå·¥ä½œ</span></div>
                <div class="text-right"><div class="font-bold text-orange-600" id="onboardCountDetail">0 ä½</div><div class="text-sm text-gray-500" id="onboardPercentDetail">0%</div></div>
              </div>
              <div class="flex items-center justify-between p-4 bg-white rounded-lg shadow-sm">
                <div class="flex items-center space-x-3"><div class="w-4 h-4 bg-green-500 rounded-full"></div><span class="font-medium text-gray-700">é™¸åœ°å·¥ä½œ</span></div>
                <div class="text-right"><div class="font-bold text-green-600" id="onshoreCountDetail">0 ä½</div><div class="text-sm text-gray-500" id="onshorePercentDetail">0%</div></div>
              </div>
            </div>
          </div>
        </div>
        <div class="bg-white bg-opacity-70 rounded-xl p-6 mb-8 shadow-sm">
          <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">ğŸ”„</span>äº¤å‰åˆ†æ</h3>
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
            <div class="bg-white rounded-lg p-4 text-center shadow-sm">
              <div class="text-2xl font-bold text-orange-600" id="internalOnboard">0</div><div class="text-sm text-gray-600">å…§éƒ¨æµ·ä¸Šå¸«è³‡</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow-sm">
              <div class="text-2xl font-bold text-green-600" id="internalOnshore">0</div><div class="text-sm text-gray-600">å…§éƒ¨é™¸åœ°å¸«è³‡</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow-sm">
              <div class="text-2xl font-bold text-orange-600" id="externalOnboard">0</div><div class="text-sm text-gray-600">å¤–éƒ¨æµ·ä¸Šå¸«è³‡</div>
            </div>
            <div class="bg-white rounded-lg p-4 text-center shadow-sm">
              <div class="text-2xl font-bold text-green-600" id="externalOnshore">0</div><div class="text-sm text-gray-600">å¤–éƒ¨é™¸åœ°å¸«è³‡</div>
            </div>
          </div>
        </div>
        <div class="bg-white bg-opacity-70 rounded-xl p-6 shadow-sm">
          <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-2">ğŸ“š</span>èª²ç¨‹çµ±è¨ˆåˆ†æ</h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-white rounded-lg p-4 shadow-sm text-center">
              <div class="text-3xl font-bold text-indigo-600" id="totalSubjects">0</div>
              <div class="text-sm text-gray-600 mt-1">ç¸½èª²ç¨‹æ•¸</div>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm text-center">
              <div class="text-3xl font-bold text-purple-600" id="avgSubjectsPerTeacher">0</div>
              <div class="text-sm text-gray-600 mt-1">å¹³å‡æ¯äººèª²ç¨‹æ•¸</div>
            </div>
            <div class="bg-white rounded-lg p-4 shadow-sm text-center">
              <div class="text-3xl font-bold text-orange-600" id="uniqueSubjects">0</div>
              <div class="text-sm text-gray-600 mt-1">ä¸é‡è¤‡èª²ç¨‹æ•¸</div>
            </div>
          </div>
          <div class="mt-6">
            <h4 class="text-lg font-semibold text-gray-700 mb-3">ç†±é–€èª²ç¨‹æ’è¡Œ</h4>
            <div id="popularSubjects" class="space-y-2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- è¡Œäº‹æ›†è¦–åœ–ï¼ˆæ–°æ¨£å¼ï¼‰ -->
<div id="calendarView" class="hidden">
  <div class="gradient-bg min-h-full">
    <div class="container mx-auto p-8 max-w-7xl">
      <!-- æ¨™é¡Œå’Œæ§åˆ¶é … -->
      <div class="glass-effect rounded-2xl shadow-2xl p-8 mb-8">
        <div class="flex justify-between items-center mb-6">
          <h1 class="text-4xl font-bold flex items-center">
            <span class="text-4xl mr-3">ğŸ“…</span>
            <span class="bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">è¡Œäº‹æ›†</span>
          </h1>
          <div class="flex items-center gap-3">
            <button onclick="openAddEventModal()" class="btn-primary text-white px-8 py-3 rounded-xl font-semibold shadow-lg">
              âœ¨ æ–°å¢äº‹ä»¶
            </button>
            <button onclick="backToListFromCalendar()" class="bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl">
              â† è¿”å›å¸«è³‡ç®¡ç†
            </button>
          </div>
        </div>

        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-6">
            <button onclick="previousPeriod()" class="bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl hover:transform hover:-translate-y-1">
              â† <span id="prevLabel">ä¸Šå€‹æœˆ</span>
            </button>
            <h2 id="currentMonth" class="text-2xl font-bold text-gray-800 min-w-[200px] text-center"></h2>
            <button onclick="nextPeriod()" class="bg-white bg-opacity-80 hover:bg-opacity-100 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl hover:transform hover:-translate-y-1">
              <span id="nextLabel">ä¸‹å€‹æœˆ</span> â†’
            </button>
          </div>
          <div class="flex items-center space-x-4">
            <div class="flex bg-white bg-opacity-60 rounded-xl p-2 shadow-lg">
              <button id="monthViewBtn" onclick="setViewMode('month')" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-md">
                ğŸ“… æœˆæª¢è¦–
              </button>
              <button id="weekViewBtn" onclick="setViewMode('week')" class="px-4 py-2 rounded-lg text-sm font-semibold transition-all text-gray-600 hover:text-gray-800 hover:bg-white hover:bg-opacity-50">
                ğŸ“Š é€±æª¢è¦–
              </button>
            </div>
            <button onclick="goToToday()" class="bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white px-6 py-3 rounded-xl font-semibold transition-all shadow-lg hover:shadow-xl hover:transform hover:-translate-y-1">
              ğŸ¯ ä»Šå¤©
            </button>
          </div>
        </div>
      </div>

      <!-- ä»Šæ—¥æé†’ -->
      <div id="todayReminders" class="bg-gradient-to-r from-orange-400 via-red-500 to-pink-500 rounded-2xl shadow-2xl p-6 mb-8 text-white hidden">
        <div class="flex items-center mb-4">
          <span class="text-3xl mr-3 animate-bounce">â°</span>
          <h3 class="text-2xl font-bold">ä»Šæ—¥æé†’</h3>
        </div>
        <div id="remindersList" class="space-y-3"></div>
      </div>

      <!-- è¡Œäº‹æ›†ç¶²æ ¼ -->
      <div class="glass-effect rounded-2xl shadow-2xl overflow-hidden">
        <!-- æ˜ŸæœŸæ¨™é¡Œ -->
        <div class="grid grid-cols-7 bg-gradient-to-r from-purple-500 to-blue-500">
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">ğŸŒ…</span> æ—¥</div>
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">ğŸŒŸ</span> ä¸€</div>
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">ğŸ’«</span> äºŒ</div>
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">â­</span> ä¸‰</div>
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">âœ¨</span> å››</div>
          <div class="p-5 text-center font-bold text-white border-r border-white border-opacity-20"><span class="text-lg">ğŸŒ™</span> äº”</div>
          <div class="p-5 text-center font-bold text-white"><span class="text-lg">ğŸ‰</span> å…­</div>
        </div>
        <!-- æ—¥æœŸç¶²æ ¼ -->
        <div id="calendarGrid" class="grid grid-cols-7"></div>
      </div>
    </div>
  </div>

  <!-- æ–°å¢äº‹ä»¶å½ˆçª—ï¼ˆæ•´åˆå¸«è³‡/åœ°é»/å‚™è¨»ï¼‰ -->
  <div id="addEventModal" class="fixed inset-0 bg-black bg-opacity-60 modal-backdrop hidden flex items-center justify-center z-50">
    <div class="glass-effect rounded-2xl p-8 w-[480px] mx-4 shadow-2xl border border-white border-opacity-20">
      <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-6">âœ¨ æ–°å¢äº‹ä»¶</h3>
      <form onsubmit="addEventIntegrated(event)">
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2">ğŸ“ äº‹ä»¶æ¨™é¡Œ</label>
          <input type="text" id="eventTitle" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80" required>
        </div>
        <div class="mb-4 grid grid-cols-2 gap-3">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">ğŸ“… æ—¥æœŸ</label>
            <input type="date" id="eventDate" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80" required>
          </div>
          <div>
            <label class="block text-gray-700 font-semibold mb-2">â° æ™‚é–“</label>
            <input type="time" id="eventTime" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
          </div>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2">ğŸ‘©â€ğŸ« æŒ‡æ´¾å¸«è³‡ï¼ˆå¯é¸ï¼‰</label>
          <select id="eventTeacherId" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
            <option value="">ï¼ˆæœªæŒ‡æ´¾ï¼‰</option>
          </select>
        </div>
        <div class="mb-4">
          <label class="block text-gray-700 font-semibold mb-2">ğŸ“ åœ°é»</label>
          <input type="text" id="eventLocation" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80" placeholder="æœƒè­°å®¤ A / ç·šä¸Š">
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-2">ğŸ—’ï¸ å‚™è¨»</label>
          <textarea id="eventNote" rows="2" class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80"></textarea>
        </div>
        <div class="mb-6">
          <label class="block text-gray-700 font-semibold mb-3">ğŸ¨ é¡è‰²</label>
          <div class="flex space-x-3 justify-center">
            <button type="button" onclick="selectColor('bg-blue-500')" class="w-8 h-8 bg-blue-500 rounded-full border-2 border-transparent hover:border-white hover:shadow-lg transition-all"></button>
            <button type="button" onclick="selectColor('bg-green-500')" class="w-8 h-8 bg-green-500 rounded-full border-2 border-transparent hover:border-white hover:shadow-lg transition-all"></button>
            <button type="button" onclick="selectColor('bg-red-500')" class="w-8 h-8 bg-red-500 rounded-full border-2 border-transparent hover:border-white hover:shadow-lg transition-all"></button>
            <button type="button" onclick="selectColor('bg-purple-500')" class="w-8 h-8 bg-purple-500 rounded-full border-2 border-transparent hover:border-white hover:shadow-lg transition-all"></button>
            <button type="button" onclick="selectColor('bg-yellow-500')" class="w-8 h-8 bg-yellow-500 rounded-full border-2 border-transparent hover:border-white hover:shadow-lg transition-all"></button>
          </div>
        </div>
        <div class="flex space-x-4">
          <button type="button" onclick="closeAddEventModal()" class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-700 py-3 rounded-xl font-semibold transition-all shadow-md">
            âŒ å–æ¶ˆ
          </button>
          <button type="submit" class="flex-1 btn-primary text-white py-3 rounded-xl font-semibold shadow-lg">
            âœ… å„²å­˜
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

    <!-- æ´¾èª²ç®¡ç†è¦–åœ– -->
    <div id="courseManagementView" class="hidden fade-in">
      <div class="container mx-auto px-6 py-8 max-w-7xl">
        <!-- è¿”å›æŒ‰éˆ• + æ¨™é¡Œ -->
        <div class="flex justify-between items-center mb-8">
          <div>
            <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ“‹ æ´¾èª²ç®¡ç†ç³»çµ±</h1>
            <p class="text-gray-600">ç®¡ç†å¸«è³‡èª²ç¨‹åˆ†é…èˆ‡æ™‚æ•¸çµ±è¨ˆ</p>
          </div>
          <button onclick="backToListFromCourseManagement()" class="bg-white hover:bg-gray-50 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl border border-gray-200">
            â† è¿”å›å¸«è³‡åˆ—è¡¨
          </button>
        </div>

        <!-- å¸«è³‡é¸æ“‡èˆ‡æ—¥æœŸç¯„åœ -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">é¸æ“‡å¸«è³‡</label>
              <select id="courseTeacherSelect" onchange="updateCourseView()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
                <option value="">è«‹é¸æ“‡å¸«è³‡</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">é–‹å§‹æ—¥æœŸ</label>
              <input type="date" id="courseStartDate" onchange="updateCourseView()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
            </div>
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-2">çµæŸæ—¥æœŸ</label>
              <input type="date" id="courseEndDate" onchange="updateCourseView()" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
            </div>
          </div>
          <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mt-4">
            <button onclick="setCourseDateRange('thisMonth')" class="px-4 py-2 bg-blue-50 text-blue-600 rounded-lg hover:bg-blue-100 transition-colors text-sm font-medium">æœ¬æœˆ</button>
            <button onclick="setCourseDateRange('lastMonth')" class="px-4 py-2 bg-gray-50 text-gray-600 rounded-lg hover:bg-gray-100 transition-colors text-sm font-medium">ä¸Šæœˆ</button>
            <button onclick="setCourseDateRange('last3Months')" class="px-4 py-2 bg-purple-50 text-purple-600 rounded-lg hover:bg-purple-100 transition-colors text-sm font-medium">è¿‘3æœˆ</button>
            <button onclick="setCourseDateRange('last6Months')" class="px-4 py-2 bg-green-50 text-green-600 rounded-lg hover:bg-green-100 transition-colors text-sm font-medium">è¿‘åŠå¹´</button>
            <button onclick="setCourseDateRange('thisYear')" class="px-4 py-2 bg-orange-50 text-orange-600 rounded-lg hover:bg-orange-100 transition-colors text-sm font-medium">ä»Šå¹´</button>
          </div>
        </div>

        <!-- çµ±è¨ˆå¡ç‰‡ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
            <p class="text-sm opacity-90 mb-1">æˆèª²æ™‚æ•¸</p>
            <p id="courseTotalHours" class="text-4xl font-bold">0</p>
            <p class="text-xs opacity-75 mt-1">å°æ™‚</p>
          </div>

          <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                </svg>
              </div>
            </div>
            <p class="text-sm opacity-90 mb-1">èª²ç¨‹æ•¸é‡</p>
            <p id="courseTotalCount" class="text-4xl font-bold">0</p>
            <p class="text-xs opacity-75 mt-1">é–€èª²ç¨‹</p>
          </div>

          <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                </svg>
              </div>
            </div>
            <p class="text-sm opacity-90 mb-1">æœ¬æœˆæ™‚æ•¸</p>
            <p id="courseMonthlyHours" class="text-4xl font-bold">0</p>
            <p class="text-xs opacity-75 mt-1">å°æ™‚</p>
          </div>

          <div class="bg-gradient-to-br from-orange-500 to-orange-600 rounded-2xl p-6 text-white shadow-lg hover:shadow-xl transition-all hover:-translate-y-1">
            <div class="flex items-center justify-between mb-4">
              <div class="w-12 h-12 rounded-full bg-white bg-opacity-20 flex items-center justify-center">
                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                </svg>
              </div>
            </div>
            <p class="text-sm opacity-90 mb-1">ä»Šæ—¥èª²ç¨‹</p>
            <p id="courseTodayCount" class="text-4xl font-bold">0</p>
            <p class="text-xs opacity-75 mt-1">é–€èª²ç¨‹</p>
          </div>
        </div>

        <!-- èª²ç¨‹é¡å‹åˆ†æ (ç´” CSS å¡ç‰‡ï¼Œä¸ä½¿ç”¨ Canvas) -->
        <div class="bg-white rounded-2xl shadow-lg p-6 mb-8">
          <h3 class="text-lg font-semibold text-gray-800 mb-6">èª²ç¨‹é¡å‹åˆ†æ</h3>
          <div id="courseTypeCards" class="grid grid-cols-2 md:grid-cols-5 gap-4">
            <!-- èª²ç¨‹é¡å‹å¡ç‰‡å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
          </div>
        </div>

        <!-- è€å¸«æœ¬é€±èª²è¡¨ -->
        <div id="teacherWeekSchedule" class="bg-white rounded-2xl shadow-lg p-6 mb-8 hidden">
          <div class="flex justify-between items-center mb-6">
            <h3 class="text-lg font-semibold text-gray-800">ğŸ“… æœ¬é€±èª²è¡¨ - å³æ™‚æª¢è¦–å¯ç”¨æ™‚æ®µ</h3>
            <span class="text-sm text-gray-500">ç¶ è‰²ï¼šå¯ç”¨ | ç´…è‰²ï¼šå·²ä½”ç”¨</span>
          </div>
          <div id="teacherWeekScheduleContent" class="space-y-3">
            <!-- èª²è¡¨å…§å®¹å°‡ç”± JS å‹•æ…‹ç”Ÿæˆ -->
          </div>
        </div>

        <!-- æ–°å¢èª²ç¨‹æŒ‰éˆ•èˆ‡æ™‚é–“è»¸ -->
        <div class="flex justify-between items-center mb-6">
          <h3 class="text-lg font-semibold text-gray-800">èª²ç¨‹æ™‚é–“è»¸</h3>
          <button onclick="openAddCourseModal()" class="bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl flex items-center space-x-2">
            <span>â•</span><span>æ–°å¢èª²ç¨‹</span>
          </button>
        </div>

        <!-- èª²ç¨‹æ™‚é–“è»¸ -->
        <div class="bg-white rounded-2xl shadow-lg p-6">
          <div id="courseTimeline" class="space-y-4 max-h-[600px] overflow-y-auto">
            <div class="text-center text-gray-500 py-12">
              è«‹é¸æ“‡å¸«è³‡ä»¥æŸ¥çœ‹èª²ç¨‹
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- æ–°å¢èª²ç¨‹ Modal -->
    <div id="addCourseModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
      <div class="bg-white rounded-2xl p-8 max-w-md w-full mx-4 shadow-2xl">
        <h3 class="text-2xl font-bold text-gray-800 mb-6">æ–°å¢èª²ç¨‹</h3>
        <form id="addCourseForm" onsubmit="addCourseSubmit(event)" class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹åç¨±</label>
            <input type="text" id="addCourseName" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="è«‹è¼¸å…¥èª²ç¨‹åç¨±">
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹æ—¥æœŸ</label>
              <input type="date" id="addCourseDate" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">èª²ç¨‹é¡å‹</label>
              <select id="addCourseType" class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="æ­£èª²">æ­£èª²</option>
                <option value="è£œèª²">è£œèª²</option>
                <option value="å¯¦é©—èª²">å¯¦é©—èª²</option>
                <option value="å¯¦ä½œèª²">å¯¦ä½œèª²</option>
                <option value="å°ˆé¡Œ">å°ˆé¡Œ</option>
              </select>
            </div>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">é–‹å§‹æ™‚é–“</label>
              <input type="time" id="addCourseStartTime" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">çµæŸæ™‚é–“</label>
              <input type="time" id="addCourseEndTime" required class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            </div>
          </div>
          <div class="flex justify-end gap-3 pt-4">
            <button type="button" onclick="closeAddCourseModal()" class="px-6 py-3 bg-gray-200 hover:bg-gray-300 text-gray-700 rounded-xl font-medium transition-colors">å–æ¶ˆ</button>
            <button type="submit" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 hover:from-blue-700 hover:to-cyan-700 text-white rounded-xl font-medium transition-all shadow-lg">ç¢ºèªæ–°å¢</button>
          </div>
        </form>
      </div>
    </div>

    <!-- å¸«è³‡è©³ç´°ï¼ˆå‘ˆç¾æ¨¡å¼ï¼‰ -->
    <div id="teacherDetailView" class="hidden slide-in">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto">
        <button onclick="backToList()" class="mb-6 text-blue-600 hover:text-blue-800 font-medium flex items-center transition-colors">â† è¿”å›å¸«è³‡åˆ—è¡¨</button>
        <div id="teacherDetailContent"></div>
      </div>
    </div>

    <!-- å¸«è³‡è©³ç´°ï¼ˆç·¨è¼¯ï¼‰ -->
    <div id="teacherDetail" class="hidden slide-in">
      <div class="bg-white rounded-xl shadow-2xl p-8 max-w-4xl mx-auto">
        <button onclick="backToList()" class="mb-6 text-blue-600 hover:text-blue-800 font-medium flex items-center transition-colors">â† è¿”å›å¸«è³‡åˆ—è¡¨</button>
        <form id="teacherForm" class="space-y-6">
          <!-- åŸºæœ¬è³‡è¨Š -->
          <div class="bg-gray-50 p-6 rounded-lg">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">åŸºæœ¬è³‡è¨Š</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">å§“å *</label>
                <input type="text" id="teacherName" required class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                <input type="email" id="teacherEmail" placeholder="example@email.com" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all">
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-3">å¸«è³‡é¡å‹ *</label>
                <div class="flex space-x-4">
                  <label class="flex items-center cursor-pointer">
                    <input type="radio" name="teacherType" value="internal" id="typeInternal" class="sr-only">
                    <div class="teacher-type-option flex items-center space-x-3 px-6 py-4 border-2 border-gray-300 rounded-lg transition-all hover:border-blue-400 hover:bg-blue-50">
                      <div class="text-2xl">ğŸ‘¨â€ğŸ’¼</div>
                      <div><div class="font-medium text-gray-800">å…§éƒ¨å¸«è³‡</div><div class="text-sm text-gray-500">å…¬å¸å…§éƒ¨æ•™å¸«</div></div>
                    </div>
                  </label>
                  <label class="flex items-center cursor-pointer">
                    <input type="radio" name="teacherType" value="external" id="typeExternal" class="sr-only">
                    <div class="teacher-type-option flex items-center space-x-3 px-6 py-4 border-2 border-gray-300 rounded-lg transition-all hover:border-purple-400 hover:bg-purple-50">
                      <div class="text-2xl">ğŸ‘¨â€ğŸ“</div>
                      <div><div class="font-medium text-gray-800">å¤–éƒ¨å¸«è³‡</div><div class="text-sm text-gray-500">å¤–è˜å°ˆæ¥­æ•™å¸«</div></div>
                    </div>
                  </label>
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-3">å·¥ä½œåœ°é» *</label>
                <div class="flex space-x-4">
                  <label class="flex items-center cursor-pointer">
                    <input type="radio" name="workLocation" value="onboard" id="locationOnboard" class="sr-only">
                    <div class="location-option flex items-center space-x-3 px-6 py-4 border-2 border-gray-300 rounded-lg transition-all hover:border-orange-400 hover:bg-orange-50">
                      <div class="text-2xl">ğŸš¢</div><div><div class="font-medium text-gray-800">åœ¨èˆ¹</div><div class="text-sm text-gray-500">æµ·ä¸Šå·¥ä½œ</div></div>
                    </div>
                  </label>
                  <label class="flex items-center cursor-pointer">
                    <input type="radio" name="workLocation" value="onshore" id="locationOnshore" class="sr-only">
                    <div class="location-option flex items-center space-x-3 px-6 py-4 border-2 border-gray-300 rounded-lg transition-all hover:border-green-400 hover:bg-green-50">
                      <div class="text-2xl">ğŸ¢</div><div><div class="font-medium text-gray-800">åœ¨å²¸</div><div class="text-sm text-gray-500">é™¸åœ°å·¥ä½œ</div></div>
                    </div>
                  </label>
                </div>
              </div>

              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-2">ç…§ç‰‡</label>
                <div class="flex items-center space-x-4">
                  <div id="photoPreview" class="w-20 h-20 bg-gray-200 rounded-full flex items-center justify-center text-gray-500 text-2xl">ğŸ‘¤</div>
                  <input type="file" id="teacherPhoto" accept="image/*" class="hidden" onchange="previewPhoto(this)">
                  <button type="button" onclick="document.getElementById('teacherPhoto').click()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">é¸æ“‡ç…§ç‰‡</button>
                </div>
              </div>
            </div>
          </div>

          <!-- ç¶“æ­· -->
          <div class="bg-gray-50 p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-gray-800">å·¥ä½œç¶“æ­·</h3>
              <button type="button" onclick="addExperience()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">â• æ–°å¢ç¶“æ­·</button>
            </div>
            <div id="experienceList" class="space-y-3"></div>
          </div>

          <!-- è­‰æ›¸ -->
          <div class="bg-gray-50 p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-gray-800">è­‰æ›¸èˆ‡è³‡æ ¼</h3>
              <button type="button" onclick="addCertificate()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">â• æ–°å¢è­‰æ›¸</button>
            </div>
            <div id="certificateList" class="space-y-3"></div>
          </div>

          <!-- èª²ç¨‹ -->
          <div class="bg-gray-50 p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-gray-800">è¬›æˆèª²ç¨‹</h3>
              <button type="button" onclick="addSubject()" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg text-sm transition-colors">â• æ–°å¢èª²ç¨‹</button>
            </div>
            <div id="subjectList" class="space-y-3"></div>
          </div>

          <!-- Tags æ¨™ç±¤ -->
          <div class="bg-gray-50 p-6 rounded-lg">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-xl font-semibold text-gray-800">æ¨™ç±¤ Tags</h3>
              <button type="button" onclick="addTag()" class="bg-white hover:bg-gray-50 text-gray-700 px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 shadow-sm border border-gray-200 hover:shadow-md">
                ï¼‹ æ–°å¢æ¨™ç±¤
              </button>
            </div>
            <div id="tagList" class="flex flex-wrap gap-2 min-h-[60px] items-start"></div>
            <p class="text-sm text-gray-500 mt-3">æ¨™ç±¤å¯ç”¨æ–¼åˆ†é¡æˆ–æ¨™è¨˜å¸«è³‡ç‰¹è‰²ï¼Œä¾‹å¦‚ï¼šå°ˆæ¥­é ˜åŸŸã€èªè¨€èƒ½åŠ›ã€ç‰¹æ®ŠæŠ€èƒ½ç­‰</p>
          </div>

          <div class="flex justify-between pt-6">
            <button type="button" onclick="deleteTeacher()" id="deleteBtn" class="bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg font-medium transition-colors hidden">ğŸ—‘ï¸ åˆªé™¤å¸«è³‡</button>
            <div class="flex space-x-4 ml-auto">
              <button type="button" onclick="backToList()" class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-medium transition-colors">å–æ¶ˆ</button>
              <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-medium transition-colors">ğŸ’¾ å„²å­˜</button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- æµ·äº‹å°ˆæ¥­è¨“ç·´èª²ç¨‹ç³»çµ± -->
  <div id="maritimeCourseView" class="hidden fade-in">
    <div class="container mx-auto px-4 py-8">
      <!-- è¿”å›æŒ‰éˆ• + æ¨™é¡Œå€åŸŸ -->
      <div class="flex justify-between items-center mb-8">
        <header class="text-left">
          <h1 class="text-4xl font-bold text-purple-900 mb-2">æµ·äº‹å°ˆæ¥­è¨“ç·´èª²ç¨‹ç³»çµ±</h1>
          <p class="text-purple-600">Maritime Professional Training Course System</p>
        </header>
        <button onclick="backToListFromMaritimeCourse()" class="bg-white hover:bg-gray-50 text-gray-700 px-6 py-3 rounded-xl font-medium transition-all shadow-lg hover:shadow-xl border border-gray-200">
          â† è¿”å›å¸«è³‡åˆ—è¡¨
        </button>
      </div>

      <!-- å°èˆªé¸å–® -->
      <nav class="flex justify-center mb-8">
        <div class="bg-white rounded-lg shadow-md p-2 flex space-x-2">
          <button id="maritimeViewTab" class="px-6 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors">èª²ç¨‹ç€è¦½</button>
          <button id="maritimeEditTab" class="px-6 py-2 rounded-md text-blue-600 hover:bg-blue-50 font-medium transition-colors">èª²ç¨‹ç®¡ç†</button>
          <button id="maritimeStatsTab" class="px-6 py-2 rounded-md text-blue-600 hover:bg-blue-50 font-medium transition-colors">çµ±è¨ˆåˆ†æ</button>
        </div>
      </nav>

      <!-- èª²ç¨‹ç€è¦½é é¢ -->
      <div id="maritimeViewPage" class="fade-in">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">èª²ç¨‹æœå°‹</h2>
          <div class="flex flex-col md:flex-row gap-4">
            <input type="text" id="maritimeSearchInput" placeholder="è¼¸å…¥é—œéµå­—æœå°‹èª²ç¨‹..."
                   class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <select id="maritimeCategoryFilter" class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
              <option value="">æ‰€æœ‰åˆ†é¡</option>
              <option value="01">01èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™è¨“ç·´</option>
              <option value="02">02é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°ç®¡ç†</option>
              <option value="03">03äº‹æ•…æ¡ˆä¾‹åˆ†æèˆ‡æ‡‰è®Šè™•ç½®è¨“ç·´</option>
              <option value="04">04èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´</option>
              <option value="05">05åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒåˆè¦çŸ¥è­˜</option>
              <option value="06">06èˆ¹èˆ¶è²¨ç‰©è£å¸ä½œæ¥­å¯¦å‹™</option>
              <option value="07">07èˆ¹å“¡ç¶“é©—äº¤æµèˆ‡è·èƒ½å›é¥‹</option>
              <option value="08">08è·ç´šè½‰æ›èˆ‡å£“åŠ›èª¿é©</option>
              <option value="09">09å…¶ä»–</option>
            </select>
          </div>
        </div>

        <div id="maritimeCourseResults" class="grid gap-6 md:grid-cols-2 lg:grid-cols-3">
          <!-- èª²ç¨‹å¡ç‰‡å°‡åœ¨é€™è£¡é¡¯ç¤º -->
        </div>
      </div>

      <!-- èª²ç¨‹ç®¡ç†é é¢ -->
      <div id="maritimeEditPage" class="hidden">
        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">æ–°å¢/ç·¨è¼¯èª²ç¨‹</h2>
          <form id="maritimeCourseForm" class="space-y-4">
            <div>
              <label for="maritimeCourseName" class="block text-sm font-medium text-gray-700 mb-1">èª²ç¨‹åç¨±</label>
              <input type="text" id="maritimeCourseName" required
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
              <label for="maritimeCourseCategory" class="block text-sm font-medium text-gray-700 mb-1">èª²ç¨‹åˆ†é¡</label>
              <select id="maritimeCourseCategory" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">è«‹é¸æ“‡åˆ†é¡</option>
                <option value="01">01èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™è¨“ç·´</option>
                <option value="02">02é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°ç®¡ç†</option>
                <option value="03">03äº‹æ•…æ¡ˆä¾‹åˆ†æèˆ‡æ‡‰è®Šè™•ç½®è¨“ç·´</option>
                <option value="04">04èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´</option>
                <option value="05">05åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒåˆè¦çŸ¥è­˜</option>
                <option value="06">06èˆ¹èˆ¶è²¨ç‰©è£å¸ä½œæ¥­å¯¦å‹™</option>
                <option value="07">07èˆ¹å“¡ç¶“é©—äº¤æµèˆ‡è·èƒ½å›é¥‹</option>
                <option value="08">08è·ç´šè½‰æ›èˆ‡å£“åŠ›èª¿é©</option>
                <option value="09">09å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label for="maritimeCourseDescription" class="block text-sm font-medium text-gray-700 mb-1">èª²ç¨‹æè¿°</label>
              <textarea id="maritimeCourseDescription" rows="4" required
                        class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"></textarea>
            </div>
            <div>
              <label for="maritimeCourseMethod" class="block text-sm font-medium text-gray-700 mb-1">æˆèª²æ–¹å¼</label>
              <select id="maritimeCourseMethod" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                <option value="">è«‹é¸æ“‡æˆèª²æ–¹å¼</option>
                <option value="å¯¦é«”èª²ç¨‹">å¯¦é«”èª²ç¨‹</option>
                <option value="ç·šä¸Šèª²ç¨‹">ç·šä¸Šèª²ç¨‹</option>
                <option value="æ··åˆèª²ç¨‹">æ··åˆèª²ç¨‹</option>
              </select>
            </div>
            <div>
              <label for="maritimeCourseKeywords" class="block text-sm font-medium text-gray-700 mb-1">é—œéµå­—ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
              <input type="text" id="maritimeCourseKeywords" placeholder="ä¾‹å¦‚ï¼šå°èˆª,é›·é”,GPS,èˆ¹èˆ¶æ“ä½œ"
                     class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="flex gap-4">
              <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors">
                å„²å­˜èª²ç¨‹
              </button>
              <button type="button" id="maritimeCancelEdit" class="bg-gray-500 text-white px-6 py-2 rounded-lg hover:bg-gray-600 transition-colors">
                å–æ¶ˆ
              </button>
            </div>
          </form>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">å·²å»ºç«‹çš„èª²ç¨‹</h3>
          <div class="mb-4">
            <input type="text" id="maritimeManageSearchInput" placeholder="æœå°‹èª²ç¨‹é€²è¡Œç·¨è¼¯..."
                   class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
          </div>
          <div id="maritimeManageCourseList" class="space-y-3">
            <!-- èª²ç¨‹ç®¡ç†åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
          </div>
        </div>
      </div>

      <!-- çµ±è¨ˆåˆ†æé é¢ -->
      <div id="maritimeStatsPage" class="hidden">
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3 mb-6">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-2">ç¸½èª²ç¨‹æ•¸</h3>
            <p id="maritimeTotalCourses" class="text-3xl font-bold text-blue-600">0</p>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-2">æœ€ç†±é–€åˆ†é¡</h3>
            <p id="maritimePopularCategory" class="text-lg font-semibold text-green-600">-</p>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-bold text-gray-800 mb-2">ç¸½é—œéµå­—æ•¸</h3>
            <p id="maritimeTotalKeywords" class="text-3xl font-bold text-purple-600">0</p>
          </div>
        </div>

        <div class="grid gap-6 md:grid-cols-2 mb-6">
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">èª²ç¨‹çµ±è¨ˆ</h3>
            <div id="maritimeCategoryStats" class="space-y-3">
              <!-- åˆ†é¡çµ±è¨ˆå°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
          </div>
          <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">åˆ†é¡åˆ†å¸ƒåœ“é¤…åœ–</h3>
            <div class="chart-container">
              <div id="maritimePieChart" class="pie-chart"></div>
            </div>
            <div id="maritimeChartLegend" class="mt-4 space-y-2">
              <!-- åœ–ä¾‹å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6 mb-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">æˆèª²æ–¹å¼çµ±è¨ˆ</h3>
          <div id="maritimeMethodStats" class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- æˆèª²æ–¹å¼çµ±è¨ˆå°‡åœ¨é€™è£¡é¡¯ç¤º -->
          </div>
        </div>

        <div class="bg-white rounded-lg shadow-lg p-6">
          <h3 class="text-xl font-bold text-gray-800 mb-4">ç†±é–€é—œéµå­—</h3>
          <div id="maritimeKeywordCloud" class="flex flex-wrap gap-2">
            <!-- é—œéµå­—é›²å°‡åœ¨é€™è£¡é¡¯ç¤º -->
          </div>
        </div>
      </div>
    </div>

    <!-- æµ·äº‹èª²ç¨‹ç·¨è¼¯å½ˆè·³è¦–çª— -->
    <div id="maritimeCourseModal" class="fixed inset-0 bg-black bg-opacity-60 modal-backdrop hidden flex items-center justify-center z-50">
      <div class="glass-effect rounded-2xl p-8 w-[600px] mx-4 shadow-2xl border border-white border-opacity-20 max-h-[90vh] overflow-y-auto">
        <h3 class="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-6">
          <span id="maritimeModalTitle">âœ¨ ç·¨è¼¯èª²ç¨‹</span>
        </h3>
        <form id="maritimeCourseModalForm" onsubmit="saveMaritimeCourseFromModal(event)">
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2">ğŸ“ èª²ç¨‹åç¨±</label>
            <input type="text" id="maritimeCourseNameModal" required
                   class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2">ğŸ“š èª²ç¨‹åˆ†é¡</label>
            <select id="maritimeCourseCategoryModal" required
                    class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
              <option value="">è«‹é¸æ“‡åˆ†é¡</option>
              <option value="01">01èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™è¨“ç·´</option>
              <option value="02">02é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°ç®¡ç†</option>
              <option value="03">03äº‹æ•…æ¡ˆä¾‹åˆ†æèˆ‡æ‡‰è®Šè™•ç½®è¨“ç·´</option>
              <option value="04">04èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´</option>
              <option value="05">05åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒåˆè¦çŸ¥è­˜</option>
              <option value="06">06èˆ¹èˆ¶è²¨ç‰©è£å¸ä½œæ¥­å¯¦å‹™</option>
              <option value="07">07èˆ¹å“¡ç¶“é©—äº¤æµèˆ‡è·èƒ½å›é¥‹</option>
              <option value="08">08è·ç´šè½‰æ›èˆ‡å£“åŠ›èª¿é©</option>
              <option value="09">09å…¶ä»–</option>
            </select>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2">ğŸ“– èª²ç¨‹æè¿°</label>
            <textarea id="maritimeCourseDescriptionModal" rows="4" required
                      class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80"></textarea>
          </div>
          <div class="mb-4">
            <label class="block text-gray-700 font-semibold mb-2">ğŸ’» æˆèª²æ–¹å¼</label>
            <select id="maritimeCourseMethodModal" required
                    class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
              <option value="">è«‹é¸æ“‡æˆèª²æ–¹å¼</option>
              <option value="å¯¦é«”èª²ç¨‹">å¯¦é«”èª²ç¨‹</option>
              <option value="ç·šä¸Šèª²ç¨‹">ç·šä¸Šèª²ç¨‹</option>
              <option value="æ··åˆèª²ç¨‹">æ··åˆèª²ç¨‹</option>
            </select>
          </div>
          <div class="mb-6">
            <label class="block text-gray-700 font-semibold mb-2">ğŸ·ï¸ é—œéµå­—ï¼ˆç”¨é€—è™Ÿåˆ†éš”ï¼‰</label>
            <input type="text" id="maritimeCourseKeywordsModal" placeholder="ä¾‹å¦‚ï¼šå°èˆª,é›·é”,GPS,èˆ¹èˆ¶æ“ä½œ"
                   class="w-full border-2 border-gray-200 rounded-xl px-4 py-3 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all bg-white bg-opacity-80">
          </div>
          <!-- åˆªé™¤æŒ‰éˆ•ï¼ˆåƒ…ç·¨è¼¯æ™‚é¡¯ç¤ºï¼‰-->
          <div id="maritimeDeleteButtonContainer" style="display: none; margin-bottom: 16px;">
            <button type="button" onclick="deleteMaritimeCourseFromModal()"
                    style="width: 100%; background: #ff3b30; color: white; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='#ff2d1f'"
                    onmouseout="this.style.background='#ff3b30'">
              åˆªé™¤èª²ç¨‹
            </button>
          </div>

          <!-- å–æ¶ˆå’Œå„²å­˜æŒ‰éˆ• -->
          <div class="flex space-x-4">
            <button type="button" onclick="closeMaritimeCourseModal()"
                    style="flex: 1; background: #f5f5f7; color: #1d1d1f; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='#e5e5ea'"
                    onmouseout="this.style.background='#f5f5f7'">
              å–æ¶ˆ
            </button>
            <button type="submit"
                    style="flex: 1; background: #007aff; color: white; border: none; padding: 14px; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: all 0.3s;"
                    onmouseover="this.style.background='#0051d5'"
                    onmouseout="this.style.background='#007aff'">
              å„²å­˜
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- ====== å¾Œç«¯ API è¨­å®š / å·¥å…· ====== -->
  <script>
    /* === ä½¿ç”¨æ–°çš„ API å±¤ï¼ˆjs/api.jsï¼‰ === */

    /* ---------- æª”æ¡ˆä¸Šå‚³ï¼ˆä½¿ç”¨æ–°çš„ APIï¼‰ ---------- */
    async function apiUploadToDrive(file){
      if(!api || !api.uploadFile) throw new Error('API æœªåˆå§‹åŒ–');
      if(file.size > 30*1024*1024) throw new Error('æª”æ¡ˆå¤§å°ä¸èƒ½è¶…é 30MB');

      try {
        const result = await api.uploadFile(file, file.name);
        return result; // {ok,id,url,name,size,mime}
      } catch (error) {
        throw new Error(error.message || 'ä¸Šå‚³å¤±æ•—');
      }
    }

    /* ---------- API é€£ç·šæª¢æŸ¥ ---------- */
    const API_STATUS_CLASSES = {
      idle: 'status-badge bg-gray-100 text-gray-600 border-gray-200',
      checking: 'status-badge bg-amber-100 text-amber-700 border-amber-200',
      success: 'status-badge bg-green-100 text-green-700 border-green-200',
      error: 'status-badge bg-red-100 text-red-700 border-red-200'
    };

    const API_STATUS_TEXT = {
      idle: 'å°šæœªæª¢æŸ¥',
      checking: 'æª¢æ¸¬ä¸­',
      success: 'æ­£å¸¸',
      error: 'å¤±æ•—'
    };

    let apiStatusLastChecked = null;

    function formatDateTimeForStatus(date) {
      if (!(date instanceof Date) || Number.isNaN(date.getTime())) return '';
      return date.toLocaleString('zh-TW', { hour12: false });
    }

    function updateApiStatusUI(state, message, detail = '') {
      const badge = document.getElementById('apiStatusBadge');
      const messageEl = document.getElementById('apiStatusMessage');
      const detailEl = document.getElementById('apiStatusDetail');
      if (!badge || !messageEl || !detailEl) return;

      const badgeClass = API_STATUS_CLASSES[state] || API_STATUS_CLASSES.idle;
      badge.className = badgeClass;
      badge.textContent = API_STATUS_TEXT[state] || API_STATUS_TEXT.idle;

      messageEl.textContent = message;

      if (detail) {
        detailEl.textContent = detail;
        detailEl.classList.remove('hidden');
      } else {
        detailEl.textContent = '';
        detailEl.classList.add('hidden');
      }
    }

    function setApiStatusButtonLoading(isLoading) {
      const button = document.getElementById('apiStatusButton');
      if (!button) return;

      if (isLoading) {
        button.disabled = true;
        button.classList.add('opacity-60', 'cursor-not-allowed');
        button.innerHTML = '<span class="mr-2">â³</span>æª¢æ¸¬ä¸­...';
      } else {
        button.disabled = false;
        button.classList.remove('opacity-60', 'cursor-not-allowed');
        button.innerHTML = '<span class="mr-2">ğŸ©º</span>æ¸¬è©¦ API é€£ç·š';
      }
    }

    function buildBaseDetailMessage() {
      if (typeof API_CONFIG !== 'undefined' && API_CONFIG?.baseUrl) {
        return `ç›®å‰è¨­å®šçš„ API URLï¼š${API_CONFIG.baseUrl}`;
      }
      return 'è«‹å…ˆå®Œæˆ Google Apps Script éƒ¨ç½²ä¸¦è¨­å®šå…è¨±æ­¤ç¶²åŸŸå­˜å–ã€‚';
    }

    function setupApiStatusUI() {
      updateApiStatusUI('idle', 'å°šæœªæª¢æŸ¥ API é€£ç·šç‹€æ…‹', buildBaseDetailMessage());
    }

    async function handleApiStatusCheck(manual = false) {
      if (typeof api === 'undefined' || !api?.ping) {
        updateApiStatusUI('error', 'API å°šæœªåˆå§‹åŒ–', 'è«‹ç¢ºèª js/api.js å·²æ­£ç¢ºè¼‰å…¥ã€‚');
        if (manual) {
          showSyncStatus('âŒ API å°šæœªåˆå§‹åŒ–ï¼Œè«‹æª¢æŸ¥ js/api.js æ˜¯å¦è¼‰å…¥æˆåŠŸ', 'error');
        }
        return;
      }

      setApiStatusButtonLoading(true);
      updateApiStatusUI('checking', 'æ­£åœ¨æ¸¬è©¦ API é€£ç·š...', 'è«‹ç¨å€™ï¼Œé€šå¸¸æœƒåœ¨ 1 ç§’å…§å®Œæˆæª¢æŸ¥ã€‚');

      const startedAt = performance.now();

      try {
        const result = await api.ping();

        if (!result?.ok) {
          throw new Error(result?.error || 'API å›æ‡‰æœªæ¨™ç¤º ok');
        }

        const elapsed = Math.round(performance.now() - startedAt);
        apiStatusLastChecked = new Date();

        const detailParts = [
          `æœ€å¾Œæª¢æŸ¥æ™‚é–“ï¼š${formatDateTimeForStatus(apiStatusLastChecked)}`,
          `å»¶é²ï¼šç´„ ${elapsed} ms`
        ];

        if (result?.timestamp) {
          const serverTime = formatDateTimeForStatus(new Date(result.timestamp));
          if (serverTime) {
            detailParts.push(`ä¼ºæœå™¨æ™‚é–“ï¼š${serverTime}`);
          }
        }

        if (typeof API_CONFIG !== 'undefined' && API_CONFIG?.baseUrl) {
          detailParts.push(`ç›®å‰ API URLï¼š${API_CONFIG.baseUrl}`);
        }

        updateApiStatusUI('success', 'API é€£ç·šæ­£å¸¸', detailParts.join('ï½œ'));

        if (manual) {
          showSyncStatus('âœ… API é€£ç·šæ­£å¸¸', 'success');
        }
      } catch (error) {
        const errorMessage = error?.message || String(error);
        const detailParts = [`åŸå› ï¼š${errorMessage}`];

        if (typeof API_CONFIG !== 'undefined' && API_CONFIG?.baseUrl) {
          detailParts.push(`ç›®å‰ API URLï¼š${API_CONFIG.baseUrl}`);
        }

        updateApiStatusUI('error', 'API é€£ç·šå¤±æ•—', detailParts.join('ï½œ'));

        if (manual) {
          showSyncStatus(`âŒ API é€£ç·šå¤±æ•—ï¼š${errorMessage}`, 'error');
        }
      } finally {
        setApiStatusButtonLoading(false);
      }
    }

    window.checkApiStatus = handleApiStatusCheck;

    /* ---------- æ­£å¸¸åŒ– ---------- */
    function normalize(list){
      if (!Array.isArray(list)) return [];
      const toStr = v => (v == null ? '' : String(v));
      const arrStr = a => Array.isArray(a) ? a.map(toStr).filter(Boolean) : [];
      return list.map(t => ({
        id: t?.id ?? Date.now(),
        name: toStr(t?.name),
        email: toStr(t?.email),
        teacherType: (t?.teacherType === 'external' ? 'external' : 'internal'),
        workLocation: (t?.workLocation === 'onboard' ? 'onboard' : 'onshore'),
        photo: toStr(t?.photo), // URLï¼ˆDriveï¼‰
        experiences: arrStr(t?.experiences),
        certificates: Array.isArray(t?.certificates)
          ? t.certificates.map(c => (typeof c === 'string'
              ? toStr(c)
              : { name: toStr(c?.name), fileName: toStr(c?.fileName), fileUrl: toStr(c?.fileUrl) }
            )).filter(x => (typeof x === 'string' ? x : x.name))
          : [],
        subjects: arrStr(t?.subjects),
        tags: arrStr(t?.tags), 
      }));
    }
    const initial = name => (String(name ?? '').trim()[0] || '?');

    /* ---------- ç‹€æ…‹ ---------- */
    let teachers = normalize(JSON.parse(localStorage.getItem('teachers') || '[]'));
    let currentTeacherId = null;
    let draggedElement = null;
    let filteredTeachers = [];
    window.currentMode = 'edit';

    /* ---------- éœé»˜åŒæ­¥ï¼ˆ0.1ç§’ï¼‰ ---------- */
    const SYNC_DEBOUNCE_MS = 100;
    let syncTimer = null, syncing = false, syncAgain = false;

    function slimForLocal(items){
      return (items||[]).map(t=>({
        id:t.id, name:t.name, email:t.email,
        teacherType:t.teacherType, workLocation:t.workLocation,
        photo:t.photo, experiences:t.experiences||[],
        certificates:(t.certificates||[]).map(c=> typeof c==='string' ? c : ({name:c.name,fileName:c.fileName,fileUrl:c.fileUrl})),
        subjects:t.subjects||[]
      }));
    }
    function saveLocalSilently(){
      try{
        localStorage.setItem('teachers', JSON.stringify(slimForLocal(teachers)));
      }catch(err){
        console.warn('localStorage è¶…é¡ï¼Œå·²æ”¹å­˜æœ€å°è³‡è¨Šï¼š', err);
        try{
          const min = teachers.map(t=>({id:t.id,name:t.name,teacherType:t.teacherType,workLocation:t.workLocation}));
          localStorage.setItem('teachers', JSON.stringify(min));
        }catch(e){}
      }
    }

    function scheduleCloudSave(){
      if(!api) return;
      if(syncTimer) clearTimeout(syncTimer);
      syncTimer = setTimeout(doCloudSave, SYNC_DEBOUNCE_MS);
    }
    async function doCloudSave(){
      if(syncing){ syncAgain=true; return; }
      syncing = true;
      try{
        await api.save('teachers', teachers);
        console.log('âœ… å¸«è³‡è³‡æ–™å·²åŒæ­¥åˆ°é›²ç«¯');
      }catch(e){
        console.warn('é›²ç«¯éœé»˜ä¸Šå‚³å¤±æ•—ï¼š', e);
      }finally{
        syncing=false;
        if(syncAgain){ syncAgain=false; scheduleCloudSave(); }
      }
    }

    async function cloudLoadSilent(){
      if(!api) return null;
      try{
        const data = await api.list('teachers');
        return Array.isArray(data) ? data : null;
      }catch(e){
        console.warn('é›²ç«¯éœé»˜è¼‰å…¥å¤±æ•—ï¼š', e);
      }
      return null;
    }

    /* ---------- å•Ÿå‹• ---------- */
    document.addEventListener('DOMContentLoaded', async () => {
      setupApiStatusUI();
      handleApiStatusCheck(false);

      renderTeacherGrid();
      setupLocationSelection();

      const cloud = await cloudLoadSilent();
      if(Array.isArray(cloud)){
        teachers = normalize(cloud);
        saveLocalSilently();
        renderTeacherGrid();
      }

      // âœ¨ é‡è¦ï¼šå¾ localStorage é‡æ–°è¼‰å…¥æ´¾èª²å’Œæµ·äº‹èª²ç¨‹æ•¸æ“š
      // å› ç‚º cloudLoadSilent() å¯èƒ½å·²ç¶“é€šé syncManager æ›´æ–°äº† localStorage
      console.log('ğŸ”„ é‡æ–°è¼‰å…¥æ´¾èª²å’Œæµ·äº‹èª²ç¨‹æ•¸æ“š...');
      const localCourses = localStorage.getItem('courseAssignments');
      const localMaritime = localStorage.getItem('maritimeCourses');

      if (localCourses) {
        courseAssignments = JSON.parse(localCourses);
        console.log('ğŸ“¦ å¾ localStorage è¼‰å…¥æ´¾èª²æ•¸æ“šï¼Œå…±', courseAssignments.length, 'ç­†');
      }

      if (localMaritime) {
        maritimeCourses = JSON.parse(localMaritime);
        console.log('ğŸ“¦ å¾ localStorage è¼‰å…¥æµ·äº‹èª²ç¨‹æ•¸æ“šï¼Œå…±', maritimeCourses.length, 'ç­†');
      }

      // å†æ¬¡å˜—è©¦å¾å¾Œç«¯è¼‰å…¥ï¼ˆå¦‚æœæœ‰æ›´æ–°çš„æ•¸æ“šï¼‰
      await loadCourseAssignmentsFromBackend();
      await loadMaritimeCoursesFromBackend();

      // åŒæ­¥åˆ°è¡Œäº‹æ›†
      if (courseAssignments.length > 0) {
        console.log('ğŸ“… åŒæ­¥æ´¾èª²æ•¸æ“šåˆ°è¡Œäº‹æ›†...');
        syncCourseAssignmentsToCalendar();
      }
    });

    /* ---------- äº’å‹• ---------- */
    function setupLocationSelection() {
      document.addEventListener('change', function(e) {
        if (e.target.name === 'workLocation') {
          document.querySelectorAll('.location-option').forEach(o=>o.classList.remove('selected','onboard','onshore'));
          e.target.closest('label').querySelector('.location-option').classList.add('selected', e.target.value);
        }
        if (e.target.name === 'teacherType') {
          document.querySelectorAll('.teacher-type-option').forEach(o=>o.classList.remove('selected','internal','external'));
          e.target.closest('label').querySelector('.teacher-type-option').classList.add('selected', e.target.value);
        }
      });
    }

    window.switchMode = function switchMode(mode){
      window.currentMode = mode;
      const editBtn = document.getElementById('editModeBtn');
      const displayBtn = document.getElementById('displayModeBtn');
      const addBtn = document.getElementById('addTeacherBtn');
      const modeDescription = document.getElementById('modeDescription');

      if (mode === 'edit') {
        editBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-all bg-blue-600 text-white';
        displayBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-600 hover:text-gray-800';
        addBtn.classList.remove('hidden');
        modeDescription.innerHTML = `
          <div class="flex items-center space-x-2">
            <span class="text-blue-600">â„¹ï¸</span>
            <span class="text-blue-700 text-sm font-medium">ç·¨è¼¯æ¨¡å¼ï¼šå¯ä»¥æ–°å¢ã€ç·¨è¼¯ã€åˆªé™¤ã€è¤‡è£½å’Œæ’åºå¸«è³‡</span>
          </div>`;
        modeDescription.className = 'bg-blue-50 border border-blue-200 rounded-lg p-3';
      } else {
        editBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-all text-gray-600 hover:text-gray-800';
        displayBtn.className = 'px-4 py-2 rounded-md text-sm font-medium transition-all bg-green-600 text-white';
        addBtn.classList.add('hidden');
        modeDescription.innerHTML = `
          <div class="flex items-center space-x-2">
            <span class="text-green-600">ğŸ‘ï¸</span>
            <span class="text-green-700 text-sm font-medium">å‘ˆç¾æ¨¡å¼ï¼šä»¥ç¾è§€çš„æ–¹å¼å±•ç¤ºå¸«è³‡é™£å®¹ï¼Œé©åˆå°å¤–å±•ç¤º</span>
          </div>`;
        modeDescription.className = 'bg-green-50 border border-green-200 rounded-lg p-3';
      }
      renderTeacherGrid();
    }

    function renderTeacherGrid(teachersToRender = null) {
      const grid = document.getElementById('teacherGrid');
      grid.innerHTML = '';
      grid.className = currentMode==='edit'
        ? 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6'
        : 'grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8';

      const displayTeachers = teachersToRender || teachers;
      if (displayTeachers.length === 0) {
        const searchInput = document.getElementById('searchInput');
        const isSearching = searchInput && searchInput.value.trim() !== '';
        grid.innerHTML = isSearching ? `
          <div class="col-span-full text-center py-12">
            <div class="text-6xl mb-4">ğŸ”</div>
            <h3 class="text-xl font-medium text-gray-600 mb-2">æ‰¾ä¸åˆ°ç¬¦åˆçš„å¸«è³‡</h3>
            <p class="text-gray-500">è«‹å˜—è©¦å…¶ä»–é—œéµå­—æˆ–æ¸…é™¤æœå°‹æ¢ä»¶</p>
          </div>` : `
          <div class="col-span-full text-center py-12">
            <div class="text-6xl mb-4">ğŸ‘¨â€ğŸ«</div>
            <h3 class="text-xl font-medium text-gray-600 mb-2">å°šæœªæ–°å¢ä»»ä½•å¸«è³‡</h3>
            <p class="text-gray-500">é»æ“Šä¸Šæ–¹ã€Œæ–°å¢å¸«è³‡ã€æŒ‰éˆ•é–‹å§‹å»ºç«‹æ‚¨çš„å¸«è³‡é™£å®¹</p>
          </div>`;
        return;
      }

      displayTeachers.forEach((teacher, index) => {
        const card = document.createElement('div');

        if (currentMode === 'edit') {
          card.className = 'bg-white rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 cursor-pointer transform hover:-translate-y-1 group';
          card.draggable = true;
          card.dataset.teacherId = teacher.id;
          card.dataset.index = index;
          card.onclick = () => editTeacher(teacher.id);
          card.addEventListener('dragstart', handleDragStart);
          card.addEventListener('dragover', handleDragOver);
          card.addEventListener('drop', handleDrop);
          card.addEventListener('dragend', handleDragEnd);
          card.innerHTML = `
            <div class="p-4 text-center relative">
              <div class="absolute top-2 left-2 flex flex-col space-y-1">
                ${teacher.teacherType==='internal' ? `
                  <div class="bg-blue-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                    <span>ğŸ‘¨â€ğŸ’¼</span><span>å…§éƒ¨</span>
                  </div>` : `
                  <div class="bg-purple-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                    <span>ğŸ‘¨â€ğŸ“</span><span>å¤–éƒ¨</span>
                  </div>`}
                ${teacher.workLocation==='onboard' ? `
                  <div class="bg-orange-500 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                    <span>ğŸš¢</span><span>åœ¨èˆ¹</span>
                  </div>` : `
                  <div class="bg-green-600 text-white px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                    <span>ğŸ¢</span><span>åœ¨å²¸</span>
                  </div>`}
              </div>
              <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-gradient-to-br from-blue-400 to-purple-500 flex items-center justify-center text-white text-xl font-bold overflow-hidden">
                ${teacher.photo ? `<img src="${teacher.photo}" class="w-full h-full object-cover rounded-full">` : initial(teacher.name)}
              </div>
              <h3 class="text-lg font-semibold text-gray-800">${teacher.name}</h3>
              <div class="mt-1 text-sm ${teacher.workLocation==='onboard'?'text-orange-600':'text-green-600'} font-medium">
                ${teacher.workLocation==='onboard'?'ğŸš¢ æµ·ä¸Šå·¥ä½œ':'ğŸ¢ é™¸åœ°å·¥ä½œ'}
              </div>
              <div class="mt-2 text-xs text-gray-500 cursor-move">â‹®â‹® æ‹–æ‹½æ’åº</div>
              <button onclick="event.stopPropagation(); copyTeacher(${teacher.id})"
                class="absolute top-2 right-2 bg-green-500 hover:bg-green-600 text-white p-2 rounded-full text-xs transition-colors shadow-lg opacity-0 group-hover:opacity-100" title="è¤‡è£½å¸«è³‡">ğŸ“‹</button>
            </div>`;
        } else {
          const isInternal = teacher.teacherType === 'internal';
          const bgGradient = isInternal ? 'from-blue-50 to-indigo-50' : 'from-purple-50 to-pink-50';
          const titleColor = isInternal ? 'text-blue-800' : 'text-purple-800';
          const categoryTitle = isInternal ? 'å…¬å¸å…§éƒ¨è¬›å¸«' : 'å¤–è˜å°ˆæ¥­è¬›å¸«';
          const categoryIcon = isInternal ? 'ğŸ‘¨â€ğŸ’¼' : 'ğŸ‘¨â€ğŸ“';
          const categoryBadgeColor = isInternal ? 'bg-blue-500' : 'bg-purple-500';
          card.className = 'bg-white rounded-2xl shadow-lg hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1 overflow-hidden cursor-pointer';
          card.onclick = () => viewTeacherDetail(teacher.id);
          card.innerHTML = `
            <div class="relative p-8 bg-gradient-to-br ${bgGradient} text-center">
              <div class="absolute top-3 right-3">
                <div class="${categoryBadgeColor} text-white px-3 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                  <span>${categoryIcon}</span><span>${categoryTitle}</span>
                </div>
              </div>
              <div class="w-20 h-20 mx-auto mb-4 rounded-full ${isInternal?'bg-gradient-to-br from-blue-400 to-indigo-500':'bg-gradient-to-br from-purple-400 to-pink-500'} p-1 shadow-lg">
                <div class="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden">
                  ${teacher.photo ? `<img src="${teacher.photo}" class="w-full h-full object-cover rounded-full">` : `<span class="text-xl font-bold text-gray-600">${initial(teacher.name)}</span>`}
                </div>
              </div>
              <h3 class="text-2xl font-bold ${titleColor} mb-2">${teacher.name}</h3>
              <div class="text-sm ${teacher.workLocation==='onboard'?'text-orange-600':'text-green-600'} font-medium mb-2">
                ${teacher.workLocation==='onboard'?'ğŸš¢ æµ·ä¸Šå·¥ä½œ':'ğŸ¢ é™¸åœ°å·¥ä½œ'}
              </div>
              <div class="text-xs text-gray-500 opacity-70">é»æ“ŠæŸ¥çœ‹è©³ç´°è³‡æ–™</div>
            </div>`;
        }
        grid.appendChild(card);
      });
    }

    function addNewTeacher(){
      currentTeacherId = null;
      document.getElementById('teacherList').classList.add('hidden');
      document.getElementById('teacherDetail').classList.remove('hidden');
      document.getElementById('deleteBtn').classList.add('hidden');
      document.getElementById('teacherForm').reset();
      const photoBox = document.getElementById('photoPreview');
      photoBox.innerHTML = 'ğŸ‘¤'; photoBox.removeAttribute('data-url');
      document.getElementById('experienceList').innerHTML = '';
      document.getElementById('certificateList').innerHTML = '';
      document.getElementById('subjectList').innerHTML = '';
      document.getElementById('tagList').innerHTML = '';
      document.querySelectorAll('.location-option').forEach(o=>o.classList.remove('selected','onboard','onshore'));
      document.querySelectorAll('.teacher-type-option').forEach(o=>o.classList.remove('selected','internal','external'));
      addExperience(); addCertificate(); addSubject(); addTag();
    }

    function editTeacher(teacherId){
      const teacher = teachers.find(t=>t.id===teacherId); if(!teacher) return;
      currentTeacherId = teacherId;
      document.getElementById('teacherList').classList.add('hidden');
      document.getElementById('teacherDetail').classList.remove('hidden');
      document.getElementById('deleteBtn').classList.remove('hidden');
      document.getElementById('teacherName').value = teacher.name;
      document.getElementById('teacherEmail').value = teacher.email || '';
      const teacherType = teacher.teacherType || 'internal';
      document.getElementById(teacherType==='internal'?'typeInternal':'typeExternal').checked = true;
      const workLocation = teacher.workLocation || 'onshore';
      document.getElementById(workLocation==='onboard'?'locationOnboard':'locationOnshore').checked = true;

      document.querySelectorAll('.teacher-type-option').forEach(o=>o.classList.remove('selected','internal','external'));
      document.querySelector(`input[value="${teacherType}"]`).closest('label').querySelector('.teacher-type-option').classList.add('selected',teacherType);
      document.querySelectorAll('.location-option').forEach(o=>o.classList.remove('selected','onboard','onshore'));
      document.querySelector(`input[value="${workLocation}"]`).closest('label').querySelector('.location-option').classList.add('selected',workLocation);

      const photoBox = document.getElementById('photoPreview');
      if (teacher.photo){
        photoBox.innerHTML = `<img src="${teacher.photo}" class="w-full h-full object-cover rounded-full">`;
        photoBox.setAttribute('data-url', teacher.photo);
      }else{
        photoBox.innerHTML = 'ğŸ‘¤'; photoBox.removeAttribute('data-url');
      }

      document.getElementById('experienceList').innerHTML = '';
      (teacher.experiences||[]).forEach(exp=>addExperience(exp));
      document.getElementById('certificateList').innerHTML = '';
      (teacher.certificates||[]).forEach(cert=>{
        if (typeof cert === 'string') addCertificate(cert);
        else addCertificate(cert.name||'', cert.fileName||'', cert.fileUrl||'');
      });
      document.getElementById('subjectList').innerHTML = '';
      (teacher.subjects||[]).forEach(s=>addSubject(s));
      document.getElementById('tagList').innerHTML = '';
      (teacher.tags||[]).forEach(t=>addTag(t));
    }

    function viewTeacherDetail(teacherId){
      const teacher = teachers.find(t=>t.id===teacherId); if(!teacher) return;
      document.getElementById('teacherList').classList.add('hidden');
      document.getElementById('teacherDetailView').classList.remove('hidden');
      const isInternal = teacher.teacherType==='internal';
      const bgGradient = isInternal?'from-blue-50 to-indigo-50':'from-purple-50 to-pink-50';
      const titleColor = isInternal?'text-blue-800':'text-purple-800';
      const categoryTitle = isInternal?'å…¬å¸å…§éƒ¨è¬›å¸«':'å¤–è˜å°ˆæ¥­è¬›å¸«';
      const categoryIcon = isInternal?'ğŸ‘¨â€ğŸ’¼':'ğŸ‘¨â€ğŸ“';
      const categoryBadgeColor = isInternal?'bg-blue-500':'bg-purple-500';

      const content = document.getElementById('teacherDetailContent');
      content.innerHTML = `
        <div class="bg-gradient-to-br ${bgGradient} rounded-2xl p-8 mb-8 relative overflow-hidden">
          <div class="relative z-10 flex flex-col md:flex-row items-center md:items-start space-y-6 md:space-y-0 md:space-x-8">
            <div class="w-32 h-32 rounded-full ${isInternal?'bg-gradient-to-br from-blue-400 to-indigo-500':'bg-gradient-to-br from-purple-400 to-pink-500'} p-2 shadow-xl">
              <div class="w-full h-full rounded-full bg-white flex items-center justify-center overflow-hidden">
                ${teacher.photo ? `<img src="${teacher.photo}" class="w-28 h-28 object-cover rounded-full">` : `<span class="text-4xl font-bold text-gray-600">${initial(teacher.name)}</span>`}
              </div>
            </div>
            <div class="flex-1 text-center md:text-left">
              <div class="mb-4">
                <div class="${categoryBadgeColor} text-white px-4 py-2 rounded-full text-sm font-medium inline-flex items-center space-x-2">
                  <span>${categoryIcon}</span><span>${categoryTitle}</span>
                </div>
              </div>
              <h1 class="text-4xl font-bold ${titleColor} mb-3">${teacher.name}</h1>
              <div class="space-y-2 text-lg">
                ${teacher.email ? `<div class="flex items-center justify-center md:justify-start space-x-2"><span class="text-gray-600">ğŸ“§</span><span class="text-gray-700">${teacher.email}</span></div>` : ''}
                <div class="flex items-center justify-center md:justify-start space-x-2">
                  <span class="${teacher.workLocation==='onboard'?'text-orange-600':'text-green-600'}">${teacher.workLocation==='onboard'?'ğŸš¢':'ğŸ¢'}</span>
                  <span class="${teacher.workLocation==='onboard'?'text-orange-600':'text-green-600'} font-medium">${teacher.workLocation==='onboard'?'æµ·ä¸Šå·¥ä½œ':'é™¸åœ°å·¥ä½œ'}</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-3 text-3xl">ğŸ’¼</span>å·¥ä½œç¶“æ­·</h3>
            ${(teacher.experiences&&teacher.experiences.length>0)?`
              <div class="space-y-3">
                ${teacher.experiences.map(exp=>`<div class="bg-white rounded-lg p-4 shadow-sm border-l-4 border-blue-500"><p class="text-gray-700">${exp}</p></div>`).join('')}
              </div>`:`
              <div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“</div><p>å°šæœªå¡«å¯«å·¥ä½œç¶“æ­·</p></div>`}
          </div>

          <div class="bg-gray-50 rounded-xl p-6">
            <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-3 text-3xl">ğŸ†</span>è­‰æ›¸èˆ‡è³‡æ ¼</h3>
            ${(teacher.certificates&&teacher.certificates.length>0)?`
              <div class="space-y-3">
                ${teacher.certificates.map(cert=>{
                  const certName = typeof cert==='string'?cert:cert.name;
                  const fileUrl  = typeof cert==='object' ? cert.fileUrl : '';
                  return `<div class="bg-white rounded-lg p-4 shadow-sm border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                      <p class="text-gray-700 flex-1">${certName}</p>
                      ${fileUrl?`<button onclick="viewCertificateFromDetail('${certName}','${fileUrl}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded text-sm transition-colors ml-3">ğŸ‘ï¸ æª¢è¦–</button>`:''}
                    </div></div>`;
                }).join('')}
              </div>`:`
              <div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“</div><p>å°šæœªå¡«å¯«è­‰æ›¸è³‡æ ¼</p></div>`}
          </div>
        </div>

        <div class="bg-gray-50 rounded-xl p-6 mt-8">
          <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-3 text-3xl">ğŸ“š</span>è¬›æˆèª²ç¨‹</h3>
          ${(teacher.subjects&&teacher.subjects.length>0)?`
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-3">
              ${teacher.subjects.map(s=>`<div class="bg-white rounded-lg p-4 shadow-sm text-center border-l-4 border-purple-500"><p class="text-gray-700 font-medium">${s}</p></div>`).join('')}
            </div>`:`
            <div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“–</div><p>å°šæœªå¡«å¯«è¬›æˆèª²ç¨‹</p></div>`}
        </div>

        <div class="bg-gray-50 rounded-xl p-6 mt-8">
          <h3 class="text-2xl font-bold text-gray-800 mb-4 flex items-center"><span class="mr-3 text-3xl">ğŸ·ï¸</span>æ¨™ç±¤ Tags</h3>
          ${(teacher.tags&&teacher.tags.length>0)?`
            <div class="flex flex-wrap gap-2">
              ${teacher.tags.map(tag=>`<span class="bg-gradient-to-r from-blue-500 to-purple-500 text-white px-4 py-2 rounded-full text-sm font-medium shadow-sm">${tag}</span>`).join('')}
            </div>`:`
            <div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ·ï¸</div><p>å°šæœªå¡«å¯«æ¨™ç±¤</p></div>`}
        </div>

        ${currentMode==='edit'?`
        <div class="mt-8 text-center">
          <button onclick="editTeacher(${teacher.id})" class="bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg font-medium transition-colors shadow-lg hover:shadow-xl">âœï¸ ç·¨è¼¯å¸«è³‡è³‡æ–™</button>
        </div>`:''}
      `;
    }

    function viewCertificateFromDetail(fileName,fileUrl){
      if(!fileUrl){ alert('æ²’æœ‰æª”æ¡ˆå¯ä»¥æª¢è¦–'); return; }
      const isPdf = String(fileName).toLowerCase().endsWith('.pdf');
      const w = window.open('', '_blank');
      if(isPdf){
        w.document.write(`<html><head><title>${fileName}</title></head><body style="margin:0;"><embed src="${fileUrl}" type="application/pdf" width="100%" height="100%"></body></html>`);
      }else{
        w.document.write(`<html><head><title>${fileName}</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#f0f0f0;"><img src="${fileUrl}" style="max-width:100%;max-height:100%;object-fit:contain;"></body></html>`);
      }
    }

    // backToList å·²ç§»è‡³å…¨å±€ window å°è±¡ï¼Œè¦‹æ–‡ä»¶åº•éƒ¨

    function addExperience(value=''){
      const c = document.getElementById('experienceList');
      const div = document.createElement('div');
      div.className = 'flex items-center space-x-2 bg-white p-3 rounded-lg border border-gray-200 move-transition';
      div.innerHTML = `
        <div class="flex flex-col space-y-1">
          <button type="button" onclick="moveUp(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†‘</button>
          <button type="button" onclick="moveDown(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†“</button>
        </div>
        <input type="text" value="${value}" placeholder="è«‹è¼¸å…¥å·¥ä½œç¶“æ­·..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button type="button" onclick="this.parentElement.remove()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">âœ•</button>`;
      c.appendChild(div);
    }

    function addCertificate(value='', fileName='', fileUrl=''){
      const c = document.getElementById('certificateList');
      const div = document.createElement('div');
      div.className = 'bg-white p-4 rounded-lg border border-gray-200 move-transition';
      const uid = Date.now()+Math.random();
      div.innerHTML = `
        <div class="flex items-start space-x-3">
          <div class="flex flex-col space-y-1">
            <button type="button" onclick="moveUp(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†‘</button>
            <button type="button" onclick="moveDown(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†“</button>
          </div>
          <div class="flex-1 space-y-3">
            <input type="text" value="${value}" placeholder="è«‹è¼¸å…¥è­‰æ›¸æˆ–è³‡æ ¼åç¨±..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
            <div class="flex items-center space-x-2">
              <input type="file" id="certFile_${uid}" accept=".jpg,.jpeg,.png,.pdf,.txt,.doc,.docx" class="hidden" onchange="handleCertificateFile(this)">
              <button type="button" onclick="document.getElementById('certFile_${uid}').click()" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-2 rounded-lg text-sm">ğŸ“ ä¸Šå‚³æª”æ¡ˆ</button>
              <div class="file-info text-sm text-gray-600" data-filename="${fileName}" data-fileurl="${fileUrl}">${fileName?`å·²ä¸Šå‚³: ${fileName}`:'æœªä¸Šå‚³æª”æ¡ˆ'}</div>
              ${fileUrl?`<button type="button" onclick="viewCertificateFile(this)" class="bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs">ğŸ‘ï¸ æª¢è¦–</button>`:''}
            </div>
          </div>
          <button type="button" onclick="this.closest('.bg-white').remove()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">âœ•</button>
        </div>`;
      c.appendChild(div);
    }

    async function handleCertificateFile(input){
      if(!(input.files && input.files[0])) return;
      const file = input.files[0];
      const info = input.parentElement.querySelector('.file-info');
      const okTypes = ['image/jpeg','image/jpg','image/png','application/pdf','text/plain','application/msword','application/vnd.openxmlformats-officedocument.wordprocessingml.document'];
      if(!okTypes.includes(file.type)){ alert('æ”¯æ´æ ¼å¼ï¼šJPG, PNG, PDF, TXT, DOC, DOCX'); return; }
      if(file.size > 30*1024*1024){ alert('æª”æ¡ˆå¤§å°ä¸èƒ½è¶…é 30MB'); return; }

      const old = info.textContent;
      info.textContent = 'ä¸Šå‚³ä¸­...';
      try{
        const r = await apiUploadToDrive(file);
        info.setAttribute('data-filename', r.name || file.name);
        info.setAttribute('data-fileurl',  r.url);
        info.textContent = `å·²ä¸Šå‚³: ${r.name || file.name}`;
        let btn = info.parentElement.querySelector('button[onclick="viewCertificateFile(this)"]');
        if(!btn){
          btn = document.createElement('button');
          btn.type='button';
          btn.onclick=()=>viewCertificateFile(btn);
          btn.className='bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded text-xs';
          btn.innerHTML='ğŸ‘ï¸ æª¢è¦–';
          info.parentElement.appendChild(btn);
        }
      }catch(err){
        console.error(err);
        info.textContent = old || 'ä¸Šå‚³å¤±æ•—';
        alert('ä¸Šå‚³å¤±æ•—ï¼š' + err.message);
      }
    }

    function viewCertificateFile(button){
      const info = button.parentElement.querySelector('.file-info');
      const fileName = info.getAttribute('data-filename') || 'æª”æ¡ˆ';
      const fileUrl  = info.getAttribute('data-fileurl')  || '';
      if(!fileUrl){ alert('æ²’æœ‰æª”æ¡ˆå¯ä»¥æª¢è¦–'); return; }
      const isPdf = fileName.toLowerCase().endsWith('.pdf');
      const w = window.open('', '_blank');
      if(isPdf){
        w.document.write(`<html><head><title>${fileName}</title></head><body style="margin:0;"><embed src="${fileUrl}" type="application/pdf" width="100%" height="100%"></body></html>`);
      }else{
        w.document.write(`<html><head><title>${fileName}</title></head><body style="margin:0;display:flex;justify-content:center;align-items:center;min-height:100vh;background:#f0f0f0;"><img src="${fileUrl}" style="max-width:100%;max-height:100%;object-fit:contain;"></body></html>`);
      }
    }

    function addSubject(value=''){
      const c = document.getElementById('subjectList');
      const div = document.createElement('div');
      div.className = 'flex items-center space-x-2 bg-white p-3 rounded-lg border border-gray-200 move-transition';
      div.innerHTML = `
        <div class="flex flex-col space-y-1">
          <button type="button" onclick="moveUp(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†‘</button>
          <button type="button" onclick="moveDown(this)" class="bg-gray-400 hover:bg-gray-500 text-white px-2 py-1 rounded text-xs">â†“</button>
        </div>
        <input type="text" value="${value}" placeholder="è«‹è¼¸å…¥è¬›æˆèª²ç¨‹..." class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
        <button type="button" onclick="this.parentElement.remove()" class="bg-red-500 hover:bg-red-600 text-white px-3 py-2 rounded-lg text-sm">âœ•</button>`;
      c.appendChild(div);
    }

    function addTag(value=''){
      const c = document.getElementById('tagList');
      const div = document.createElement('div');
      div.className = 'inline-flex items-center bg-white hover:bg-gray-50 rounded-full px-4 py-2 shadow-sm border border-gray-200 transition-all duration-200 hover:shadow-md group';

      div.innerHTML = `
        <input type="text" value="${value}" placeholder="æ¨™ç±¤..."
          class="bg-transparent border-none outline-none text-gray-800 text-sm font-medium transition-all duration-200"
          maxlength="20"
          style="width: ${Math.max(20, Math.min(240, (value.length || 1) * 15))}px"
          oninput="this.style.width = Math.max(20, Math.min(240, (this.value.length || 1) * 15)) + 'px'">
        <button type="button" onclick="this.parentElement.remove()" class="ml-2 text-gray-400 hover:text-red-500 transition-colors opacity-0 group-hover:opacity-100">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>`;
      c.appendChild(div);
    }

    function moveUp(button){
      const item = button.closest('.bg-white') || button.closest('.flex.items-center');
      const prev = item.previousElementSibling;
      if(prev){ item.parentNode.insertBefore(item, prev); item.style.transform='translateY(-5px)'; setTimeout(()=>{item.style.transform='translateY(0)'},200); }
    }
    function moveDown(button){
      const item = button.closest('.bg-white') || button.closest('.flex.items-center');
      const next = item.nextElementSibling;
      if(next){ item.parentNode.insertBefore(next, item); item.style.transform='translateY(5px)'; setTimeout(()=>{item.style.transform='translateY(0)'},200); }
    }

    async function previewPhoto(input){
      if (!(input.files && input.files[0])) return;
      const file = input.files[0];
      if (file.size > 30*1024*1024){ alert('ç…§ç‰‡ä¸èƒ½è¶…é 30MB'); return; }

      // å…ˆæœ¬åœ°é è¦½
      const reader = new FileReader();
      reader.onload = e => { document.getElementById('photoPreview').innerHTML = `<img src="${e.target.result}" class="w-full h-full object-cover rounded-full">`; };
      reader.readAsDataURL(file);

      // ç›´å‚³ Driveï¼Œå¯«å› URL
      try{
        const r = await apiUploadToDrive(file);
        document.getElementById('photoPreview').setAttribute('data-url', r.url);
      }catch(err){
        console.error(err);
        alert('ç…§ç‰‡ä¸Šå‚³å¤±æ•—ï¼š' + err.message);
      }
    }

    // å„²å­˜ï¼ˆéœé»˜ï¼šæœ¬æ©Ÿå¿«å– + é›²ç«¯ä¸Šå‚³ï¼‰
    document.getElementById('teacherForm').addEventListener('submit', function(e){
      e.preventDefault();
      const name = document.getElementById('teacherName').value.trim();
      const email = document.getElementById('teacherEmail').value.trim();
      const teacherType = document.querySelector('input[name="teacherType"]:checked')?.value;
      const workLocation = document.querySelector('input[name="workLocation"]:checked')?.value;
      if(!name){ alert('è«‹è¼¸å…¥å¸«è³‡å§“å'); return; }
      if(!teacherType){ alert('è«‹é¸æ“‡å¸«è³‡é¡å‹'); return; }
      if(!workLocation){ alert('è«‹é¸æ“‡å·¥ä½œåœ°é»'); return; }
      if(email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ alert('è«‹è¼¸å…¥æ­£ç¢ºçš„Emailæ ¼å¼'); return; }

      const experiences = Array.from(document.querySelectorAll('#experienceList input')).map(i=>i.value.trim()).filter(Boolean);
      const certificates = Array.from(document.querySelectorAll('#certificateList .bg-white')).map(item=>{
        const nameInput = item.querySelector('input[type="text"]');
        const info = item.querySelector('.file-info');
        const nm = nameInput.value.trim(); if(!nm) return null;
        const fileName = info.getAttribute('data-filename') || '';
        const fileUrl  = info.getAttribute('data-fileurl')  || '';
        return fileUrl ? { name:nm, fileName, fileUrl } : nm;
      }).filter(Boolean);
      const subjects = Array.from(document.querySelectorAll('#subjectList input')).map(i=>i.value.trim()).filter(Boolean);
      const tags = Array.from(document.querySelectorAll('#tagList input[type="text"]')).map(i=>i.value.trim()).filter(Boolean);

      // èª¿è©¦ï¼šç¢ºèª tags æœ‰è¢«æ”¶é›†
      console.log('æ”¶é›†åˆ°çš„ tags:', tags);

      const photoBox = document.getElementById('photoPreview');
      const photoUrl = photoBox.getAttribute('data-url') || '';

      const teacherData = { id: currentTeacherId || Date.now(), name, email, teacherType, workLocation, photo: photoUrl, experiences, certificates, subjects, tags };

      if(currentTeacherId){
        const idx = teachers.findIndex(t=>t.id===currentTeacherId); teachers[idx]=teacherData;
      }else{
        teachers.push(teacherData);
      }
      teachers = normalize(teachers);
      saveLocalSilently();
      scheduleCloudSave();
      backToList();
    });

    function deleteTeacher(){
      if(!currentTeacherId) return;
      if(confirm('ç¢ºå®šè¦åˆªé™¤é€™ä½å¸«è³‡å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')){
        teachers = teachers.filter(t=>t.id!==currentTeacherId);
        saveLocalSilently();
        scheduleCloudSave();
        backToList();
      }
    }

    function copyTeacher(teacherId){
      const t = teachers.find(x=>x.id===teacherId); if(!t) return;
      const copy = {
        id: Date.now(),
        name: (t.name || '') + ' (è¤‡è£½)',
        email: t.email || '',
        teacherType: t.teacherType || 'internal',
        workLocation: t.workLocation || 'onshore',
        photo: t.photo,
        experiences: [...(t.experiences||[])],
        certificates: (t.certificates||[]).map(c=> typeof c==='string'? c : ({name:c.name,fileName:c.fileName,fileUrl:c.fileUrl})),
        subjects: [...(t.subjects||[])],
        tags: [...(t.tags||[])]
      };
      const i = teachers.findIndex(x=>x.id===teacherId);
      teachers.splice(i+1,0,copy);
      teachers = normalize(teachers);
      saveLocalSilently();
      scheduleCloudSave();
      renderTeacherGrid();
    }

    function handleDragStart(e){ draggedElement = this; this.style.opacity='0.5'; e.dataTransfer.effectAllowed='move'; e.dataTransfer.setData('text/html', this.outerHTML); }
    function handleDragOver(e){ if(e.preventDefault) e.preventDefault(); e.dataTransfer.dropEffect='move'; return false; }
    function handleDrop(e){
      if(e.stopPropagation) e.stopPropagation();
      if(draggedElement !== this){
        const di = parseInt(draggedElement.dataset.index);
        const ti = parseInt(this.dataset.index);
        const d = teachers[di];
        teachers.splice(di,1);
        teachers.splice(ti,0,d);
        saveLocalSilently();
        scheduleCloudSave();
        renderTeacherGrid();
      }
      return false;
    }
    function handleDragEnd(){ this.style.opacity='1'; draggedElement=null; }

    function searchTeachers(){
      const searchInput = document.getElementById('searchInput');
      const searchText = searchInput.value.trim();
      const clearBtn = document.getElementById('clearBtn');
      const searchResults = document.getElementById('searchResults');

      if(searchText){
        clearBtn.classList.remove('hidden');
      } else {
        clearBtn.classList.add('hidden');
        searchResults.classList.add('hidden');
        renderTeacherGrid();
        return;
      }

      // å°‡æœå°‹å­—ä¸²åˆ†å‰²æˆå¤šå€‹é—œéµå­—ï¼ˆæ”¯æ´ç©ºæ ¼å’Œé€—è™Ÿåˆ†éš”ï¼‰
      const keywords = searchText
        .split(/[,\s]+/)
        .map(kw => kw.trim().toLowerCase())
        .filter(kw => kw.length > 0);

      if(keywords.length === 0){
        clearBtn.classList.add('hidden');
        searchResults.classList.add('hidden');
        renderTeacherGrid();
        return;
      }

      filteredTeachers = teachers.filter(t => {
        // æ¯å€‹é—œéµå­—éƒ½å¿…é ˆåœ¨è‡³å°‘ä¸€å€‹æ¬„ä½ä¸­æ‰¾åˆ°
        return keywords.every(kw => {
          // æœå°‹æ‰€æœ‰æ¬„ä½

          // å§“å
          if(String(t.name||'').toLowerCase().includes(kw)) return true;

          // Email
          if(String(t.email||'').toLowerCase().includes(kw)) return true;

          // å¸«è³‡é¡å‹ï¼ˆæ”¯æ´ä¸­è‹±æ–‡ï¼‰
          if(t.teacherType === 'internal' && ('internal'.includes(kw) || 'å…§éƒ¨'.includes(kw) || 'å…§éƒ¨å¸«è³‡'.includes(kw))) return true;
          if(t.teacherType === 'external' && ('external'.includes(kw) || 'å¤–éƒ¨'.includes(kw) || 'å¤–éƒ¨å¸«è³‡'.includes(kw))) return true;

          // å·¥ä½œåœ°é»ï¼ˆæ”¯æ´ä¸­è‹±æ–‡ï¼‰
          if(t.workLocation === 'onboard' && ('onboard'.includes(kw) || 'åœ¨èˆ¹'.includes(kw) || 'æµ·ä¸Š'.includes(kw))) return true;
          if(t.workLocation === 'onshore' && ('onshore'.includes(kw) || 'åœ¨å²¸'.includes(kw) || 'é™¸åœ°'.includes(kw))) return true;

          // å·¥ä½œç¶“æ­·
          if((t.experiences||[]).some(x => String(x).toLowerCase().includes(kw))) return true;

          // è­‰æ›¸
          if((t.certificates||[]).some(c => {
            if(typeof c === 'string') return String(c).toLowerCase().includes(kw);
            return String(c.name||'').toLowerCase().includes(kw);
          })) return true;

          // è¬›æˆèª²ç¨‹
          if((t.subjects||[]).some(s => String(s).toLowerCase().includes(kw))) return true;

          return false;
        });
      });

      if(filteredTeachers.length > 0){
        searchResults.classList.remove('hidden');
        const kwText = keywords.length > 1 ? `ã€Œ${keywords.join('ã€ã€ã€Œ')}ã€` : `ã€Œ${keywords[0]}ã€`;
        searchResults.querySelector('span').textContent = `æ‰¾åˆ° ${filteredTeachers.length} ä½ç¬¦åˆ ${kwText} çš„å¸«è³‡`;
      } else {
        searchResults.classList.add('hidden');
      }
      renderTeacherGrid(filteredTeachers);
    }

    function clearSearch(){
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      document.getElementById('clearBtn').classList.add('hidden');
      document.getElementById('searchResults').classList.add('hidden');
      filteredTeachers = [];
      renderTeacherGrid();
    }

    function showStatisticsView(){ document.getElementById('teacherList').classList.add('hidden'); document.getElementById('executiveView').classList.remove('hidden'); renderStatisticsView(); }
    function backToListFromExecutive(){ setRoute('list'); }

    function renderStatisticsView(){
      const total = teachers.length;
      const internal = teachers.filter(t=>t.teacherType==='internal').length;
      const external = teachers.filter(t=>t.teacherType==='external').length;
      const onboard = teachers.filter(t=>t.workLocation==='onboard').length;
      const onshore = teachers.filter(t=>t.workLocation==='onshore').length;
      const internalOnboard = teachers.filter(t=>t.teacherType==='internal' && t.workLocation==='onboard').length;
      const internalOnshore = teachers.filter(t=>t.teacherType==='internal' && t.workLocation==='onshore').length;
      const externalOnboard = teachers.filter(t=>t.teacherType==='external' && t.workLocation==='onboard').length;
      const externalOnshore = teachers.filter(t=>t.teacherType==='external' && t.workLocation==='onshore').length;
      const allSubjects = teachers.flatMap(t=>t.subjects||[]);
      const uniqueSubjects = [...new Set(allSubjects)];
      const avg = total>0 ? (allSubjects.length/total).toFixed(1) : 0;

      document.getElementById('totalCount').textContent = total;
      document.getElementById('internalCount').textContent = internal;
      document.getElementById('externalCount').textContent = external;
      document.getElementById('onboardCount').textContent = onboard;
      document.getElementById('onshoreCount').textContent = onshore;

      const ip = total>0 ? ((internal/total)*100).toFixed(1) : 0;
      const ep = total>0 ? ((external/total)*100).toFixed(1) : 0;
      const obp = total>0 ? ((onboard/total)*100).toFixed(1) : 0;
      const osp = total>0 ? ((onshore/total)*100).toFixed(1) : 0;

      document.getElementById('internalPercent').textContent = `${ip}%`;
      document.getElementById('externalPercent').textContent = `${ep}%`;
      document.getElementById('locationRatio').textContent = `æ¯”ä¾‹ ${onboard}:${onshore}`;

      document.getElementById('internalCountDetail').textContent = `${internal} ä½`;
      document.getElementById('internalPercentDetail').textContent = `${ip}%`;
      document.getElementById('externalCountDetail').textContent = `${external} ä½`;
      document.getElementById('externalPercentDetail').textContent = `${ep}%`;
      document.getElementById('onboardCountDetail').textContent = `${onboard} ä½`;
      document.getElementById('onboardPercentDetail').textContent = `${obp}%`;
      document.getElementById('onshoreCountDetail').textContent = `${onshore} ä½`;
      document.getElementById('onshorePercentDetail').textContent = `${osp}%`;

      document.getElementById('internalOnboard').textContent = internalOnboard;
      document.getElementById('internalOnshore').textContent = internalOnshore;
      document.getElementById('externalOnboard').textContent = externalOnboard;
      document.getElementById('externalOnshore').textContent = externalOnshore;

      document.getElementById('totalSubjects').textContent = allSubjects.length;
      document.getElementById('avgSubjectsPerTeacher').textContent = avg;
      document.getElementById('uniqueSubjects').textContent = uniqueSubjects.length;

      const counts = {}; allSubjects.forEach(s=>counts[s]=(counts[s]||0)+1);
      const sorted = Object.entries(counts).sort(([,a],[,b])=>b-a).slice(0,10);
      const box = document.getElementById('popularSubjects');
      box.innerHTML = sorted.length>0 ? sorted.map(([s,c],i)=>`
        <div class="flex items-center justify-between p-3 bg-white rounded-lg shadow-sm">
          <div class="flex items-center space-x-3">
            <div class="w-8 h-8 bg-gradient-to-r from-purple-500 to-indigo-500 text-white rounded-full flex items-center justify-center text-sm font-bold">${i+1}</div>
            <span class="font-medium text-gray-700">${s}</span>
          </div>
          <div class="text-right">
            <div class="font-bold text-purple-600">${c} ä½</div>
            <div class="text-xs text-gray-500">å¸«è³‡æ•™æˆ</div>
          </div>
        </div>`).join('') : `
        <div class="text-center py-8 text-gray-500"><div class="text-4xl mb-2">ğŸ“š</div><p>å°šæœªæœ‰èª²ç¨‹è³‡æ–™</p></div>`;
    }

    /* åŒ¯å‡º */
    function _collectRows(){
      if(!Array.isArray(teachers) || teachers.length===0){ alert('ç›®å‰æ²’æœ‰å¸«è³‡è³‡æ–™å¯ä»¥åŒ¯å‡º'); return null; }
      return teachers.map((t,i)=>({
        idx:i+1,
        name:t.name||'',
        email:t.email||'',
        teacherType:t.teacherType==='internal'?'å…§éƒ¨å¸«è³‡':'å¤–éƒ¨å¸«è³‡',
        workLocation:t.workLocation==='onboard'?'æµ·ä¸Šå·¥ä½œ':'é™¸åœ°å·¥ä½œ',
        experiences:(t.experiences||[]).join('ï¼›') || 'ç„¡',
        certificates:(t.certificates||[]).map(c=> typeof c==='string'? c : (c?.name||'')).filter(Boolean).join('ï¼›') || 'ç„¡',
        subjects:(t.subjects||[]).join('ï¼›') || 'ç„¡'
      }));
    }
    function forceDownload(dataOrBlob, filename, mime='text/plain;charset=utf-8'){
      const blob = dataOrBlob instanceof Blob ? dataOrBlob : new Blob([String(dataOrBlob)],{type:mime});
      try{
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url; a.download = filename; a.target = '_blank'; a.rel='noopener';
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
        setTimeout(()=>URL.revokeObjectURL(url),1500);
        return;
      }catch(e){}
      try{
        const fr = new FileReader();
        fr.onload = ()=>{ const w = window.open(fr.result,'_blank'); if(!w) alert('ç€è¦½å™¨å°é–äº†ä¸‹è¼‰è¦–çª—ï¼Œè«‹å…è¨±å½ˆå‡ºè¦–çª—'); };
        fr.readAsDataURL(blob); return;
      }catch(e){}
      blob.text().then(txt=>{
        const w = window.open('','_blank');
        if(w){
          w.document.write('<pre style="white-space:pre-wrap;word-break:break-all;font:12px/1.4 monospace;">'
            + txt.replace(/[<>&]/g, s=>({'<':'&lt;','>':'&gt;','&':'&amp;'}[s])) + '</pre>');
        }else{ alert('ç„¡æ³•å¦é–‹è¦–çª—ï¼Œè«‹å…è¨±å½ˆå‡ºè¦–çª—'); }
      });
    }

  </script>

  <script>
  /* ======== è¡Œäº‹æ›†ï¼ˆæ–°æ¨£å¼æ•´åˆï¼Œæ²¿ç”¨æ—¢æœ‰è³‡æ–™çµæ§‹ï¼‰ ======== */
  let currentDate = new Date();
  let viewMode = 'month';
  let selectedColor = 'bg-blue-500';
  let reminderInterval = null;

  // ä»æ²¿ç”¨å‰é¢å…¨åŸŸçš„ teachers
  let calendarEvents = JSON.parse(localStorage.getItem('calendarEvents') || '[]');
  // event = { id, date:'YYYY-MM-DD', title, time:'HH:MM'|'', teacherId:null|number, location:'', note:'', color:'bg-xxx-500' }

  function saveCalendarLocal(){ localStorage.setItem('calendarEvents', JSON.stringify(calendarEvents)); }
  function fmtDate(y,m,d){ return `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`; }
  function todayStr(){ const d=new Date(); return fmtDate(d.getFullYear(), d.getMonth(), d.getDate()); }

  function showCalendarView(){
    document.getElementById('teacherList').classList.add('hidden');
    document.getElementById('executiveView').classList.add('hidden');
    document.getElementById('teacherDetail').classList.add('hidden');
    document.getElementById('teacherDetailView').classList.add('hidden');
    document.getElementById('calendarView').classList.remove('hidden');

    const sel = document.getElementById('eventTeacherId');
    sel.innerHTML = `<option value="">ï¼ˆæœªæŒ‡æ´¾ï¼‰</option>` + (teachers||[]).map(t=>`<option value="${t.id}">${t.name}</option>`).join('');

    currentDate = new Date();
    document.getElementById('eventDate').value = todayStr();

    renderCalendar();
    startReminderCheck();
  }
  function backToListFromCalendar(){
    stopReminderCheck();
    setRoute('list');
  }

  function setViewMode(mode){
    viewMode = mode;
    const monthBtn = document.getElementById('monthViewBtn');
    const weekBtn  = document.getElementById('weekViewBtn');
    if(mode==='month'){
      monthBtn.className = 'px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-md';
      weekBtn.className  = 'px-4 py-2 rounded-lg text-sm font-semibold transition-all text-gray-600 hover:text-gray-800 hover:bg-white hover:bg-opacity-50';
      document.getElementById('prevLabel').textContent = 'ä¸Šå€‹æœˆ';
      document.getElementById('nextLabel').textContent = 'ä¸‹å€‹æœˆ';
    }else{
      weekBtn.className  = 'px-4 py-2 rounded-lg text-sm font-semibold transition-all bg-gradient-to-r from-purple-500 to-blue-500 text-white shadow-md';
      monthBtn.className = 'px-4 py-2 rounded-lg text-sm font-semibold transition-all text-gray-600 hover:text-gray-800 hover:bg-white hover:bg-opacity-50';
      document.getElementById('prevLabel').textContent = 'ä¸Šé€±';
      document.getElementById('nextLabel').textContent = 'ä¸‹é€±';
    }
    renderCalendar();
  }
  function previousPeriod(){ if(viewMode==='month'){ currentDate.setMonth(currentDate.getMonth()-1);} else{ currentDate.setDate(currentDate.getDate()-7);} renderCalendar(); }
  function nextPeriod(){ if(viewMode==='month'){ currentDate.setMonth(currentDate.getMonth()+1);} else{ currentDate.setDate(currentDate.getDate()+7);} renderCalendar(); }
  function goToToday(){ currentDate = new Date(); renderCalendar(); }

  function openAddEventModal(){
    document.getElementById('eventTitle').value = '';
    document.getElementById('eventTime').value  = '';
    document.getElementById('eventLocation').value = '';
    document.getElementById('eventNote').value = '';
    selectedColor = 'bg-blue-500';
    document.getElementById('eventDate').value = todayStr();
    document.getElementById('addEventModal').classList.remove('hidden');
  }
  function openAddEventModalForDate(dateKey){
    openAddEventModal();
    document.getElementById('eventDate').value = dateKey;
  }
  function closeAddEventModal(){ document.getElementById('addEventModal').classList.add('hidden'); }
  function selectColor(color){ selectedColor = color; }

  function addEventIntegrated(e){
    e.preventDefault();
    const title = (document.getElementById('eventTitle').value||'').trim();
    const date  = (document.getElementById('eventDate').value||'').trim();
    const time  = (document.getElementById('eventTime').value||'').trim();
    const teacherIdVal = document.getElementById('eventTeacherId').value;
    const teacherId = teacherIdVal ? Number(teacherIdVal) : null;
    const location = (document.getElementById('eventLocation').value||'').trim();
    const note     = (document.getElementById('eventNote').value||'').trim();
    if(!title || !date) return;

    calendarEvents.push({ id: Date.now(), date, title, time, teacherId, location, note, color: selectedColor });
    saveCalendarLocal();
    closeAddEventModal();
    renderCalendar();
  }
  function deleteEventById(id){
    calendarEvents = calendarEvents.filter(ev=>ev.id!==id);
    saveCalendarLocal();
    renderCalendar();
  }

  function renderCalendar(){ if(viewMode==='month') renderMonthView(); else renderWeekView(); }

  function renderMonthView(){
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();
    const monthNames = ['ä¸€æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','åä¸€æœˆ','åäºŒæœˆ'];
    document.getElementById('currentMonth').textContent = `${year}å¹´ ${monthNames[month]}`;

    const firstDay = new Date(year, month, 1);
    const start = new Date(firstDay);
    start.setDate(start.getDate() - firstDay.getDay());

    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    grid.className = 'grid grid-cols-7';
    const today = new Date().toDateString();

    for(let w=0; w<6; w++){
      for(let d=0; d<7; d++){
        const cellDate = new Date(start);
        cellDate.setDate(start.getDate() + (w*7) + d);

        const isCurrentMonth = (cellDate.getMonth() === month);
        const isToday = (cellDate.toDateString() === today);

// ç”¨ä½ ä¸Šé¢å®šç¾©çš„ fmtDate ä¾†å¾—åˆ° YYYY-MM-DD
const dateKey = fmtDate(cellDate.getFullYear(), cellDate.getMonth(), cellDate.getDate());

// é€™ä¸€å¤©çš„äº‹ä»¶
const dayEvents = calendarEvents
  .filter(ev => ev.date === dateKey)
  .sort((a,b) => (a.time||'').localeCompare(b.time||''));

// å…ˆå»º element
const cell = document.createElement('div');
cell.className = `calendar-day border-r border-b border-white border-opacity-20 p-4 ${
  isCurrentMonth ? 'bg-white bg-opacity-60' : 'bg-gray-100 bg-opacity-40'
} ${isToday ? 'today-highlight' : ''} hover:bg-white hover:bg-opacity-80 transition-all cursor-pointer`;

// åªè¨­å®šä¸€æ¬¡ onclickï¼Œå¸¶å…¥ dateKey
cell.onclick = () => openAddEventModalForDate(dateKey);

cell.innerHTML = `
  <div class="flex justify-between items-start mb-2">
    <span class="text-lg font-bold ${isCurrentMonth ? (isToday?'text-white':'text-gray-800'):'text-gray-400'} ${isToday?'bg-white bg-opacity-20 px-2 py-1 rounded-lg':''}">
      ${cellDate.getDate()}
    </span>
  </div>
  <div class="space-y-1">
    ${dayEvents.map(ev=>`
      <div class="event-item ${ev.color||'bg-blue-500'} text-white text-xs truncate"
           title="é»æ“Šåˆªé™¤ï¼š${ev.title}${ev.time?' '+ev.time:''}${ev.location?(' Â· '+ev.location):''}${ev.teacherId?(' Â· '+(teachers.find(t=>t.id===ev.teacherId)?.name||'')):''}"
           onclick="event.stopPropagation(); deleteEventById(${ev.id})">
        ${ev.time? ev.time+' ' : ''}${ev.title}${ev.teacherId?` Â· ${(teachers.find(t=>t.id===ev.teacherId)?.name||'')}`:''}
      </div>`).join('')}
  </div>`;
grid.appendChild(cell);

      }
    }
  }

  function renderWeekView(){
    const startOfWeek = new Date(currentDate);
    startOfWeek.setDate(startOfWeek.getDate()-startOfWeek.getDay());
    const endOfWeek = new Date(startOfWeek);
    endOfWeek.setDate(startOfWeek.getDate()+6);

    const monthNames = ['ä¸€æœˆ','äºŒæœˆ','ä¸‰æœˆ','å››æœˆ','äº”æœˆ','å…­æœˆ','ä¸ƒæœˆ','å…«æœˆ','ä¹æœˆ','åæœˆ','åä¸€æœˆ','åäºŒæœˆ'];
    document.getElementById('currentMonth').textContent =
      `${startOfWeek.getFullYear()}å¹´ ${monthNames[startOfWeek.getMonth()]} ${startOfWeek.getDate()}æ—¥ - ${endOfWeek.getDate()}æ—¥`;

    const grid = document.getElementById('calendarGrid');
    grid.innerHTML = '';
    grid.className = 'grid grid-cols-7';
    const dayNames = ['æ—¥','ä¸€','äºŒ','ä¸‰','å››','äº”','å…­'];
    const today = new Date().toDateString();

    for(let i=0;i<7;i++){
      const cellDate = new Date(startOfWeek);
      cellDate.setDate(startOfWeek.getDate()+i);

      const isToday = (cellDate.toDateString()===today);
      const dateKey = fmtDate(cellDate.getFullYear(), cellDate.getMonth(), cellDate.getDate());

const dayEvents = calendarEvents
  .filter(ev => ev.date === dateKey)
  .sort((a,b) => (a.time||'').localeCompare(b.time||''));

// å…ˆå»º element
const cell = document.createElement('div');
cell.className = `week-day border-r border-b border-white border-opacity-20 p-4 bg-white bg-opacity-60 ${isToday?'today-highlight':''} hover:bg-white hover:bg-opacity-80 transition-all cursor-pointer`;

// åªè¨­å®šä¸€æ¬¡ onclickï¼Œå¸¶å…¥ dateKey
cell.onclick = () => openAddEventModalForDate(dateKey);

cell.innerHTML = `
  <div class="text-center mb-4 pb-3 border-b border-white border-opacity-30">
    <div class="text-sm font-semibold ${isToday?'text-white':'text-gray-600'}">${dayNames[i]}</div>
    <div class="text-2xl font-bold ${isToday?'text-white':'text-gray-800'} ${isToday?'bg-white bg-opacity-20 rounded-lg px-2 py-1 inline-block mt-1':''}">
      ${cellDate.getDate()}
    </div>
  </div>
  <div class="space-y-2">
    ${dayEvents.map(ev=>`
      <div class="event-item ${ev.color||'bg-blue-500'} text-white text-sm p-3 rounded-xl"
           title="é»æ“Šåˆªé™¤ï¼š${ev.title}${ev.time?' '+ev.time:''}${ev.location?(' Â· '+ev.location):''}${ev.teacherId?(' Â· '+(teachers.find(t=>t.id===ev.teacherId)?.name||'')):''}"
           onclick="event.stopPropagation(); deleteEventById(${ev.id})">
        <div class="font-semibold">${ev.title}${ev.teacherId?` Â· ${(teachers.find(t=>t.id===ev.teacherId)?.name||'')}`:''}</div>
        ${ev.time? `<div class="text-xs opacity-90 mt-1">â° ${ev.time}${ev.location?` Â· ${ev.location}`:''}</div>` : (ev.location?`<div class="text-xs opacity-90 mt-1">${ev.location}</div>`:'')}
        ${ev.note? `<div class="text-xs opacity-90 mt-1">ğŸ—’ï¸ ${ev.note}</div>`:''}
      </div>`).join('')}
  </div>`;
grid.appendChild(cell);

    }
  }

  function checkTodayReminders(){
    const tStr = todayStr();
    const now = new Date();
    const upcoming = calendarEvents.filter(ev=>{
      if(ev.date!==tStr || !ev.time) return false;
      const dt = new Date(`${tStr}T${ev.time}`);
      const diff = dt - now;
      return diff>0 && diff<=30*60*1000;
    }).sort((a,b)=> (a.time||'').localeCompare(b.time||''));

    const box  = document.getElementById('todayReminders');
    const list = document.getElementById('remindersList');
    if(upcoming.length){
      list.innerHTML = upcoming.map(ev=>{
        const dt = new Date(`${tStr}T${ev.time}`);
        const mins = Math.ceil((dt-now)/(60*1000));
        const teacherName = ev.teacherId ? (teachers.find(t=>t.id===ev.teacherId)?.name || '') : '';
        return `
          <div class="reminder-item bg-white bg-opacity-20 rounded-lg p-3 flex items-center justify-between">
            <div>
              <div class="font-medium">${ev.title}${teacherName?` Â· ${teacherName}`:''}</div>
              <div class="text-sm opacity-90">${ev.time} - ${mins}åˆ†é˜å¾Œé–‹å§‹${ev.location?` Â· ${ev.location}`:''}</div>
            </div>
            <div class="text-2xl">âš ï¸</div>
          </div>`;
      }).join('');
      box.classList.remove('hidden');
    }else{
      box.classList.add('hidden');
    }
  }
  function startReminderCheck(){ if(reminderInterval) clearInterval(reminderInterval); reminderInterval = setInterval(checkTodayReminders,60000); checkTodayReminders(); }
  function stopReminderCheck(){ if(reminderInterval) clearInterval(reminderInterval); }

  // æŠŠå¿…è¦æ¨£å¼æ³¨å…¥ï¼ˆè£œé½Šä½ åŸæœ¬æ²’é—œé–‰çš„å‡½å¼ï¼‰
  function injectCalendarCSS(){
    const css = `
      .calendar-day{min-height:140px;transition:all .3s ease;}
      .calendar-day:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);}
      .week-day{min-height:450px;transition:all .3s ease;}
      .week-day:hover{transform:translateY(-2px);box-shadow:0 8px 25px rgba(0,0,0,.1);}
      .event-item{font-size:.8rem;padding:8px 12px;margin:4px 0;border-radius:8px;cursor:pointer;transition:all .3s ease;box-shadow:0 2px 8px rgba(0,0,0,.1);backdrop-filter: blur(10px);}
      .event-item:hover{transform:translateY(-2px) scale(1.02);box-shadow:0 6px 20px rgba(0,0,0,.15);}
      .glass-effect{background: rgba(255,255,255,0.95);backdrop-filter: blur(20px);border:1px solid rgba(255,255,255,0.2);}
      .gradient-bg{background: linear-gradient(135deg,#e0f2fe 0%,#f3e5f5 100%);}
      .btn-primary{background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);transition: all .3s ease;}
      .btn-primary:hover{transform: translateY(-2px);box-shadow:0 10px 25px rgba(102,126,234,.4);}
      .today-highlight{background: linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;}
    `;
    const style = document.createElement('style');
    style.textContent = css;
    document.head.appendChild(style);
  }
  injectCalendarCSS();

  // ========== æ´¾èª²ç®¡ç†åŠŸèƒ½ ==========
  let courseAssignments = JSON.parse(localStorage.getItem('courseAssignments') || '[]');
  let currentCourseTeacherId = null;
  let currentCourseStartDate = null;
  let currentCourseEndDate = null;

  // å¾å¾Œç«¯è¼‰å…¥æ´¾èª²æ•¸æ“š
  async function loadCourseAssignmentsFromBackend() {
    if (!api) {
      console.log('âš ï¸ API æœªåˆå§‹åŒ–ï¼Œè·³éå¾å¾Œç«¯è¼‰å…¥');
      return;
    }

    try {
      console.log('ğŸŒ å˜—è©¦å¾å¾Œç«¯ API è¼‰å…¥æ´¾èª²æ•¸æ“š...');
      const data = await api.list('courseAssignments');

      if (Array.isArray(data)) {
        if (data.length > 0) {
          console.log('âœ… å¾å¾Œç«¯ API è¼‰å…¥æ´¾èª²æ•¸æ“šæˆåŠŸï¼Œå…±', data.length, 'ç­†');
          courseAssignments = data;
          localStorage.setItem('courseAssignments', JSON.stringify(courseAssignments));

          // åŒæ­¥åˆ°è¡Œäº‹æ›†
          syncCourseAssignmentsToCalendar();

          // å¦‚æœæ­£åœ¨é¡¯ç¤ºæ´¾èª²è¦–åœ–ï¼Œå‰‡æ›´æ–°é¡¯ç¤º
          if (currentMode === 'courses') {
            updateCourseView();
          }
        } else {
          console.log('ğŸ“ å¾Œç«¯ API è¿”å›ç©ºçš„æ´¾èª²æ•¸æ“š');
          // ä¸è¦æ¸…ç©ºæœ¬åœ°æ•¸æ“šï¼Œä¿æŒç¾æœ‰çš„ courseAssignments
          if (courseAssignments.length > 0) {
            console.log('ğŸ“Œ ä¿ç•™æœ¬åœ°æ´¾èª²æ•¸æ“šï¼Œå…±', courseAssignments.length, 'ç­†');
          }
        }
      }
    } catch (error) {
      console.warn('âš ï¸ å¾å¾Œç«¯ API è¼‰å…¥æ´¾èª²æ•¸æ“šå¤±æ•—:', error.message);
      // ä½¿ç”¨æœ¬åœ°æ•¸æ“š
      if (courseAssignments.length > 0) {
        console.log('ğŸ“Œ ä½¿ç”¨æœ¬åœ°æ´¾èª²æ•¸æ“šï¼Œå…±', courseAssignments.length, 'ç­†');
      } else {
        console.warn('âŒ æ²’æœ‰æœ¬åœ°æ•¸æ“šå¯ç”¨');
      }
    }
  }

  // å°‡æ´¾èª²æ•¸æ“šåŒæ­¥åˆ°è¡Œäº‹æ›†
  function syncCourseAssignmentsToCalendar() {
    // å…ˆç§»é™¤æ‰€æœ‰ç”±æ´¾èª²ç”¢ç”Ÿçš„è¡Œäº‹æ›†äº‹ä»¶
    calendarEvents = calendarEvents.filter(e => !e.courseId);

    console.log('ğŸ”„ é–‹å§‹åŒæ­¥æ´¾èª²åˆ°è¡Œäº‹æ›†...');
    console.log('  - courseAssignments æ•¸é‡:', courseAssignments.length);

    // å°‡æ‰€æœ‰æ´¾èª²è½‰æ›ç‚ºè¡Œäº‹æ›†äº‹ä»¶
    courseAssignments.forEach((course, index) => {
      const teacher = teachers.find(t => t.id === course.teacherId);
      const teacherName = teacher ? teacher.name : 'æœªçŸ¥å¸«è³‡';

      // æ¨™æº–åŒ–æ—¥æœŸæ ¼å¼ï¼šå°‡ ISO 8601 æ ¼å¼ (2025-11-01T16:00:00.000Z) è½‰æ›ç‚º YYYY-MM-DD
      let normalizedDate = course.date;
      if (normalizedDate && normalizedDate.includes('T')) {
        normalizedDate = normalizedDate.split('T')[0]; // å– T ä¹‹å‰çš„éƒ¨åˆ†
      }

      // èª¿è©¦ï¼šé¡¯ç¤ºå‰å¹¾ç­†è³‡æ–™çš„æ—¥æœŸæ ¼å¼
      if (index < 3) {
        console.log(`  - æ´¾èª² ${index + 1}: ${course.name}`);
        console.log(`    åŸå§‹æ—¥æœŸ: "${course.date}"`);
        console.log(`    æ¨™æº–åŒ–å¾Œ: "${normalizedDate}"`);
        console.log(`    æ™‚é–“: "${course.time}"`);
      }

      calendarEvents.push({
        id: course.id,
        date: normalizedDate,
        title: `${course.name} - ${teacherName}`,
        time: course.time,
        teacherId: course.teacherId,
        location: course.type,
        note: `èª²ç¨‹é¡å‹ï¼š${course.type}${course.note ? '\n' + course.note : ''}`,
        color: getCourseTypeColor(course.type),
        courseId: course.id // æ¨™è¨˜ç‚ºæ´¾èª²ç”¢ç”Ÿçš„äº‹ä»¶
      });
    });

    saveCalendarLocal();
    console.log('âœ… æ´¾èª²æ•¸æ“šå·²åŒæ­¥åˆ°è¡Œäº‹æ›†ï¼Œå…±', courseAssignments.length, 'ç­†');
    console.log('  - calendarEvents ç¸½æ•¸:', calendarEvents.length, 'ç­†');

    // å¦‚æœç›®å‰æ­£åœ¨è¡Œäº‹æ›†è¦–åœ–ï¼Œé‡æ–°æ¸²æŸ“ä»¥é¡¯ç¤ºæ›´æ–°
    if (currentMode === 'calendar') {
      renderCalendar();
      console.log('ğŸ”„ è¡Œäº‹æ›†è¦–åœ–å·²æ›´æ–°');
    }
  }

  // é¡¯ç¤ºæ´¾èª²ç®¡ç†è¦–åœ–
  function showCourseManagementView() {
    console.log('ğŸ“‹ é¡¯ç¤ºæ´¾èª²ç®¡ç†è¦–åœ–');
    console.log('  - courseAssignments ç¸½æ•¸:', courseAssignments.length);

    document.getElementById('teacherList').classList.add('hidden');
    document.getElementById('courseManagementView').classList.remove('hidden');

    // åˆå§‹åŒ–å¸«è³‡é¸æ“‡
    const teacherSelect = document.getElementById('courseTeacherSelect');
    teacherSelect.innerHTML = '<option value="">è«‹é¸æ“‡å¸«è³‡</option>';
    teachers.forEach(teacher => {
      const option = document.createElement('option');
      option.value = String(teacher.id);
      option.textContent = teacher.name;
      teacherSelect.appendChild(option);
    });

    console.log('  - å¸«è³‡é¸å–®å·²å»ºç«‹ï¼Œå…±', teachers.length, 'ä½å¸«è³‡');

    // åˆå§‹åŒ–æ—¥æœŸ
    initCourseDates();

    console.log('  - æ—¥æœŸå·²åˆå§‹åŒ–:', currentCourseStartDate, '~', currentCourseEndDate);

    // æ›´æ–°èª²ç¨‹è¦–åœ–ï¼ˆå¦‚æœå·²é¸æ“‡å¸«è³‡ï¼‰
    if (currentCourseTeacherId) {
      console.log('  - å·²é¸æ“‡å¸«è³‡ï¼Œæ›´æ–°è¦–åœ–');
      updateCourseView();
    } else {
      console.log('  - å°šæœªé¸æ“‡å¸«è³‡ï¼Œç­‰å¾…ç”¨æˆ¶é¸æ“‡');
    }
  }

  // è¿”å›å¸«è³‡åˆ—è¡¨
  function backToListFromCourseManagement() {
    setRoute('list');
  }

  // åˆå§‹åŒ–æ—¥æœŸ
  function initCourseDates() {
    const today = new Date();
    const startDate = new Date(today.getFullYear(), today.getMonth(), 1);
    const endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);

    currentCourseStartDate = startDate.toISOString().split('T')[0];
    currentCourseEndDate = endDate.toISOString().split('T')[0];

    document.getElementById('courseStartDate').value = currentCourseStartDate;
    document.getElementById('courseEndDate').value = currentCourseEndDate;
  }

  // è¨­å®šæ—¥æœŸç¯„åœ
  function setCourseDateRange(range) {
    const today = new Date();
    let startDate, endDate;

    switch(range) {
      case 'thisMonth':
        startDate = new Date(today.getFullYear(), today.getMonth(), 1);
        endDate = new Date(today.getFullYear(), today.getMonth() + 1, 0);
        break;
      case 'lastMonth':
        startDate = new Date(today.getFullYear(), today.getMonth() - 1, 1);
        endDate = new Date(today.getFullYear(), today.getMonth(), 0);
        break;
      case 'last3Months':
        startDate = new Date(today.getFullYear(), today.getMonth() - 2, 1);
        endDate = today;
        break;
      case 'last6Months':
        startDate = new Date(today.getFullYear(), today.getMonth() - 5, 1);
        endDate = today;
        break;
      case 'thisYear':
        startDate = new Date(today.getFullYear(), 0, 1);
        endDate = today;
        break;
    }

    currentCourseStartDate = startDate.toISOString().split('T')[0];
    currentCourseEndDate = endDate.toISOString().split('T')[0];

    document.getElementById('courseStartDate').value = currentCourseStartDate;
    document.getElementById('courseEndDate').value = currentCourseEndDate;

    updateCourseView();
  }

  // æ›´æ–°èª²ç¨‹è¦–åœ–
  function updateCourseView() {
    const teacherId = document.getElementById('courseTeacherSelect').value;
    currentCourseTeacherId = teacherId ? Number(teacherId) : null;
    currentCourseStartDate = document.getElementById('courseStartDate').value;
    currentCourseEndDate = document.getElementById('courseEndDate').value;

    console.log('ğŸ”„ æ›´æ–°èª²ç¨‹è¦–åœ– - å¸«è³‡ID:', currentCourseTeacherId, 'æ—¥æœŸç¯„åœ:', currentCourseStartDate, '~', currentCourseEndDate);
    console.log('ğŸ“¦ ç•¶å‰ courseAssignments ç¸½æ•¸:', courseAssignments.length);

    if (!currentCourseTeacherId) {
      document.getElementById('courseTimeline').innerHTML = '<div class="text-center text-gray-500 py-12">è«‹é¸æ“‡å¸«è³‡ä»¥æŸ¥çœ‹èª²ç¨‹</div>';
      document.getElementById('courseTotalHours').textContent = '0';
      document.getElementById('courseTotalCount').textContent = '0';
      document.getElementById('courseMonthlyHours').textContent = '0';
      document.getElementById('courseTodayCount').textContent = '0';
      document.getElementById('courseTypeCards').innerHTML = '';
      document.getElementById('teacherWeekSchedule').classList.add('hidden');
      return;
    }

    updateCourseStats();
    renderCourseTypeCards();
    renderCourseTimeline();
    renderTeacherWeekSchedule();
  }

  // è¨ˆç®—æ™‚æ•¸
  function calculateCourseHours(timeRange) {
    const [start, end] = timeRange.split('-');
    const startTime = new Date(`2024-01-01 ${start}`);
    const endTime = new Date(`2024-01-01 ${end}`);
    return (endTime - startTime) / (1000 * 60 * 60);
  }

  // éæ¿¾èª²ç¨‹
  function getFilteredCourses(teacherId) {
    if (!teacherId) {
      console.log('âš ï¸ getFilteredCourses - æ²’æœ‰é¸æ“‡å¸«è³‡');
      return [];
    }

    console.log('ğŸ” é–‹å§‹éæ¿¾èª²ç¨‹');
    console.log('  - å¸«è³‡ID:', teacherId);
    console.log('  - æ—¥æœŸç¯„åœ:', currentCourseStartDate, '~', currentCourseEndDate);
    console.log('  - courseAssignments ç¸½æ•¸:', courseAssignments.length);

    // æ‰“å°å‰ 3 ç­†æ•¸æ“šä¾›æª¢æŸ¥
    if (courseAssignments.length > 0) {
      console.log('  - å‰ 3 ç­†æ•¸æ“š:', courseAssignments.slice(0, 3));
    }

    const filtered = courseAssignments.filter(course => {
      const matchTeacher = Number(course.teacherId) === Number(teacherId);

      // âœ¨ ä¿®å¾©ï¼šå¦‚æœæ²’æœ‰è¨­å®šæ—¥æœŸç¯„åœï¼Œé¡¯ç¤ºæ‰€æœ‰æ—¥æœŸ
      let inDateRange = true;
      if (currentCourseStartDate && currentCourseEndDate) {
        inDateRange = (course.date >= currentCourseStartDate && course.date <= currentCourseEndDate);
      }

      // è©³ç´°è¨˜éŒ„ä¸åŒ¹é…çš„åŸå› 
      if (!matchTeacher) {
        console.log(`  âœ— èª²ç¨‹ ${course.name} - å¸«è³‡ä¸åŒ¹é… (${course.teacherId} !== ${teacherId})`);
      } else if (!inDateRange) {
        console.log(`  âœ— èª²ç¨‹ ${course.name} (${course.date}) - æ—¥æœŸè¶…å‡ºç¯„åœ [${currentCourseStartDate} ~ ${currentCourseEndDate}]`);
      } else {
        console.log(`  âœ“ èª²ç¨‹ ${course.name} (${course.date}) - åŒ¹é…æˆåŠŸ`);
      }

      return matchTeacher && inDateRange;
    });

    console.log('  âœ… éæ¿¾çµæœ:', filtered.length, 'ç­†èª²ç¨‹');
    if (filtered.length > 0) {
      console.log('  - éæ¿¾å¾Œçš„èª²ç¨‹:', filtered);
    }

    return filtered;
  }

  // æ›´æ–°çµ±è¨ˆ
  function updateCourseStats() {
    const filteredCourses = getFilteredCourses(currentCourseTeacherId);

    console.log('ğŸ” æ›´æ–°çµ±è¨ˆ - å¸«è³‡ID:', currentCourseTeacherId, 'éæ¿¾å¾Œèª²ç¨‹æ•¸:', filteredCourses.length);

    // ç¸½æ™‚æ•¸
    const totalHours = filteredCourses.reduce((sum, course) => {
      return sum + calculateCourseHours(course.time);
    }, 0);

    // èª²ç¨‹æ•¸é‡
    const totalCount = filteredCourses.length;

    // æœ¬æœˆæ™‚æ•¸
    const today = new Date();
    const monthStart = new Date(today.getFullYear(), today.getMonth(), 1).toISOString().split('T')[0];
    const monthEnd = new Date(today.getFullYear(), today.getMonth() + 1, 0).toISOString().split('T')[0];

    const monthCourses = courseAssignments.filter(course => {
      return Number(course.teacherId) === Number(currentCourseTeacherId) &&
             course.date >= monthStart &&
             course.date <= monthEnd;
    });

    const monthlyHours = monthCourses.reduce((sum, course) => {
      return sum + calculateCourseHours(course.time);
    }, 0);

    // ä»Šæ—¥èª²ç¨‹
    const todayStr = today.toISOString().split('T')[0];
    const todayCourses = courseAssignments.filter(course => {
      return Number(course.teacherId) === Number(currentCourseTeacherId) && course.date === todayStr;
    }).length;

    console.log('ğŸ“Š çµ±è¨ˆçµæœ - ç¸½æ™‚æ•¸:', totalHours, 'ç¸½èª²ç¨‹æ•¸:', totalCount, 'æœ¬æœˆæ™‚æ•¸:', monthlyHours, 'ä»Šæ—¥èª²ç¨‹:', todayCourses);

    document.getElementById('courseTotalHours').textContent = Math.round(totalHours);
    document.getElementById('courseTotalCount').textContent = totalCount;
    document.getElementById('courseMonthlyHours').textContent = monthlyHours.toFixed(1);
    document.getElementById('courseTodayCount').textContent = todayCourses;
  }

  // æ¸²æŸ“èª²ç¨‹é¡å‹å¡ç‰‡ï¼ˆå–ä»£Canvasï¼‰
  function renderCourseTypeCards() {
    const filteredCourses = getFilteredCourses(currentCourseTeacherId);
    const typeCount = {};

    console.log('ğŸ¨ æ¸²æŸ“èª²ç¨‹é¡å‹å¡ç‰‡ - èª²ç¨‹æ•¸:', filteredCourses.length);

    filteredCourses.forEach(course => {
      typeCount[course.type] = (typeCount[course.type] || 0) + 1;
    });

    console.log('ğŸ“ˆ èª²ç¨‹é¡å‹çµ±è¨ˆ:', typeCount);

    const colors = {
      'æ­£èª²': { from: 'from-blue-500', to: 'to-blue-600' },
      'è£œèª²': { from: 'from-yellow-500', to: 'to-yellow-600' },
      'å¯¦é©—èª²': { from: 'from-purple-500', to: 'to-purple-600' },
      'å¯¦ä½œèª²': { from: 'from-green-500', to: 'to-green-600' },
      'å°ˆé¡Œ': { from: 'from-pink-500', to: 'to-pink-600' }
    };

    const total = Object.values(typeCount).reduce((a, b) => a + b, 0);
    const container = document.getElementById('courseTypeCards');

    if (!container) {
      console.error('âŒ æ‰¾ä¸åˆ° courseTypeCards å®¹å™¨');
      return;
    }

    container.innerHTML = '';

    Object.entries(typeCount).forEach(([type, count]) => {
      const percentage = total > 0 ? Math.round((count / total) * 100) : 0;
      const color = colors[type] || { from: 'from-gray-500', to: 'to-gray-600' };

      const card = document.createElement('div');
      card.className = `bg-gradient-to-br ${color.from} ${color.to} rounded-xl p-4 text-white shadow-lg hover:shadow-xl transition-all hover:-translate-y-1 cursor-pointer`;
      card.innerHTML = `
        <h4 class="text-sm font-semibold mb-2 opacity-90">${type}</h4>
        <p class="text-3xl font-bold mb-1">${count}</p>
        <p class="text-xs opacity-80">é–€èª²ç¨‹ Â· ${percentage}%</p>
      `;
      container.appendChild(card);
    });

    if (total === 0) {
      container.innerHTML = '<div class="col-span-full text-center text-gray-500 py-8">æš«ç„¡èª²ç¨‹è³‡æ–™</div>';
    }
  }

  // æ¸²æŸ“èª²ç¨‹æ™‚é–“è»¸
  function renderCourseTimeline() {
    const filteredCourses = getFilteredCourses(currentCourseTeacherId);
    const sortedCourses = [...filteredCourses].sort((a, b) => new Date(b.date) - new Date(a.date));

    const timeline = document.getElementById('courseTimeline');
    timeline.innerHTML = '';

    if (sortedCourses.length === 0) {
      timeline.innerHTML = '<div class="text-center text-gray-500 py-12">é¸å®šæ™‚é–“ç¯„åœå…§ç„¡èª²ç¨‹è³‡æ–™</div>';
      return;
    }

    sortedCourses.forEach((course, index) => {
      const hours = calculateCourseHours(course.time);
      const courseDate = new Date(course.date);
      const today = new Date();
      const isPast = courseDate < today;
      const isToday = courseDate.toDateString() === today.toDateString();

      const statusColors = {
        'completed': { bg: 'bg-green-500', text: 'å·²å®Œæˆ' },
        'ongoing': { bg: 'bg-orange-500', text: 'é€²è¡Œä¸­' },
        'upcoming': { bg: 'bg-blue-500', text: 'æœªä¾†' }
      };

      let status = 'upcoming';
      if (isPast) status = 'completed';
      if (isToday) status = 'ongoing';

      const statusInfo = statusColors[status];

      const item = document.createElement('div');
      item.className = 'border border-gray-200 rounded-xl p-4 hover:shadow-lg transition-all hover:-translate-y-1';
      item.innerHTML = `
        <div class="flex justify-between items-start mb-3">
          <div class="flex-1">
            <div class="flex items-center gap-3 mb-2">
              <h4 class="text-lg font-semibold text-gray-800">${course.name}</h4>
              <span class="px-3 py-1 ${statusInfo.bg} text-white text-xs font-medium rounded-full">${statusInfo.text}</span>
              <span class="px-3 py-1 bg-gray-100 text-gray-700 text-xs font-medium rounded-full">${course.type}</span>
            </div>
            <div class="flex flex-wrap gap-4 text-sm text-gray-600">
              <span>ğŸ“… ${new Date(course.date).toLocaleDateString('zh-TW', { year: 'numeric', month: 'long', day: 'numeric', weekday: 'short' })}</span>
              <span>ğŸ• ${course.time}</span>
              <span>â±ï¸ ${hours.toFixed(1)}å°æ™‚</span>
            </div>
          </div>
          <button onclick="deleteCourseAssignment(${course.id})" class="text-red-500 hover:text-red-700 p-2 hover:bg-red-50 rounded-lg transition-colors">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
          </button>
        </div>
      `;
      timeline.appendChild(item);
    });
  }

  // é–‹å•Ÿæ–°å¢èª²ç¨‹ Modal
  function openAddCourseModal() {
    if (!currentCourseTeacherId) {
      alert('è«‹å…ˆé¸æ“‡å¸«è³‡');
      return;
    }
    document.getElementById('addCourseModal').classList.remove('hidden');
    document.getElementById('addCourseModal').style.display = 'flex';
    document.getElementById('addCourseDate').value = new Date().toISOString().split('T')[0];
  }

  // é—œé–‰æ–°å¢èª²ç¨‹ Modal
  function closeAddCourseModal() {
    document.getElementById('addCourseModal').classList.add('hidden');
    document.getElementById('addCourseModal').style.display = 'none';
    document.getElementById('addCourseForm').reset();
  }

  // æäº¤æ–°å¢èª²ç¨‹
  function addCourseSubmit(event) {
    event.preventDefault();

    const courseName = document.getElementById('addCourseName').value;
    const courseDate = document.getElementById('addCourseDate').value;
    const startTime = document.getElementById('addCourseStartTime').value;
    const endTime = document.getElementById('addCourseEndTime').value;
    const courseType = document.getElementById('addCourseType').value;
    const timeRange = `${startTime}-${endTime}`;

    // æª¢æŸ¥æ˜¯å¦æœ‰è¡å ‚
    const conflicts = checkTeacherConflict(currentCourseTeacherId, courseDate, startTime, endTime);

    if (conflicts.length > 0) {
      const conflictMessages = conflicts.map(c =>
        `- ${c.name} (${c.time}) [${c.type}] ä¾†æºï¼š${c.source}`
      ).join('\n');

      const confirmMessage = `âš ï¸ è¡å ‚è­¦å‘Šï¼\n\nè©²è€å¸«åœ¨æ­¤æ™‚æ®µå·²æœ‰ä»¥ä¸‹èª²ç¨‹ï¼š\n${conflictMessages}\n\næ˜¯å¦ä»è¦ç¹¼çºŒæ´¾èª²ï¼Ÿ`;

      if (!confirm(confirmMessage)) {
        return; // å–æ¶ˆæ´¾èª²
      }
    }

    const newCourse = {
      id: Date.now(),
      teacherId: currentCourseTeacherId,
      name: courseName,
      date: courseDate,
      time: timeRange,
      type: courseType
    };

    courseAssignments.push(newCourse);
    saveCourseLocal();

    // åŒæ­¥åˆ°è¡Œäº‹æ›†
    const teacher = teachers.find(t => t.id === currentCourseTeacherId);
    const teacherName = teacher ? teacher.name : 'æœªçŸ¥å¸«è³‡';

    calendarEvents.push({
      id: newCourse.id, // ä½¿ç”¨ç›¸åŒ ID ä»¥ä¾¿åŒæ­¥åˆªé™¤
      date: courseDate,
      title: `${courseName} - ${teacherName}`,
      time: timeRange,
      teacherId: currentCourseTeacherId,
      location: courseType,
      note: `èª²ç¨‹é¡å‹ï¼š${courseType}`,
      color: getCourseTypeColor(courseType),
      courseId: newCourse.id // æ¨™è¨˜ç‚ºæ´¾èª²ç”¢ç”Ÿçš„äº‹ä»¶
    });
    saveCalendarLocal();

    updateCourseView();
    closeAddCourseModal();

    // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
    // alert('âœ… èª²ç¨‹æ–°å¢æˆåŠŸï¼å·²åŒæ­¥åˆ°è¡Œäº‹æ›†');
  }

  // åˆªé™¤èª²ç¨‹
  function deleteCourseAssignment(courseId) {
    if (!confirm('ç¢ºå®šè¦åˆªé™¤æ­¤èª²ç¨‹å—ï¼Ÿ')) return;

    courseAssignments = courseAssignments.filter(c => c.id !== courseId);
    saveCourseLocal();

    // åŒæ­¥åˆªé™¤è¡Œäº‹æ›†ä¸­çš„å°æ‡‰äº‹ä»¶
    calendarEvents = calendarEvents.filter(e => e.courseId !== courseId);
    saveCalendarLocal();

    updateCourseView();

    alert('âœ… èª²ç¨‹å·²åˆªé™¤ï¼Œå·²åŒæ­¥æ›´æ–°è¡Œäº‹æ›†');
  }

  // å„²å­˜åˆ° localStorage å’Œå¾Œç«¯
  function saveCourseLocal() {
    try {
      localStorage.setItem('courseAssignments', JSON.stringify(courseAssignments));
      // åŒæ­¥åˆ°å¾Œç«¯
      saveCourseToBackend();
    } catch(err) {
      console.warn('localStorage è¶…é¡ï¼Œèª²ç¨‹æ•¸æ“šä¿å­˜å¤±æ•—ï¼š', err);
      alert('å­˜å„²ç©ºé–“å·²æ»¿ï¼Œèª²ç¨‹æ•¸æ“šå¯èƒ½ç„¡æ³•ä¿å­˜ï¼Œè«‹åˆªé™¤éƒ¨åˆ†æ•¸æ“š');
    }
  }

  // å„²å­˜æ´¾èª²æ•¸æ“šåˆ°å¾Œç«¯
  async function saveCourseToBackend() {
    if (!api || !syncManager) return;
    try {
      await syncManager.saveTable('courseAssignments');
      console.log('âœ… æ´¾èª²æ•¸æ“šå·²åŒæ­¥åˆ°å¾Œç«¯');
    } catch (error) {
      console.warn('âš ï¸ æ´¾èª²æ•¸æ“šå¾Œç«¯åŒæ­¥å¤±æ•—:', error);
    }
  }

  // é»æ“Š Modal å¤–éƒ¨é—œé–‰
  document.getElementById('addCourseModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeAddCourseModal();
    }
  });

  // é»æ“Š addEventModal å¤–éƒ¨é—œé–‰
  document.getElementById('addEventModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeAddEventModal();
    }
  });

  // é»æ“Š maritimeCourseModal å¤–éƒ¨é—œé–‰
  document.getElementById('maritimeCourseModal')?.addEventListener('click', function(e) {
    if (e.target === this) {
      closeMaritimeCourseModal();
    }
  });

  // ========== è¡å ‚æª¢æŸ¥èˆ‡è¡Œäº‹æ›†æ•´åˆåŠŸèƒ½ ==========

  // æª¢æŸ¥è€å¸«åœ¨ç‰¹å®šæ™‚é–“æ˜¯å¦æœ‰è¡å ‚
  function checkTeacherConflict(teacherId, date, startTime, endTime) {
    const conflicts = [];

    // å°‡æ™‚é–“è½‰æ›ç‚ºåˆ†é˜æ•¸ä»¥ä¾¿æ¯”è¼ƒ
    const timeToMinutes = (timeStr) => {
      const [hours, minutes] = timeStr.split(':').map(Number);
      return hours * 60 + minutes;
    };

    const newStart = timeToMinutes(startTime);
    const newEnd = timeToMinutes(endTime);

    // æª¢æŸ¥æ´¾èª²ç®¡ç†ä¸­çš„èª²ç¨‹
    courseAssignments.forEach(course => {
      if (course.teacherId === teacherId && course.date === date) {
        const [courseStart, courseEnd] = course.time.split('-');
        const existingStart = timeToMinutes(courseStart);
        const existingEnd = timeToMinutes(courseEnd);

        // æª¢æŸ¥æ™‚é–“æ˜¯å¦é‡ç–Š
        if (!(newEnd <= existingStart || newStart >= existingEnd)) {
          conflicts.push({
            name: course.name,
            time: course.time,
            type: course.type,
            source: 'æ´¾èª²ç®¡ç†'
          });
        }
      }
    });

    // æª¢æŸ¥è¡Œäº‹æ›†ä¸­çš„äº‹ä»¶
    calendarEvents.forEach(event => {
      if (event.teacherId === teacherId && event.date === date && event.time) {
        const timeParts = event.time.split('-');
        if (timeParts.length === 2) {
          const [eventStart, eventEnd] = timeParts;
          const existingStart = timeToMinutes(eventStart);
          const existingEnd = timeToMinutes(eventEnd);

          // æª¢æŸ¥æ™‚é–“æ˜¯å¦é‡ç–Šï¼ˆæ’é™¤æ´¾èª²ç”¢ç”Ÿçš„äº‹ä»¶ï¼Œé¿å…é‡è¤‡æª¢æŸ¥ï¼‰
          if (!event.courseId && !(newEnd <= existingStart || newStart >= existingEnd)) {
            conflicts.push({
              name: event.title,
              time: event.time,
              type: event.location || 'è¡Œäº‹æ›†äº‹ä»¶',
              source: 'è¡Œäº‹æ›†'
            });
          }
        }
      }
    });

    return conflicts;
  }

  // è¨ºæ–·å·¥å…·ï¼šæª¢æŸ¥æ´¾èª²ç®¡ç†æ•¸æ“šç‹€æ…‹
  function diagnoseCourseManagement() {
    console.log('ğŸ”§ === æ´¾èª²ç®¡ç†è¨ºæ–·å ±å‘Š ===');
    console.log('');
    console.log('ğŸ“Š åŸºæœ¬ç‹€æ…‹ï¼š');
    console.log('  - courseAssignments ç¸½æ•¸:', courseAssignments.length);
    console.log('  - ç•¶å‰é¸æ“‡å¸«è³‡ID:', currentCourseTeacherId);
    console.log('  - æ—¥æœŸç¯„åœ:', currentCourseStartDate, '~', currentCourseEndDate);
    console.log('  - å¸«è³‡ç¸½æ•¸:', teachers.length);
    console.log('');

    if (courseAssignments.length === 0) {
      console.warn('âš ï¸ courseAssignments æ˜¯ç©ºçš„ï¼');
      console.log('å˜—è©¦å¾ localStorage è®€å–...');
      const localData = localStorage.getItem('courseAssignments');
      if (localData) {
        const parsed = JSON.parse(localData);
        console.log('localStorage ä¸­æœ‰', parsed.length, 'ç­†æ•¸æ“š');
        console.log('æ•¸æ“šæ¨£æœ¬:', parsed.slice(0, 2));
      } else {
        console.error('âŒ localStorage ä¹Ÿæ²’æœ‰æ•¸æ“š');
      }
    } else {
      console.log('âœ… courseAssignments æœ‰æ•¸æ“š');
      console.log('å‰ 3 ç­†æ•¸æ“š:', courseAssignments.slice(0, 3));
      console.log('');

      // çµ±è¨ˆå¸«è³‡åˆ†ä½ˆ
      const teacherCounts = {};
      courseAssignments.forEach(c => {
        teacherCounts[c.teacherId] = (teacherCounts[c.teacherId] || 0) + 1;
      });
      console.log('ğŸ“ˆ å„å¸«è³‡èª²ç¨‹æ•¸é‡:', teacherCounts);
      console.log('');

      // çµ±è¨ˆæ—¥æœŸåˆ†ä½ˆ
      const dates = courseAssignments.map(c => c.date).sort();
      console.log('ğŸ“… æ—¥æœŸç¯„åœ:', dates[0], '~', dates[dates.length - 1]);
      console.log('');
    }

    if (currentCourseTeacherId) {
      console.log('ğŸ” ç•¶å‰éæ¿¾çµæœï¼š');
      const filtered = getFilteredCourses(currentCourseTeacherId);
      console.log('  - éæ¿¾å¾Œèª²ç¨‹æ•¸:', filtered.length);
    } else {
      console.log('âš ï¸ å°šæœªé¸æ“‡å¸«è³‡');
    }

    console.log('');
    console.log('ğŸ’¡ å»ºè­°ï¼š');
    if (courseAssignments.length === 0) {
      console.log('  1. æª¢æŸ¥å¾Œç«¯ API æ˜¯å¦æ­£å¸¸');
      console.log('  2. æª¢æŸ¥ Google Sheets æ˜¯å¦æœ‰æ•¸æ“š');
      console.log('  3. å˜—è©¦æ‰‹å‹•æ–°å¢ä¸€ç­†æ´¾èª²æ¸¬è©¦');
    }
    console.log('  - æ‰‹å‹•é‡æ–°è¼‰å…¥æ•¸æ“š: await loadCourseAssignmentsFromBackend()');
    console.log('  - æ‰‹å‹•æ›´æ–°è¦–åœ–: updateCourseView()');
    console.log('');
  }

  // å°‡è¨ºæ–·å‡½æ•¸æš´éœ²åˆ°å…¨å±€
  window.diagnoseCourseManagement = diagnoseCourseManagement;

  // ç²å–èª²ç¨‹é¡å‹å°æ‡‰çš„é¡è‰²
  function getCourseTypeColor(type) {
    const colorMap = {
      'æ­£èª²': '#3b82f6',    // è—è‰²
      'è£œèª²': '#f59e0b',    // é»ƒè‰²
      'å¯¦é©—èª²': '#8b5cf6',  // ç´«è‰²
      'å¯¦ä½œèª²': '#10b981',  // ç¶ è‰²
      'å°ˆé¡Œ': '#ec4899'     // ç²‰è‰²
    };
    return colorMap[type] || '#6b7280'; // é è¨­ç°è‰²
  }

  // ç²å–è€å¸«åœ¨æŒ‡å®šæ—¥æœŸç¯„åœå…§çš„èª²ç¨‹ï¼ˆç”¨æ–¼é¡¯ç¤ºå¯ç”¨æ™‚é–“ï¼‰
  function getTeacherSchedule(teacherId, startDate, endDate) {
    const schedule = [];

    // å¾æ´¾èª²ç®¡ç†ç²å–
    courseAssignments.forEach(course => {
      if (course.teacherId === teacherId &&
          course.date >= startDate &&
          course.date <= endDate) {
        schedule.push({
          date: course.date,
          time: course.time,
          title: course.name,
          type: course.type,
          source: 'æ´¾èª²'
        });
      }
    });

    // å¾è¡Œäº‹æ›†ç²å–
    calendarEvents.forEach(event => {
      if (event.teacherId === teacherId &&
          event.date >= startDate &&
          event.date <= endDate &&
          !event.courseId) { // æ’é™¤æ´¾èª²ç”¢ç”Ÿçš„äº‹ä»¶
        schedule.push({
          date: event.date,
          time: event.time || 'å…¨å¤©',
          title: event.title,
          type: event.location || 'è¡Œäº‹æ›†',
          source: 'è¡Œäº‹æ›†'
        });
      }
    });

    return schedule.sort((a, b) => a.date.localeCompare(b.date) || (a.time || '').localeCompare(b.time || ''));
  }

  // æ¸²æŸ“è€å¸«æœ¬é€±èª²è¡¨
  function renderTeacherWeekSchedule() {
    if (!currentCourseTeacherId) {
      document.getElementById('teacherWeekSchedule').classList.add('hidden');
      return;
    }

    // ç²å–æœ¬é€±æ—¥æœŸç¯„åœ
    const today = new Date();
    const dayOfWeek = today.getDay();
    const monday = new Date(today);
    monday.setDate(today.getDate() - dayOfWeek + (dayOfWeek === 0 ? -6 : 1));
    const sunday = new Date(monday);
    sunday.setDate(monday.getDate() + 6);

    const startDate = monday.toISOString().split('T')[0];
    const endDate = sunday.toISOString().split('T')[0];

    // ç²å–èª²è¡¨
    const schedule = getTeacherSchedule(currentCourseTeacherId, startDate, endDate);

    const container = document.getElementById('teacherWeekScheduleContent');
    const scheduleDiv = document.getElementById('teacherWeekSchedule');

    if (schedule.length === 0) {
      scheduleDiv.classList.add('hidden');
      return;
    }

    scheduleDiv.classList.remove('hidden');

    // æŒ‰æ—¥æœŸåˆ†çµ„
    const groupedByDate = {};
    schedule.forEach(item => {
      if (!groupedByDate[item.date]) {
        groupedByDate[item.date] = [];
      }
      groupedByDate[item.date].push(item);
    });

    // ç”Ÿæˆ HTML
    const weekDays = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
    let html = '<div class="grid grid-cols-1 md:grid-cols-7 gap-3">';

    for (let i = 0; i < 7; i++) {
      const date = new Date(monday);
      date.setDate(monday.getDate() + i);
      const dateStr = date.toISOString().split('T')[0];
      const dayEvents = groupedByDate[dateStr] || [];
      const isToday = dateStr === today.toISOString().split('T')[0];

      html += `
        <div class="border rounded-lg p-3 ${isToday ? 'bg-blue-50 border-blue-300' : 'bg-gray-50'}">
          <div class="font-semibold text-sm mb-2 ${isToday ? 'text-blue-700' : 'text-gray-700'}">
            é€±${weekDays[date.getDay()]} ${date.getMonth() + 1}/${date.getDate()}
            ${isToday ? '<span class="text-xs ml-1">(ä»Šå¤©)</span>' : ''}
          </div>
          <div class="space-y-2">
      `;

      if (dayEvents.length === 0) {
        html += '<div class="text-xs text-green-600 bg-green-50 rounded px-2 py-1">âœ“ å…¨å¤©å¯ç”¨</div>';
      } else {
        dayEvents.forEach(event => {
          const bgColor = event.source === 'æ´¾èª²' ? 'bg-red-50 text-red-700' : 'bg-orange-50 text-orange-700';
          html += `
            <div class="text-xs ${bgColor} rounded px-2 py-1">
              <div class="font-semibold">${event.time}</div>
              <div class="truncate" title="${event.title}">${event.title}</div>
              <div class="text-xs opacity-75">${event.type}</div>
            </div>
          `;
        });
      }

      html += `
          </div>
        </div>
      `;
    }

    html += '</div>';
    container.innerHTML = html;
  }

  // ========== æ´¾èª²ç®¡ç†åŠŸèƒ½çµæŸ ==========

  // ========== URL è·¯ç”±ç³»çµ± ==========
  // è®“ç€è¦½å™¨å‰é€²/å¾Œé€€æŒ‰éˆ•å¯ä»¥ä½¿ç”¨ï¼Œæ¯å€‹é é¢éƒ½æœ‰ç¨ç«‹ç¶²å€

  const routes = {
    '': 'teacherList',              // ä¸»é 
    'list': 'teacherList',          // å¸«è³‡åˆ—è¡¨
    'statistics': 'executiveView',  // çµ±è¨ˆåˆ†æ
    'calendar': 'calendarView',     // è¡Œäº‹æ›†
    'courses': 'courseManagementView', // æ´¾èª²ç®¡ç†
    'maritime': 'maritimeCourseView', // æµ·äº‹èª²ç¨‹ç³»çµ±
    'teacher': 'teacherDetail',     // å¸«è³‡è©³ç´°ï¼ˆç·¨è¼¯ï¼‰
    'teacher-view': 'teacherDetailView' // å¸«è³‡è©³ç´°ï¼ˆå‘ˆç¾ï¼‰
  };

  // ç²å–ç•¶å‰è·¯ç”±
  function getCurrentRoute() {
    const hash = window.location.hash.slice(1); // ç§»é™¤ #
    return hash || '';
  }

  // è¨­å®šè·¯ç”±ï¼ˆæ›´æ–° URLï¼‰
  function setRoute(route) {
    window.location.hash = route;
  }

  // æ ¹æ“šè·¯ç”±é¡¯ç¤ºå°æ‡‰è¦–åœ–
  function handleRoute() {
    const route = getCurrentRoute();
    const viewId = routes[route] || routes[''];

    // éš±è—æ‰€æœ‰è¦–åœ–
    document.getElementById('teacherList')?.classList.add('hidden');
    document.getElementById('executiveView')?.classList.add('hidden');
    document.getElementById('calendarView')?.classList.add('hidden');
    document.getElementById('courseManagementView')?.classList.add('hidden');
    document.getElementById('maritimeCourseView')?.classList.add('hidden');
    document.getElementById('teacherDetail')?.classList.add('hidden');
    document.getElementById('teacherDetailView')?.classList.add('hidden');

    // é¡¯ç¤ºç•¶å‰è¦–åœ–
    const currentView = document.getElementById(viewId);
    if (currentView) {
      currentView.classList.remove('hidden');

      // ç‰¹æ®Šè™•ç†ï¼šæŸäº›è¦–åœ–éœ€è¦é‡æ–°æ¸²æŸ“
      if (route === 'statistics') {
        renderStatisticsView();
      } else if (route === 'calendar') {
        renderCalendar();
        startReminderCheck();
      } else if (route === 'courses') {
        // åˆå§‹åŒ–æ´¾èª²ç®¡ç†è¦–åœ–
        const teacherSelect = document.getElementById('courseTeacherSelect');
        if (teacherSelect && teacherSelect.children.length <= 1) {
          teacherSelect.innerHTML = '<option value="">è«‹é¸æ“‡å¸«è³‡</option>';
          teachers.forEach(teacher => {
            const option = document.createElement('option');
            option.value = teacher.id;
            option.textContent = teacher.name;
            teacherSelect.appendChild(option);
          });
          initCourseDates();
        }
      } else if (route === 'maritime') {
        // åˆå§‹åŒ–æµ·äº‹èª²ç¨‹ç³»çµ±
        if (typeof initMaritimeCourseSystem === 'function') {
          initMaritimeCourseSystem();
        }
      } else if (route === 'list' || route === '') {
        // è¿”å›åˆ—è¡¨æ™‚é‡æ–°æ¸²æŸ“ä¸¦ç¢ºä¿æ¨¡å¼ç‹€æ…‹æ­£ç¢ºåŒæ­¥
        if (typeof switchMode === 'function' && typeof currentMode !== 'undefined') {
          switchMode(currentMode);
        } else if (typeof renderTeacherGrid === 'function') {
          renderTeacherGrid();
        }
      }
      // teacher å’Œ teacher-view è·¯ç”±ä¸éœ€è¦ç‰¹æ®Šè™•ç†ï¼Œå…§å®¹å·²ç”±å°æ‡‰å‡½æ•¸å¡«å……
    }
  }

  // ç›£è½ URL è®ŠåŒ–ï¼ˆç€è¦½å™¨å‰é€²/å¾Œé€€ï¼‰
  window.addEventListener('hashchange', handleRoute);

  // é é¢è¼‰å…¥æ™‚è™•ç†è·¯ç”±
  window.addEventListener('load', handleRoute);

  // æ›´æ–°æ‰€æœ‰è¦–åœ–åˆ‡æ›å‡½æ•¸ï¼Œä½¿ç”¨è·¯ç”±
  window.showStatisticsView = function() {
    setRoute('statistics');
  };

  window.showCalendarView = function() {
    setRoute('calendar');
  };

  window.showCourseManagementView = function() {
    setRoute('courses');
  };

  window.backToList = function() {
    // åœæ­¢æé†’æª¢æŸ¥ï¼ˆå¦‚æœå¾è¡Œäº‹æ›†è¿”å›ï¼‰
    if (typeof stopReminderCheck === 'function') stopReminderCheck();
    // éš±è—æ‰€æœ‰è©³ç´°è¦–åœ–
    document.getElementById('teacherDetail')?.classList.add('hidden');
    document.getElementById('teacherDetailView')?.classList.add('hidden');
    // é¡¯ç¤ºå¸«è³‡åˆ—è¡¨
    document.getElementById('teacherList')?.classList.remove('hidden');
    // é‡æ–°æ¸²æŸ“ä»¥ç¢ºä¿æ¨¡å¼ç‹€æ…‹æ­£ç¢º
    if (typeof window.switchMode === 'function' && typeof window.currentMode !== 'undefined') {
      window.switchMode(window.currentMode);
    }
    // æ›´æ–°è·¯ç”±
    setRoute('list');
  };

  window.backToListFromExecutive = function() {
    setRoute('list');
  };

  window.backToListFromCalendar = function() {
    if (typeof stopReminderCheck === 'function') stopReminderCheck();
    setRoute('list');
  };

  window.backToListFromCourseManagement = function() {
    setRoute('list');
  };

  window.showMaritimeCourseView = function() {
    setRoute('maritime');
  };

  window.backToListFromMaritimeCourse = function() {
    setRoute('list');
  };

  // ========== URL è·¯ç”±ç³»çµ±çµæŸ ==========

  // ========== æµ·äº‹èª²ç¨‹ç³»çµ± JavaScript ==========
  </script>
  <script>
  // èª²ç¨‹è³‡æ–™å„²å­˜
  let maritimeCourses = JSON.parse(localStorage.getItem('maritimeCourses')) || [];
  let editingMaritimeCourseId = null;

  // åˆ†é¡å°æ‡‰è¡¨
  const maritimeCategoryNames = {
    '01': '01èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™è¨“ç·´',
    '02': '02é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°ç®¡ç†',
    '03': '03äº‹æ•…æ¡ˆä¾‹åˆ†æèˆ‡æ‡‰è®Šè™•ç½®è¨“ç·´',
    '04': '04èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´',
    '05': '05åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒåˆè¦çŸ¥è­˜',
    '06': '06èˆ¹èˆ¶è²¨ç‰©è£å¸ä½œæ¥­å¯¦å‹™',
    '07': '07èˆ¹å“¡ç¶“é©—äº¤æµèˆ‡è·èƒ½å›é¥‹',
    '08': '08è·ç´šè½‰æ›èˆ‡å£“åŠ›èª¿é©',
    '09': '09å…¶ä»–'
  };

  // åˆå§‹åŒ–ç¤ºä¾‹è³‡æ–™
  if (maritimeCourses.length === 0) {
    maritimeCourses = [
      {
        id: 1,
        name: 'èˆ¹èˆ¶å°èˆªç³»çµ±æ“ä½œ',
        category: '01',
        method: 'å¯¦é«”èª²ç¨‹',
        description: 'å­¸ç¿’ç¾ä»£èˆ¹èˆ¶å°èˆªç³»çµ±çš„æ“ä½œï¼ŒåŒ…æ‹¬GPSã€é›·é”ã€é›»å­æµ·åœ–ç­‰è¨­å‚™çš„ä½¿ç”¨æ–¹æ³•å’Œæ³¨æ„äº‹é …ã€‚',
        keywords: ['GPS', 'é›·é”', 'é›»å­æµ·åœ–', 'å°èˆª', 'å®šä½', 'èˆªè¡Œå®‰å…¨']
      },
      {
        id: 2,
        name: 'èˆ¹å“¡é ˜å°åŠ›åŸ¹è¨“',
        category: '02',
        method: 'ç·šä¸Šèª²ç¨‹',
        description: 'æå‡èˆ¹å“¡çš„é ˜å°èƒ½åŠ›å’Œåœ˜éšŠç®¡ç†æŠ€å·§ï¼Œå­¸ç¿’æœ‰æ•ˆçš„æºé€šæ–¹å¼å’Œè¡çªè§£æ±ºæ–¹æ³•ã€‚',
        keywords: ['é ˜å°åŠ›', 'åœ˜éšŠç®¡ç†', 'æºé€šæŠ€å·§', 'è¡çªè§£æ±º', 'äººå“¡ç®¡ç†']
      },
      {
        id: 3,
        name: 'æµ·ä¸Šç·Šæ€¥æ‡‰è®Šè™•ç†',
        category: '03',
        method: 'æ··åˆèª²ç¨‹',
        description: 'å­¸ç¿’å„ç¨®æµ·ä¸Šç·Šæ€¥æƒ…æ³çš„æ‡‰è®Šè™•ç†ç¨‹åºï¼ŒåŒ…æ‹¬ç«ç½ã€ç¢°æ’ã€äººå“¡è½æ°´ç­‰äº‹æ•…çš„è™•ç†ã€‚',
        keywords: ['ç·Šæ€¥æ‡‰è®Š', 'ç«ç½è™•ç†', 'ç¢°æ’äº‹æ•…', 'æ•‘ç”Ÿ', 'å®‰å…¨ç¨‹åº', 'äº‹æ•…è™•ç†']
      }
    ];
    saveMaritimeCourses();
  }

  // å„²å­˜èª²ç¨‹è³‡æ–™åˆ° localStorage å’Œå¾Œç«¯
  function saveMaritimeCourses() {
    localStorage.setItem('maritimeCourses', JSON.stringify(maritimeCourses));
    // åŒæ­¥åˆ°å¾Œç«¯
    saveMaritimeCoursesToBackend();
  }

  // å„²å­˜æµ·äº‹èª²ç¨‹æ•¸æ“šåˆ°å¾Œç«¯
  async function saveMaritimeCoursesToBackend() {
    if (!api || !syncManager) return;
    try {
      await syncManager.saveTable('maritimeCourses');
      console.log('âœ… æµ·äº‹èª²ç¨‹æ•¸æ“šå·²åŒæ­¥åˆ°å¾Œç«¯');
    } catch (error) {
      console.warn('âš ï¸ æµ·äº‹èª²ç¨‹æ•¸æ“šå¾Œç«¯åŒæ­¥å¤±æ•—:', error);
    }
  }

  // å¾å¾Œç«¯è¼‰å…¥æµ·äº‹èª²ç¨‹æ•¸æ“š
  async function loadMaritimeCoursesFromBackend() {
    if (!api) {
      console.log('âš ï¸ API æœªåˆå§‹åŒ–ï¼Œè·³éå¾å¾Œç«¯è¼‰å…¥æµ·äº‹èª²ç¨‹');
      return;
    }

    try {
      console.log('ğŸŒ å˜—è©¦å¾å¾Œç«¯ API è¼‰å…¥æµ·äº‹èª²ç¨‹æ•¸æ“š...');
      const data = await api.list('maritimeCourses');

      if (Array.isArray(data)) {
        if (data.length > 0) {
          console.log('âœ… å¾å¾Œç«¯ API è¼‰å…¥æµ·äº‹èª²ç¨‹æ•¸æ“šæˆåŠŸï¼Œå…±', data.length, 'ç­†');
          maritimeCourses = data;
          localStorage.setItem('maritimeCourses', JSON.stringify(maritimeCourses));

          // æ›´æ–°é¡¯ç¤ºï¼ˆå¦‚æœæ­£åœ¨æµ·äº‹èª²ç¨‹é é¢ï¼‰
          if (window.location.hash === '#maritime') {
            displayMaritimeCourses();
            displayManageMaritimeCourses();
          }
        } else {
          console.log('ğŸ“ å¾Œç«¯ API è¿”å›ç©ºçš„æµ·äº‹èª²ç¨‹æ•¸æ“š');
          // ä¸è¦æ¸…ç©ºæœ¬åœ°æ•¸æ“š
          if (maritimeCourses.length > 0) {
            console.log('ğŸ“Œ ä¿ç•™æœ¬åœ°æµ·äº‹èª²ç¨‹æ•¸æ“šï¼Œå…±', maritimeCourses.length, 'ç­†');
          }
        }
      }
    } catch (error) {
      console.warn('âš ï¸ å¾å¾Œç«¯ API è¼‰å…¥æµ·äº‹èª²ç¨‹æ•¸æ“šå¤±æ•—:', error.message);
      if (maritimeCourses.length > 0) {
        console.log('ğŸ“Œ ä½¿ç”¨æœ¬åœ°æµ·äº‹èª²ç¨‹æ•¸æ“šï¼Œå…±', maritimeCourses.length, 'ç­†');
      } else {
        console.warn('âŒ æ²’æœ‰æœ¬åœ°æµ·äº‹èª²ç¨‹æ•¸æ“šå¯ç”¨');
      }
    }
  }

  // é é¢åˆ‡æ›åŠŸèƒ½
  function switchMaritimeTab(tab) {
    // éš±è—æ‰€æœ‰é é¢
    document.getElementById('maritimeViewPage').classList.add('hidden');
    document.getElementById('maritimeEditPage').classList.add('hidden');
    document.getElementById('maritimeStatsPage').classList.add('hidden');

    // é‡ç½®æ‰€æœ‰æŒ‰éˆ•æ¨£å¼
    document.querySelectorAll('#maritimeCourseView nav button').forEach(btn => {
      btn.className = 'px-6 py-2 rounded-md text-blue-600 hover:bg-blue-50 font-medium transition-colors';
    });

    // é¡¯ç¤ºé¸ä¸­çš„é é¢å’Œæ›´æ–°æŒ‰éˆ•æ¨£å¼
    if (tab === 'view') {
      document.getElementById('maritimeViewPage').classList.remove('hidden');
      document.getElementById('maritimeViewTab').className = 'px-6 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors';
      displayMaritimeCourses();
    } else if (tab === 'edit') {
      document.getElementById('maritimeEditPage').classList.remove('hidden');
      document.getElementById('maritimeEditTab').className = 'px-6 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors';
      displayManageMaritimeCourses();
    } else if (tab === 'stats') {
      document.getElementById('maritimeStatsPage').classList.remove('hidden');
      document.getElementById('maritimeStatsTab').className = 'px-6 py-2 rounded-md bg-blue-600 text-white font-medium transition-colors';
      displayMaritimeStats();
    }
  }

  // é¡¯ç¤ºèª²ç¨‹åˆ—è¡¨
  function displayMaritimeCourses() {
    const searchTerm = document.getElementById('maritimeSearchInput').value.toLowerCase();
    const categoryFilter = document.getElementById('maritimeCategoryFilter').value;
    const resultsContainer = document.getElementById('maritimeCourseResults');

    let filteredCourses = maritimeCourses.filter(course => {
      const matchesSearch = !searchTerm ||
        course.name.toLowerCase().includes(searchTerm) ||
        course.description.toLowerCase().includes(searchTerm) ||
        course.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm));

      const matchesCategory = !categoryFilter || course.category === categoryFilter;

      return matchesSearch && matchesCategory;
    });

    resultsContainer.innerHTML = '';

    if (filteredCourses.length === 0) {
      resultsContainer.innerHTML = '<div class="col-span-full text-center py-8 text-gray-500">æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„èª²ç¨‹</div>';
      return;
    }

    filteredCourses.forEach(course => {
      const courseCard = document.createElement('div');
      courseCard.className = 'bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow fade-in cursor-pointer';

      // é»æ“Šå­—å¡é€²å…¥ç·¨è¼¯ï¼ˆä½¿ç”¨å½ˆè·³è¦–çª—ï¼‰
      courseCard.onclick = function(e) {
        editMaritimeCourse(course.id);
      };

      const highlightedName = highlightMaritimeText(course.name, searchTerm);
      const highlightedDescription = highlightMaritimeText(course.description, searchTerm);
      const highlightedKeywords = course.keywords.map(keyword => highlightMaritimeText(keyword, searchTerm));

      courseCard.innerHTML = `
        <div class="mb-3">
          <div class="flex flex-wrap gap-2 mb-2">
            <span class="inline-block bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full">
              ${maritimeCategoryNames[course.category]}
            </span>
            <span class="inline-block text-xs px-2 py-1 rounded-full ${getMaritimeMethodTagClass(course.method)}">
              ${course.method || 'æœªè¨­å®š'}
            </span>
          </div>
          <h3 class="text-lg font-bold text-gray-800">${highlightedName}</h3>
        </div>
        <p class="text-gray-600 mb-4">${highlightedDescription}</p>
        <div class="flex flex-wrap gap-1">
          ${highlightedKeywords.map(keyword =>
            `<span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded">${keyword}</span>`
          ).join('')}
        </div>
      `;

      resultsContainer.appendChild(courseCard);
    });
  }

  // é«˜äº®é¡¯ç¤ºæœå°‹é—œéµå­—
  function highlightMaritimeText(text, searchTerm) {
    if (!searchTerm) return text;
    const regex = new RegExp(`(${searchTerm})`, 'gi');
    return text.replace(regex, '<span class="highlight">$1</span>');
  }

  // å–å¾—æˆèª²æ–¹å¼æ¨™ç±¤æ¨£å¼
  function getMaritimeMethodTagClass(method) {
    switch(method) {
      case 'å¯¦é«”èª²ç¨‹':
        return 'bg-blue-100 text-blue-800';
      case 'ç·šä¸Šèª²ç¨‹':
        return 'bg-green-100 text-green-800';
      case 'æ··åˆèª²ç¨‹':
        return 'bg-orange-100 text-orange-800';
      default:
        return 'bg-gray-100 text-gray-800';
    }
  }

  // é¡¯ç¤ºç®¡ç†èª²ç¨‹åˆ—è¡¨
  function displayManageMaritimeCourses() {
    const searchTerm = document.getElementById('maritimeManageSearchInput').value.toLowerCase();
    const container = document.getElementById('maritimeManageCourseList');

    let filteredCourses = maritimeCourses.filter(course =>
      course.name.toLowerCase().includes(searchTerm) ||
      course.description.toLowerCase().includes(searchTerm) ||
      course.keywords.some(keyword => keyword.toLowerCase().includes(searchTerm))
    );

    container.innerHTML = '';

    if (filteredCourses.length === 0) {
      container.innerHTML = '<div class="text-center py-4 text-gray-500">æ²’æœ‰æ‰¾åˆ°èª²ç¨‹</div>';
      return;
    }

    filteredCourses.forEach(course => {
      const courseItem = document.createElement('div');
      courseItem.className = 'border border-gray-200 rounded-lg p-4 flex justify-between items-center';

      courseItem.innerHTML = `
        <div class="flex-1">
          <h4 class="font-semibold text-gray-800">${course.name}</h4>
          <p class="text-sm text-gray-600">${maritimeCategoryNames[course.category]}</p>
          <p class="text-xs text-gray-500 mt-1">é—œéµå­—: ${course.keywords.join(', ')}</p>
        </div>
        <div class="flex gap-2">
          <button onclick="editMaritimeCourse(${course.id})" class="bg-yellow-500 text-white px-3 py-1 rounded text-sm hover:bg-yellow-600 transition-colors">
            ç·¨è¼¯
          </button>
          <button onclick="deleteMaritimeCourse(${course.id})" class="bg-red-500 text-white px-3 py-1 rounded text-sm hover:bg-red-600 transition-colors">
            åˆªé™¤
          </button>
        </div>
      `;

      container.appendChild(courseItem);
    });
  }

  // ç·¨è¼¯èª²ç¨‹ï¼ˆä½¿ç”¨å½ˆè·³è¦–çª—ï¼‰
  function editMaritimeCourse(courseId) {
    const course = maritimeCourses.find(c => c.id === courseId);
    if (!course) return;

    editingMaritimeCourseId = courseId;
    document.getElementById('maritimeModalTitle').textContent = 'ç·¨è¼¯èª²ç¨‹';
    document.getElementById('maritimeCourseNameModal').value = course.name;
    document.getElementById('maritimeCourseCategoryModal').value = course.category;
    document.getElementById('maritimeCourseMethodModal').value = course.method || '';
    document.getElementById('maritimeCourseDescriptionModal').value = course.description;
    document.getElementById('maritimeCourseKeywordsModal').value = course.keywords.join(', ');

    // é¡¯ç¤ºåˆªé™¤æŒ‰éˆ•ï¼ˆåƒ…ç·¨è¼¯æ™‚ï¼‰
    document.getElementById('maritimeDeleteButtonContainer').style.display = 'block';

    // æ‰“é–‹å½ˆè·³è¦–çª—
    document.getElementById('maritimeCourseModal').classList.remove('hidden');
  }

  // é—œé–‰å½ˆè·³è¦–çª—
  function closeMaritimeCourseModal() {
    document.getElementById('maritimeCourseModal').classList.add('hidden');
    editingMaritimeCourseId = null;
    document.getElementById('maritimeCourseModalForm').reset();
    document.getElementById('maritimeModalTitle').textContent = 'æ–°å¢èª²ç¨‹';
    document.getElementById('maritimeDeleteButtonContainer').style.display = 'none';
  }

  // å¾å½ˆè·³è¦–çª—åˆªé™¤èª²ç¨‹
  function deleteMaritimeCourseFromModal() {
    if (!editingMaritimeCourseId) return;

    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹èª²ç¨‹å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
      maritimeCourses = maritimeCourses.filter(c => c.id !== editingMaritimeCourseId);
      saveMaritimeCourses();
      displayMaritimeCourses();
      displayManageMaritimeCourses();
      closeMaritimeCourseModal();
      showMaritimeMessage('èª²ç¨‹å·²åˆªé™¤', 'success');
    }
  }

  // å¾å½ˆè·³è¦–çª—å„²å­˜èª²ç¨‹
  function saveMaritimeCourseFromModal(event) {
    event.preventDefault();

    const name = document.getElementById('maritimeCourseNameModal').value.trim();
    const category = document.getElementById('maritimeCourseCategoryModal').value;
    const method = document.getElementById('maritimeCourseMethodModal').value;
    const description = document.getElementById('maritimeCourseDescriptionModal').value.trim();
    const keywordsInput = document.getElementById('maritimeCourseKeywordsModal').value.trim();
    const keywords = keywordsInput ? keywordsInput.split(',').map(k => k.trim()).filter(k => k) : [];

    if (editingMaritimeCourseId) {
      // æ›´æ–°ç¾æœ‰èª²ç¨‹
      const courseIndex = maritimeCourses.findIndex(c => c.id === editingMaritimeCourseId);
      maritimeCourses[courseIndex] = {
        ...maritimeCourses[courseIndex],
        name,
        category,
        method,
        description,
        keywords
      };
    } else {
      // æ–°å¢èª²ç¨‹
      const newCourse = {
        id: Date.now(),
        name,
        category,
        method,
        description,
        keywords
      };
      maritimeCourses.push(newCourse);
    }

    saveMaritimeCourses();
    displayMaritimeCourses();
    displayManageMaritimeCourses();
    closeMaritimeCourseModal();
    showMaritimeMessage(editingMaritimeCourseId ? 'èª²ç¨‹å·²æ›´æ–°' : 'èª²ç¨‹å·²æ–°å¢', 'success');
  }

  // åˆªé™¤èª²ç¨‹
  function deleteMaritimeCourse(courseId) {
    if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹èª²ç¨‹å—ï¼Ÿ')) {
      maritimeCourses = maritimeCourses.filter(c => c.id !== courseId);
      saveMaritimeCourses();
      displayMaritimeCourses(); // æ›´æ–°æœå°‹é é¢
      displayManageMaritimeCourses(); // æ›´æ–°ç®¡ç†é é¢
      showMaritimeMessage('èª²ç¨‹å·²åˆªé™¤', 'success');
    }
  }

  // é¡¯ç¤ºçµ±è¨ˆè³‡æ–™
  function displayMaritimeStats() {
    // ç¸½èª²ç¨‹æ•¸
    document.getElementById('maritimeTotalCourses').textContent = maritimeCourses.length;

    // ç¸½é—œéµå­—æ•¸
    const allKeywords = maritimeCourses.flatMap(course => course.keywords);
    document.getElementById('maritimeTotalKeywords').textContent = allKeywords.length;

    // æœ€ç†±é–€åˆ†é¡
    const categoryCount = {};
    maritimeCourses.forEach(course => {
      categoryCount[course.category] = (categoryCount[course.category] || 0) + 1;
    });

    const popularCategoryCode = Object.keys(categoryCount).reduce((a, b) =>
      categoryCount[a] > categoryCount[b] ? a : b, '');
    document.getElementById('maritimePopularCategory').textContent =
      popularCategoryCode ? maritimeCategoryNames[popularCategoryCode] : '-';

    // å„åˆ†é¡çµ±è¨ˆ
    const categoryStatsContainer = document.getElementById('maritimeCategoryStats');
    categoryStatsContainer.innerHTML = '';

    const colors = ['#4f46e5', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#f97316', '#84cc16', '#ec4899'];

    Object.keys(maritimeCategoryNames).forEach((categoryCode, index) => {
      const count = categoryCount[categoryCode] || 0;
      const percentage = maritimeCourses.length > 0 ? (count / maritimeCourses.length * 100).toFixed(1) : 0;

      const statItem = document.createElement('div');
      statItem.className = 'flex justify-between items-center py-2 border-b border-gray-200';
      statItem.innerHTML = `
        <span class="text-gray-700 text-sm">${maritimeCategoryNames[categoryCode].substring(0, 15)}...</span>
        <div class="flex items-center gap-2">
          <div class="w-20 bg-gray-200 rounded-full h-2">
            <div class="h-2 rounded-full" style="width: ${percentage}%; background-color: ${colors[index]}"></div>
          </div>
          <span class="text-xs font-semibold text-gray-600 w-12">${count}</span>
        </div>
      `;
      categoryStatsContainer.appendChild(statItem);
    });

    // åœ“é¤…åœ–
    displayMaritimePieChart(categoryCount, colors);

    // æˆèª²æ–¹å¼çµ±è¨ˆ
    const methodCount = {};
    maritimeCourses.forEach(course => {
      const method = course.method || 'æœªè¨­å®š';
      methodCount[method] = (methodCount[method] || 0) + 1;
    });

    const methodStatsContainer = document.getElementById('maritimeMethodStats');
    methodStatsContainer.innerHTML = '';

    const methodColors = { 'å¯¦é«”èª²ç¨‹': '#3b82f6', 'ç·šä¸Šèª²ç¨‹': '#10b981', 'æ··åˆèª²ç¨‹': '#f59e0b', 'æœªè¨­å®š': '#6b7280' };
    const methodIcons = { 'å¯¦é«”èª²ç¨‹': 'ğŸ«', 'ç·šä¸Šèª²ç¨‹': 'ğŸ’»', 'æ··åˆèª²ç¨‹': 'ğŸ”„', 'æœªè¨­å®š': 'â“' };

    Object.entries(methodCount).forEach(([method, count]) => {
      const percentage = maritimeCourses.length > 0 ? (count / maritimeCourses.length * 100).toFixed(1) : 0;
      const angle = (count / maritimeCourses.length * 360).toFixed(1);

      const methodItem = document.createElement('div');
      methodItem.className = 'method-card';
      methodItem.innerHTML = `
        <div class="donut-chart mx-auto mb-4 ${count > 0 ? 'pulse-animation' : ''}"
             style="--color: ${methodColors[method]}; --angle: ${angle}deg;">
          <div class="donut-chart-label">${count}</div>
        </div>
        <div class="text-2xl mb-2">${methodIcons[method]}</div>
        <h4 class="font-bold text-gray-800 mb-1">${method}</h4>
        <p class="text-sm text-gray-600">${percentage}% çš„èª²ç¨‹</p>
        <div class="mt-2 text-xs text-gray-500">
          å…± ${count} é–€èª²ç¨‹
        </div>
      `;
      methodStatsContainer.appendChild(methodItem);
    });

    // é—œéµå­—é›²
    const keywordCount = {};
    allKeywords.forEach(keyword => {
      keywordCount[keyword] = (keywordCount[keyword] || 0) + 1;
    });

    const sortedKeywords = Object.entries(keywordCount)
      .sort(([,a], [,b]) => b - a)
      .slice(0, 20);

    const keywordCloudContainer = document.getElementById('maritimeKeywordCloud');
    keywordCloudContainer.innerHTML = '';

    sortedKeywords.forEach(([keyword, count]) => {
      const keywordTag = document.createElement('span');
      const fontSize = Math.min(16 + count * 2, 24);
      keywordTag.className = 'bg-gradient-to-r from-blue-500 to-purple-600 text-white px-3 py-1 rounded-full text-sm font-medium';
      keywordTag.style.fontSize = `${fontSize}px`;
      keywordTag.textContent = `${keyword} (${count})`;
      keywordCloudContainer.appendChild(keywordTag);
    });
  }

  // é¡¯ç¤ºåœ“é¤…åœ–
  function displayMaritimePieChart(categoryCount, colors) {
    const pieChart = document.getElementById('maritimePieChart');
    const chartLegend = document.getElementById('maritimeChartLegend');

    const total = Object.values(categoryCount).reduce((sum, count) => sum + count, 0);

    if (total === 0) {
      pieChart.style.background = '#e5e7eb';
      chartLegend.innerHTML = '<p class="text-gray-500 text-center">æš«ç„¡è³‡æ–™</p>';
      return;
    }

    let currentAngle = 0;
    const angles = [];

    Object.keys(maritimeCategoryNames).forEach((categoryCode, index) => {
      const count = categoryCount[categoryCode] || 0;
      const percentage = (count / total) * 360;
      currentAngle += percentage;
      angles.push(currentAngle);
    });

    // è¨­å®šCSSè®Šæ•¸
    angles.forEach((angle, index) => {
      pieChart.style.setProperty(`--angle${index + 1}`, `${angle}deg`);
    });

    // åœ–ä¾‹
    chartLegend.innerHTML = '';
    Object.keys(maritimeCategoryNames).forEach((categoryCode, index) => {
      const count = categoryCount[categoryCode] || 0;
      const percentage = total > 0 ? ((count / total) * 100).toFixed(1) : 0;

      if (count > 0) {
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item flex items-center gap-3 text-sm';
        legendItem.innerHTML = `
          <div class="legend-color" style="background-color: ${colors[index]}"></div>
          <div class="flex-1">
            <span class="text-gray-800 font-medium">${maritimeCategoryNames[categoryCode].substring(2, 12)}...</span>
            <div class="text-xs text-gray-500">${count} é–€èª²ç¨‹ (${percentage}%)</div>
          </div>
        `;
        chartLegend.appendChild(legendItem);
      }
    });
  }

  // é¡¯ç¤ºè¨Šæ¯
  function showMaritimeMessage(message, type = 'info') {
    const messageDiv = document.createElement('div');
    messageDiv.className = `fixed top-4 right-4 px-6 py-3 rounded-lg text-white z-50 ${
      type === 'success' ? 'bg-green-500' : 'bg-blue-500'
    }`;
    messageDiv.textContent = message;

    document.body.appendChild(messageDiv);

    setTimeout(() => {
      messageDiv.remove();
    }, 3000);
  }

  // åˆå§‹åŒ–æµ·äº‹èª²ç¨‹ç³»çµ±äº‹ä»¶ç›£è½å™¨
  function initMaritimeCourseSystem() {
    // é é¢åˆ‡æ›
    const viewTab = document.getElementById('maritimeViewTab');
    const editTab = document.getElementById('maritimeEditTab');
    const statsTab = document.getElementById('maritimeStatsTab');

    if (viewTab) viewTab.addEventListener('click', () => switchMaritimeTab('view'));
    if (editTab) editTab.addEventListener('click', () => switchMaritimeTab('edit'));
    if (statsTab) statsTab.addEventListener('click', () => switchMaritimeTab('stats'));

    // æœå°‹åŠŸèƒ½
    const searchInput = document.getElementById('maritimeSearchInput');
    const categoryFilter = document.getElementById('maritimeCategoryFilter');
    const manageSearchInput = document.getElementById('maritimeManageSearchInput');

    if (searchInput) searchInput.addEventListener('input', displayMaritimeCourses);
    if (categoryFilter) categoryFilter.addEventListener('change', displayMaritimeCourses);
    if (manageSearchInput) manageSearchInput.addEventListener('input', displayManageMaritimeCourses);

    // èª²ç¨‹è¡¨å–®è™•ç†
    const courseForm = document.getElementById('maritimeCourseForm');
    if (courseForm) {
      courseForm.addEventListener('submit', function(e) {
        e.preventDefault();

        const name = document.getElementById('maritimeCourseName').value;
        const category = document.getElementById('maritimeCourseCategory').value;
        const method = document.getElementById('maritimeCourseMethod').value;
        const description = document.getElementById('maritimeCourseDescription').value;
        const keywords = document.getElementById('maritimeCourseKeywords').value
          .split(',')
          .map(k => k.trim())
          .filter(k => k.length > 0);

        if (editingMaritimeCourseId) {
          // ç·¨è¼¯ç¾æœ‰èª²ç¨‹
          const courseIndex = maritimeCourses.findIndex(c => c.id === editingMaritimeCourseId);
          maritimeCourses[courseIndex] = {
            ...maritimeCourses[courseIndex],
            name,
            category,
            method,
            description,
            keywords
          };
          editingMaritimeCourseId = null;
        } else {
          // æ–°å¢èª²ç¨‹
          const newCourse = {
            id: Date.now(),
            name,
            category,
            method,
            description,
            keywords
          };
          maritimeCourses.push(newCourse);
        }

        saveMaritimeCourses();
        this.reset();
        displayManageMaritimeCourses();

        showMaritimeMessage('èª²ç¨‹å·²æˆåŠŸå„²å­˜ï¼', 'success');
      });
    }

    // å–æ¶ˆç·¨è¼¯
    const cancelEdit = document.getElementById('maritimeCancelEdit');
    if (cancelEdit) {
      cancelEdit.addEventListener('click', function() {
        document.getElementById('maritimeCourseForm').reset();
        editingMaritimeCourseId = null;
        document.querySelector('#maritimeCourseForm button[type="submit"]').textContent = 'å„²å­˜èª²ç¨‹';
      });
    }

    // åˆå§‹åŒ–é¡¯ç¤º
    displayMaritimeCourses();
  }

  // ç¢ºä¿åœ¨é é¢åŠ è¼‰å’Œè·¯ç”±è®ŠåŒ–æ™‚åˆå§‹åŒ–
  window.addEventListener('load', function() {
    if (window.location.hash === '#maritime') {
      setTimeout(initMaritimeCourseSystem, 100);
    }
  });

  window.addEventListener('hashchange', function() {
    if (window.location.hash === '#maritime') {
      setTimeout(initMaritimeCourseSystem, 100);
    }
  });

  // å°‡å‡½æ•¸æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
  window.editMaritimeCourse = editMaritimeCourse;
  window.deleteMaritimeCourse = deleteMaritimeCourse;

  // ========== æµ·äº‹èª²ç¨‹ç³»çµ±çµæŸ ==========
  </script>
</body>
</html>
