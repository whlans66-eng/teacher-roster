<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ™ºæ…§æ´¾èª² | æµ·äº‹å°ˆæ¥­è¨“ç·´èª²ç¨‹ç³»çµ±</title>

  <style>
  :root {
    --apple-blue: #0071e3;
    --apple-blue-hover: #0077ed;
    --apple-text: #1d1d1f;
    --apple-gray: #86868b;
    --glass-bg: rgba(255, 255, 255, 0.65);
    --glass-border: rgba(255, 255, 255, 0.4);
    --card-radius: 20px;
    --shadow-soft: 0 10px 30px rgba(0, 0, 0, 0.05);
  }

  * { box-sizing: border-box; font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont, sans-serif; margin: 0; padding: 0; }

  body {
    background: #f5f5f7;
    min-height: 100vh;
    color: var(--apple-text);
    padding-bottom: 40px;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .container { max-width: 1200px; margin: 0 auto; padding: 40px 20px; animation: floatUp 0.8s ease; }

  @keyframes floatUp {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* é ‚éƒ¨å°èˆª */
  .header-nav { display: flex; justify-content: space-between; align-items: center; margin-bottom: 40px; }
  .back-btn {
    display: flex; align-items: center; gap: 6px; color: var(--apple-text);
    text-decoration: none; font-weight: 500; font-size: 15px; padding: 10px 20px;
    background: #ffffff; border-radius: 30px;
    border: 1px solid rgba(0, 0, 0, 0.04); transition: all 0.3s ease;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
  .back-btn:hover { background: #ffffff; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08); }
  .page-title { text-align: center; flex: 1; }
  .page-title h1 { font-size: 28px; font-weight: 700; }
  .page-title p { font-size: 13px; color: var(--apple-gray); margin-top: 4px; font-weight: 500; }

  /* iOS åˆ†é åˆ‡æ› */
  .segmented-control {
    background: #ffffff; padding: 4px;
    border-radius: 12px; display: flex; margin: 0 auto 40px auto; width: 100%; max-width: 400px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
    border: 1px solid rgba(0, 0, 0, 0.04);
  }
  .segment-btn {
    flex: 1; border: none; background: transparent; padding: 8px 0; border-radius: 9px;
    font-size: 13px; font-weight: 500; color: var(--apple-text); cursor: pointer; transition: all 0.3s ease;
  }
  .segment-btn.active { background: #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.12); font-weight: 600; }

  /* ç™½è‰²å¡ç‰‡ */
  .glass-panel {
    background: #ffffff;
    border: 1px solid rgba(0, 0, 0, 0.04); border-radius: var(--card-radius);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
    padding: 30px; margin-bottom: 24px; transition: transform 0.3s ease;
  }

  /* è¼¸å…¥æ¡† */
  .ios-input {
    width: 100%; padding: 14px 16px; border-radius: 12px;
    border: 1px solid rgba(0, 0, 0, 0.1);
    background: #f5f5f7; font-size: 15px; transition: all 0.2s;
  }
  .ios-input:focus { outline: none; background: #fff; border-color: var(--apple-blue); box-shadow: 0 0 0 4px rgba(0, 113, 227, 0.15); }

  /* æŒ‰éˆ• */
  .primary-btn {
    background: var(--apple-blue); color: white; border: none; border-radius: 12px;
    padding: 12px 24px; font-weight: 600; cursor: pointer; transition: all 0.2s; font-size: 15px;
  }
  .primary-btn:hover { background: var(--apple-blue-hover); transform: scale(1.02); }

  .secondary-btn {
    background: rgba(0, 0, 0, 0.05); color: var(--apple-text); border: none;
    border-radius: 12px; padding: 12px 24px; font-weight: 600; cursor: pointer; font-size: 15px;
  }
  .secondary-btn:hover { background: rgba(0, 0, 0, 0.1); }

  .danger-btn {
    background: rgba(255, 59, 48, 0.1); color: #ff3b30; border: none;
    border-radius: 12px; padding: 12px 24px; font-weight: 600; cursor: pointer; font-size: 15px;
  }
  .danger-btn:hover { background: rgba(255, 59, 48, 0.2); }

  /* èª²ç¨‹å¡ç‰‡ */
  .course-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 24px; }
  .course-card {
    background: #ffffff;
    border: 1px solid rgba(0, 0, 0, 0.04); border-radius: 20px; padding: 24px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); cursor: pointer;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
  .course-card:hover {
    transform: translateY(-8px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 12px 32px rgba(0, 0, 0, 0.08), 0 2px 4px rgba(0, 0, 0, 0.04);
    border-color: rgba(0, 122, 255, 0.1);
  }
  .course-title { font-size: 19px; font-weight: 700; margin-bottom: 8px; line-height: 1.3; }
  .badge {
    padding: 6px 12px; border-radius: 20px; font-size: 11px; font-weight: 600;
    text-transform: uppercase; letter-spacing: 0.5px; display: inline-block;
  }
  .badge-blue { background: rgba(0, 113, 227, 0.1); color: #0071e3; }
  .badge-green { background: rgba(52, 199, 89, 0.1); color: #34c759; }
  .badge-orange { background: rgba(255, 149, 0, 0.1); color: #ff9500; }

  /* é«˜äº® */
  .highlight { background-color: #fef3c7; padding: 2px 4px; border-radius: 3px; }

  /* çµ±è¨ˆå¡ç‰‡ */
  .stat-card {
    background: linear-gradient(135deg, #007aff 0%, #0051d5 100%);
    border-radius: 18px; padding: 28px; color: white; text-align: center;
    position: relative; overflow: hidden; transition: all 0.4s ease;
  }
  .stat-card.purple { background: linear-gradient(135deg, #5856d6 0%, #3634a3 100%); }
  .stat-card.green { background: linear-gradient(135deg, #34c759 0%, #248a3d 100%); }
  .stat-card:hover { transform: translateY(-4px); box-shadow: 0 16px 48px rgba(0, 122, 255, 0.3); }

  /* å½ˆçª— */
  .modal-backdrop {
    position: fixed; inset: 0; z-index: 9999; display: none; align-items: center; justify-content: center;
    background: rgba(0, 0, 0, 0.5);
  }
  .modal-backdrop.show { display: flex; }
  .apple-modal {
    background: #ffffff;
    border-radius: 24px; width: 90%; max-width: 560px; padding: 32px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(0, 0, 0, 0.04);
    max-height: 85vh; overflow-y: auto;
  }

  /* é—œéµå­—æ¨™ç±¤ */
  .keyword-tag-input {
    display: flex; align-items: center; gap: 6px; background: #f5f5f7; border-radius: 16px;
    padding: 6px 12px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.04);
    border: 1px solid rgba(0, 0, 0, 0.08);
  }
  .keyword-tag-input input {
    border: none; background: transparent; outline: none; width: 80px; font-size: 13px;
  }
  .keyword-tag-input .remove-btn {
    cursor: pointer; color: #ff3b30; font-weight: bold; font-size: 16px;
  }

  .hidden { display: none !important; }

  /* è¡çªå°è©±æ¡† */
  .conflict-dialog {
    background: #ffffff;
    padding: 30px; border-radius: 24px; max-width: 480px; width: 90%;
    box-shadow: 0 20px 40px rgba(0,0,0,0.2); border: 1px solid rgba(0, 0, 0, 0.04);
  }
  .conflict-user-list {
    background: rgba(0,0,0,0.03); padding: 15px; border-radius: 12px; margin: 20px 0;
  }
  .conflict-user-item {
    display: flex; justify-content: space-between; align-items: center;
    padding: 8px 0; border-bottom: 1px solid rgba(0,0,0,0.05);
  }

  /* åœ“é¤…åœ– */
  .pie-chart {
    width: 280px; height: 280px; border-radius: 50%;
    background: conic-gradient(from 0deg,
      #4f46e5 0deg, #4f46e5 var(--angle1, 0deg),
      #06b6d4 var(--angle1, 0deg), #06b6d4 var(--angle2, 0deg),
      #10b981 var(--angle2, 0deg), #10b981 var(--angle3, 0deg),
      #f59e0b var(--angle3, 0deg), #f59e0b var(--angle4, 0deg),
      #ef4444 var(--angle4, 0deg), #ef4444 var(--angle5, 0deg),
      #8b5cf6 var(--angle5, 0deg), #8b5cf6 var(--angle6, 0deg),
      #f97316 var(--angle6, 0deg), #f97316 var(--angle7, 0deg),
      #84cc16 var(--angle7, 0deg), #84cc16 var(--angle8, 0deg),
      #ec4899 var(--angle8, 0deg), #ec4899 360deg);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08); position: relative;
    transition: all 0.4s ease; margin: 0 auto;
  }
  .pie-chart:hover { transform: scale(1.02); }
  .pie-chart::before {
    content: ''; position: absolute; top: 50%; left: 50%;
    width: 130px; height: 130px; background: #fff; border-radius: 50%;
    transform: translate(-50%, -50%); box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  }
  .pie-chart::after {
    content: 'ğŸ“Š\Aèª²ç¨‹åˆ†å¸ƒ'; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%, -50%); font-size: 13px; font-weight: 600;
    color: #1d1d1f; z-index: 1; text-align: center; white-space: pre; line-height: 1.4;
  }

  .donut-chart {
    position: relative; width: 120px; height: 120px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    background: conic-gradient(from 0deg,
      var(--color) 0deg, var(--color) var(--angle, 0deg),
      rgba(0, 0, 0, 0.06) var(--angle, 0deg), rgba(0, 0, 0, 0.06) 360deg);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.06);
  }
  .donut-chart::before {
    content: ''; position: absolute; width: 75px; height: 75px;
    background: white; border-radius: 50%; box-shadow: 0 1px 4px rgba(0, 0, 0, 0.04);
  }
  .donut-chart-label {
    position: absolute; font-size: 16px; font-weight: 600; color: #1d1d1f; z-index: 1;
  }

  .method-card {
    background: #ffffff;
    border-radius: 16px; padding: 28px 20px; text-align: center;
    transition: all 0.4s ease; border: 1px solid rgba(0, 0, 0, 0.04);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04), 0 1px 2px rgba(0, 0, 0, 0.06);
  }
  .method-card:hover { transform: translateY(-4px); box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05), 0 12px 32px rgba(0, 0, 0, 0.08); }
  </style>

  <script src="js/api.js"></script>
</head>
<body>
  <script src="js/auth.js"></script>
  <script>protectPage(['admin', 'teacher']);</script>

  <div class="container">
    <div class="header-nav">
      <a href="index.html" class="back-btn">â† é¦–é </a>
      <div class="page-title">
        <h1>æ™ºæ…§æ´¾èª²</h1>
        <p>Smart Course Assignment System</p>
      </div>
      <div style="width: 80px;"></div>
    </div>

    <div class="segmented-control">
      <button id="maritimeViewTab" class="segment-btn active" onclick="switchMaritimeTab('view')">èª²ç¨‹ç€è¦½</button>
      <button id="maritimeEditTab" class="segment-btn" onclick="switchMaritimeTab('edit')">èª²ç¨‹ç®¡ç†</button>
      <button id="maritimeStatsTab" class="segment-btn" onclick="switchMaritimeTab('stats')">çµ±è¨ˆåˆ†æ</button>
    </div>

    <!-- 1. èª²ç¨‹ç€è¦½é é¢ -->
    <div id="maritimeViewPage">
      <div class="glass-panel">
        <h2 style="font-size: 20px; font-weight: 600; margin-bottom: 20px;">ğŸ” èª²ç¨‹æœå°‹</h2>
        <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 16px;">
          <input type="text" id="maritimeSearchInput" placeholder="è¼¸å…¥èª²ç¨‹åç¨±æˆ–é—œéµå­—..." class="ios-input" oninput="displayMaritimeCourses()">
          <select id="maritimeCategoryFilter" class="ios-input" onchange="displayMaritimeCourses()">
            <option value="">æ‰€æœ‰åˆ†é¡</option>
            <option value="01">01 èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œ</option>
            <option value="02">02 é ˜å°çµ±å¾¡èˆ‡ç®¡ç†</option>
            <option value="03">03 äº‹æ•…æ¡ˆä¾‹åˆ†æ</option>
            <option value="04">04 èˆ¹èˆ¶è¨­å‚™æ“ä½œ</option>
            <option value="05">05 åœ‹éš›æ³•è¦çŸ¥è­˜</option>
            <option value="06">06 è²¨ç‰©è£å¸å¯¦å‹™</option>
            <option value="07">07 èˆ¹å“¡ç¶“é©—äº¤æµ</option>
            <option value="08">08 è·ç´šè½‰æ›èª¿é©</option>
            <option value="09">09 å…¶ä»–</option>
          </select>
        </div>
      </div>
      <div id="maritimeCourseResults" class="course-grid"></div>
    </div>

    <!-- 2. èª²ç¨‹ç®¡ç†é é¢ -->
    <div id="maritimeEditPage" class="hidden">
      <div class="glass-panel">
        <h2 style="font-size: 22px; font-weight: 700; margin-bottom: 24px;">æ–°å¢èª²ç¨‹</h2>
        <form id="maritimeCourseForm">
          <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 16px; margin-bottom: 16px;">
            <div>
              <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); margin-left: 4px; display: block; margin-bottom: 6px;">èª²ç¨‹åç¨±</label>
              <input type="text" id="maritimeCourseName" required class="ios-input" placeholder="è¼¸å…¥èª²ç¨‹åç¨±">
            </div>
            <div>
              <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); margin-left: 4px; display: block; margin-bottom: 6px;">åˆ†é¡</label>
              <select id="maritimeCourseCategory" required class="ios-input">
                <option value="">é¸æ“‡åˆ†é¡</option>
                <option value="01">01 èˆ¹èˆ¶æ“ç¸±</option>
                <option value="02">02 é ˜å°çµ±å¾¡</option>
                <option value="03">03 äº‹æ•…åˆ†æ</option>
                <option value="04">04 è¨­å‚™æ“ä½œ</option>
                <option value="05">05 æ³•è¦çŸ¥è­˜</option>
                <option value="06">06 è²¨ç‰©è£å¸</option>
                <option value="07">07 ç¶“é©—äº¤æµ</option>
                <option value="08">08 è·ç´šè½‰æ›</option>
                <option value="09">09 å…¶ä»–</option>
              </select>
            </div>
            <div>
              <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); margin-left: 4px; display: block; margin-bottom: 6px;">æˆèª²æ–¹å¼</label>
              <select id="maritimeCourseMethod" required class="ios-input">
                <option value="å¯¦é«”èª²ç¨‹">å¯¦é«”èª²ç¨‹</option>
                <option value="ç·šä¸Šèª²ç¨‹">ç·šä¸Šèª²ç¨‹</option>
                <option value="æ··åˆèª²ç¨‹">æ··åˆèª²ç¨‹</option>
              </select>
            </div>
          </div>
          <div style="margin-bottom: 16px;">
            <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); margin-left: 4px; display: block; margin-bottom: 6px;">èª²ç¨‹æè¿°</label>
            <textarea id="maritimeCourseDescription" rows="3" class="ios-input" style="resize: vertical;" placeholder="è¼¸å…¥èª²ç¨‹å¤§ç¶±..."></textarea>
          </div>
          <div style="margin-bottom: 24px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
              <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); margin-left: 4px;">é—œéµå­—æ¨™ç±¤</label>
              <button type="button" onclick="addMaritimeKeyword()" style="border: none; background: none; color: var(--apple-blue); font-size: 13px; font-weight: 600; cursor: pointer;">+ æ–°å¢é—œéµå­—</button>
            </div>
            <div id="maritimeKeywordList" style="display: flex; flex-wrap: wrap; gap: 8px; padding: 12px; background: rgba(255,255,255,0.5); border-radius: 12px; min-height: 50px;"></div>
          </div>
          <div style="display: flex; gap: 12px; justify-content: flex-end;">
            <button type="button" id="maritimeCancelEdit" class="secondary-btn">é‡ç½®</button>
            <button type="submit" class="primary-btn">å„²å­˜èª²ç¨‹</button>
          </div>
        </form>
      </div>

      <div class="glass-panel">
        <h2 style="font-size: 18px; font-weight: 600; margin-bottom: 16px;">å·²å»ºç«‹çš„èª²ç¨‹</h2>
        <input type="text" id="maritimeManageSearchInput" placeholder="æœå°‹èª²ç¨‹..." class="ios-input" style="margin-bottom: 20px;" oninput="displayManageMaritimeCourses()">
        <div id="maritimeManageCourseList" style="display: grid; gap: 12px;"></div>
      </div>
    </div>

    <!-- 3. çµ±è¨ˆåˆ†æé é¢ -->
    <div id="maritimeStatsPage" class="hidden">
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 24px;">
        <div class="stat-card">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">ç¸½èª²ç¨‹æ•¸</div>
          <div id="maritimeTotalCourses" style="font-size: 48px; font-weight: 700; margin: 10px 0;">0</div>
          <div style="font-size: 12px; opacity: 0.8;">æŒçºŒæˆé•·ä¸­</div>
        </div>
        <div class="stat-card purple">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">æœ€ç†±é–€åˆ†é¡</div>
          <div id="maritimePopularCategory" style="font-size: 20px; font-weight: 600; margin: 24px 0;">-</div>
        </div>
        <div class="stat-card green">
          <div style="font-size: 14px; opacity: 0.9; margin-bottom: 8px;">é—œéµå­—ç¸½æ•¸</div>
          <div id="maritimeTotalKeywords" style="font-size: 48px; font-weight: 700; margin: 10px 0;">0</div>
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 24px;">
        <div class="glass-panel">
          <h3 style="margin-bottom: 20px; font-size: 16px; font-weight: 600;">èª²ç¨‹åˆ†é¡åˆ†ä½ˆ</h3>
          <div id="maritimeCategoryStats"></div>
        </div>
        <div class="glass-panel">
          <h3 style="margin-bottom: 20px; font-size: 16px; font-weight: 600; text-align: center;">èª²ç¨‹åˆ†é¡åœ“é¤…åœ–</h3>
          <div id="maritimePieChart" class="pie-chart"></div>
          <div id="maritimeChartLegend" style="margin-top: 24px;"></div>
        </div>
      </div>

      <div class="glass-panel" style="margin-top: 24px;">
        <h3 style="margin-bottom: 20px; font-size: 16px; font-weight: 600;">æˆèª²æ–¹å¼çµ±è¨ˆ</h3>
        <div id="maritimeMethodStats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;"></div>
      </div>

      <!-- ç†±é–€é—œéµå­— -->
      <div class="glass-panel" style="margin-top: 24px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <h3 style="font-size: 16px; font-weight: 600; display: flex; align-items: center;">
            ğŸ”‘ ç†±é–€é—œéµå­—
          </h3>
        </div>
        <div id="maritimeKeywordsCloud" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
      </div>
    </div>
  </div>

  <!-- ç·¨è¼¯å½ˆçª— -->
  <div id="maritimeCourseModal" class="modal-backdrop" onclick="if(event.target === this) closeMaritimeCourseModal()">
    <div class="apple-modal">
      <h3 id="maritimeModalTitle" style="font-size: 24px; font-weight: 700; margin-bottom: 24px; text-align: center;">ç·¨è¼¯èª²ç¨‹</h3>

      <form id="maritimeCourseModalForm" onsubmit="saveMaritimeCourseFromModal(event)">
        <div style="margin-bottom: 16px;">
          <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); display: block; margin-bottom: 6px;">èª²ç¨‹åç¨±</label>
          <input type="text" id="maritimeCourseNameModal" required class="ios-input" placeholder="èª²ç¨‹åç¨±">
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 16px;">
          <div>
            <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); display: block; margin-bottom: 6px;">åˆ†é¡</label>
            <select id="maritimeCourseCategoryModal" required class="ios-input">
              <option value="01">01 èˆ¹èˆ¶æ“ç¸±</option>
              <option value="02">02 é ˜å°çµ±å¾¡</option>
              <option value="03">03 äº‹æ•…åˆ†æ</option>
              <option value="04">04 è¨­å‚™æ“ä½œ</option>
              <option value="05">05 æ³•è¦çŸ¥è­˜</option>
              <option value="06">06 è²¨ç‰©è£å¸</option>
              <option value="07">07 ç¶“é©—äº¤æµ</option>
              <option value="08">08 è·ç´šè½‰æ›</option>
              <option value="09">09 å…¶ä»–</option>
            </select>
          </div>
          <div>
            <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); display: block; margin-bottom: 6px;">æˆèª²æ–¹å¼</label>
            <select id="maritimeCourseMethodModal" required class="ios-input">
              <option value="å¯¦é«”èª²ç¨‹">å¯¦é«”èª²ç¨‹</option>
              <option value="ç·šä¸Šèª²ç¨‹">ç·šä¸Šèª²ç¨‹</option>
              <option value="æ··åˆèª²ç¨‹">æ··åˆèª²ç¨‹</option>
            </select>
          </div>
        </div>

        <div style="margin-bottom: 16px;">
          <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray); display: block; margin-bottom: 6px;">èª²ç¨‹æè¿°</label>
          <textarea id="maritimeCourseDescriptionModal" rows="3" class="ios-input" style="resize: vertical;" placeholder="èª²ç¨‹æè¿°"></textarea>
        </div>

        <div style="margin-bottom: 24px;">
          <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
            <label style="font-size: 12px; font-weight: 600; color: var(--apple-gray);">é—œéµå­—</label>
            <button type="button" onclick="addMaritimeKeywordModal()" style="border:none; background:none; color:var(--apple-blue); font-weight:600; font-size:12px; cursor:pointer;">+ æ–°å¢</button>
          </div>
          <div id="maritimeKeywordListModal" style="display: flex; flex-wrap: wrap; gap: 6px; min-height: 40px; background: rgba(0,0,0,0.03); padding: 8px; border-radius: 8px;"></div>
        </div>

        <div style="display: flex; gap: 12px;">
          <button type="button" onclick="deleteMaritimeCourseFromModal()" class="danger-btn">åˆªé™¤èª²ç¨‹</button>
          <div style="flex: 1;"></div>
          <button type="button" onclick="closeMaritimeCourseModal()" class="secondary-btn">å–æ¶ˆ</button>
          <button type="submit" class="primary-btn">å„²å­˜è®Šæ›´</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // ========== æµ·äº‹èª²ç¨‹ç³»çµ± ==========
    let maritimeCourses = [];
    let editingMaritimeCourseId = null;

    const maritimeCategoryNames = {
      '01': 'èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™',
      '02': 'é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°',
      '03': 'äº‹æ•…æ¡ˆä¾‹åˆ†æ',
      '04': 'èˆ¹èˆ¶è¨­å‚™æ“ä½œ',
      '05': 'åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒ',
      '06': 'è²¨ç‰©è£å¸ä½œæ¥­',
      '07': 'èˆ¹å“¡ç¶“é©—äº¤æµ',
      '08': 'è·ç´šè½‰æ›èª¿é©',
      '09': 'å…¶ä»–'
    };

    // åˆ‡æ›é é¢
    function switchMaritimeTab(tab) {
      document.getElementById('maritimeViewPage').classList.add('hidden');
      document.getElementById('maritimeEditPage').classList.add('hidden');
      document.getElementById('maritimeStatsPage').classList.add('hidden');

      document.querySelectorAll('.segment-btn').forEach(btn => btn.classList.remove('active'));

      if (tab === 'view') {
        document.getElementById('maritimeViewPage').classList.remove('hidden');
        document.getElementById('maritimeViewTab').classList.add('active');
        displayMaritimeCourses();
      } else if (tab === 'edit') {
        document.getElementById('maritimeEditPage').classList.remove('hidden');
        document.getElementById('maritimeEditTab').classList.add('active');
        displayManageMaritimeCourses();
      } else if (tab === 'stats') {
        document.getElementById('maritimeStatsPage').classList.remove('hidden');
        document.getElementById('maritimeStatsTab').classList.add('active');
        displayMaritimeStats();
      }
    }

    // åˆå§‹åŒ–
    async function initMaritimeCourseSystem() {
      // å…ˆç”¨æœ¬åœ°è³‡æ–™
      maritimeCourses = JSON.parse(localStorage.getItem('maritimeCourses') || '[]');
      displayMaritimeCourses();

      // å¾Œç«¯åŒæ­¥ï¼ˆèƒŒæ™¯ï¼‰
      if (typeof initializeDataSync !== 'undefined') {
        try {
          await initializeDataSync();
          maritimeCourses = JSON.parse(localStorage.getItem('maritimeCourses') || '[]');
          displayMaritimeCourses();
        } catch (err) {
          console.warn('âš ï¸ å¾Œç«¯åŒæ­¥å¤±æ•—ï¼Œä½¿ç”¨æœ¬åœ°è³‡æ–™:', err.message);
        }
      }

      // è¡¨å–®äº‹ä»¶
      document.getElementById('maritimeCourseForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        const course = {
          id: Date.now(),
          name: document.getElementById('maritimeCourseName').value,
          category: document.getElementById('maritimeCourseCategory').value,
          method: document.getElementById('maritimeCourseMethod').value,
          description: document.getElementById('maritimeCourseDescription').value,
          keywords: Array.from(document.querySelectorAll('#maritimeKeywordList input')).map(i => i.value.trim()).filter(v => v)
        };
        maritimeCourses.push(course);
        await saveMaritimeCourses();
        showMaritimeMessage('âœ… èª²ç¨‹æ–°å¢æˆåŠŸ', 'success');
        document.getElementById('maritimeCourseForm').reset();
        document.getElementById('maritimeKeywordList').innerHTML = '';
        addMaritimeKeyword();
        displayManageMaritimeCourses();
      });

      document.getElementById('maritimeCancelEdit').addEventListener('click', () => {
        document.getElementById('maritimeCourseForm').reset();
        document.getElementById('maritimeKeywordList').innerHTML = '';
        addMaritimeKeyword();
      });

      addMaritimeKeyword();
    }

    // é¡¯ç¤ºèª²ç¨‹åˆ—è¡¨ï¼ˆé—œéµå­—å„ªå…ˆæœå°‹ + é«˜äº®ï¼‰
    function displayMaritimeCourses() {
      const search = document.getElementById('maritimeSearchInput').value.toLowerCase();
      const catFilter = document.getElementById('maritimeCategoryFilter').value;
      const container = document.getElementById('maritimeCourseResults');

      let filteredCourses;
      let isKeywordMatch = false;

      if (search) {
        let keywordMatchedCourses = maritimeCourses.filter(course => {
          if (!course || typeof course.name !== 'string') return false;
          const matchesKeyword = Array.isArray(course.keywords)
            ? course.keywords.some(keyword => typeof keyword === 'string' && keyword.toLowerCase().includes(search))
            : false;
          const matchesCategory = !catFilter || course.category === catFilter;
          return matchesKeyword && matchesCategory;
        });

        if (keywordMatchedCourses.length > 0) {
          filteredCourses = keywordMatchedCourses;
          isKeywordMatch = true;
        } else {
          filteredCourses = maritimeCourses.filter(course => {
            if (!course || typeof course.name !== 'string') return false;
            const matchesSearch = course.name.toLowerCase().includes(search) ||
              (course.description && typeof course.description === 'string' ? course.description.toLowerCase().includes(search) : false);
            const matchesCategory = !catFilter || course.category === catFilter;
            return matchesSearch && matchesCategory;
          });
        }
      } else {
        filteredCourses = maritimeCourses.filter(course => {
          if (!course) return false;
          return !catFilter || course.category === catFilter;
        });
      }

      if (filteredCourses.length === 0) {
        container.innerHTML = '<div style="grid-column:1/-1; text-align:center; color:#86868b; padding:40px;">æ²’æœ‰æ‰¾åˆ°ç›¸é—œèª²ç¨‹</div>';
        return;
      }

      let html = '';
      if (isKeywordMatch && search) {
        html += `<div style="grid-column: 1 / -1; padding: 16px; background: linear-gradient(135deg, #e6f3ff 0%, #f0f5ff 100%); border-radius: 12px; margin-bottom: 16px; text-align: center; border: 1px solid #007aff30;">
          <span style="color: #007aff; font-weight: 600;">ğŸ·ï¸ æ‰¾åˆ° ${filteredCourses.length} å€‹ç¬¦åˆé—œéµå­—ã€Œ${search}ã€çš„èª²ç¨‹</span>
        </div>`;
      }

      html += filteredCourses.map(c => {
        let badgeColor = 'badge-blue';
        if (c.method === 'ç·šä¸Šèª²ç¨‹') badgeColor = 'badge-green';
        if (c.method === 'æ··åˆèª²ç¨‹') badgeColor = 'badge-orange';

        return `
          <div class="course-card" onclick="editMaritimeCourse(${c.id})">
            <div style="display:flex; justify-content:space-between; margin-bottom:16px;">
              <span class="badge ${badgeColor}">${c.method || 'æœªè¨­å®š'}</span>
              <span style="font-size:12px; color:#86868b;">${maritimeCategoryNames[c.category] || c.category}</span>
            </div>
            <div class="course-title" style="
              display: -webkit-box;
              -webkit-line-clamp: 2;
              -webkit-box-orient: vertical;
              overflow: hidden;
              text-overflow: ellipsis;
              line-height: 1.4;
              max-height: 2.8em;
            ">${highlightMaritimeText(c.name, search)}</div>
            <div style="
              font-size:14px;
              color:#86868b;
              margin-bottom:20px;
              line-height:1.6;
              display: -webkit-box;
              -webkit-line-clamp: 2;
              -webkit-box-orient: vertical;
              overflow: hidden;
              text-overflow: ellipsis;
              max-height: 3.2em;
            ">
              ${highlightMaritimeText(c.description || 'ç„¡æè¿°', search)}
            </div>
            <div style="
              display:flex;
              gap:6px;
              flex-wrap:wrap;
              max-height: 3.2em;
              overflow: hidden;
            ">
              ${(c.keywords || []).map(k =>
                `<span style="font-size:11px; padding:4px 10px; background:rgba(0,0,0,0.05); color:#86868b; border-radius:6px;">#${highlightMaritimeText(k, search)}</span>`
              ).join('')}
            </div>
          </div>
        `;
      }).join('');

      container.innerHTML = html;
    }

    function highlightMaritimeText(text, searchTerm) {
      if (!searchTerm) return text;
      const regex = new RegExp(`(${searchTerm})`, 'gi');
      return text.replace(regex, '<span class="highlight">$1</span>');
    }

    // é¡¯ç¤ºç®¡ç†åˆ—è¡¨
    function displayManageMaritimeCourses() {
      const search = document.getElementById('maritimeManageSearchInput').value.toLowerCase();
      const container = document.getElementById('maritimeManageCourseList');

      const filtered = maritimeCourses.filter(course => {
        if (!course || typeof course.name !== 'string') return false;
        const matchName = course.name.toLowerCase().includes(search);
        const matchDescription = course.description && typeof course.description === 'string'
          ? course.description.toLowerCase().includes(search) : false;
        const matchKeywords = Array.isArray(course.keywords)
          ? course.keywords.some(keyword => typeof keyword === 'string' && keyword.toLowerCase().includes(search)) : false;
        return matchName || matchDescription || matchKeywords;
      });

      if (filtered.length === 0) {
        container.innerHTML = '<div style="text-align: center; padding: 32px 0; color: #6e6e73;">æ²’æœ‰æ‰¾åˆ°èª²ç¨‹</div>';
        return;
      }

      container.innerHTML = filtered.map(c => `
        <div style="background:white; padding:16px; border-radius:12px; display:flex; justify-content:space-between; align-items:center; box-shadow:0 2px 5px rgba(0,0,0,0.05);">
          <div>
            <div style="font-weight:600; font-size:15px;">${c.name}</div>
            <div style="font-size:12px; color:#86868b;">${maritimeCategoryNames[c.category] || c.category}</div>
          </div>
          <button onclick="editMaritimeCourse(${c.id})" class="secondary-btn" style="padding:6px 16px; font-size:13px;">ç·¨è¼¯</button>
        </div>
      `).join('');
    }

    // æ–°å¢é—œéµå­—
    function addMaritimeKeyword(val = '') {
      createKeywordTag(document.getElementById('maritimeKeywordList'), val);
    }

    function addMaritimeKeywordModal(val = '') {
      createKeywordTag(document.getElementById('maritimeKeywordListModal'), val);
    }

    function createKeywordTag(container, val) {
      const div = document.createElement('div');
      div.className = 'keyword-tag-input';
      div.innerHTML = `
        <input type="text" value="${val}" placeholder="é—œéµå­—">
        <span class="remove-btn" onclick="this.parentElement.remove()">Ã—</span>
      `;
      container.appendChild(div);
    }

    // ç·¨è¼¯èª²ç¨‹
    function editMaritimeCourse(id) {
      editingMaritimeCourseId = id;
      const c = maritimeCourses.find(x => x.id === id);
      if (!c) return;

      document.getElementById('maritimeCourseNameModal').value = c.name;
      document.getElementById('maritimeCourseCategoryModal').value = c.category;
      document.getElementById('maritimeCourseMethodModal').value = c.method;
      document.getElementById('maritimeCourseDescriptionModal').value = c.description;

      const list = document.getElementById('maritimeKeywordListModal');
      list.innerHTML = '';
      if (c.keywords && c.keywords.length > 0) {
        c.keywords.forEach(k => addMaritimeKeywordModal(k));
      } else {
        addMaritimeKeywordModal();
      }

      document.getElementById('maritimeCourseModal').classList.add('show');
    }

    function closeMaritimeCourseModal() {
      document.getElementById('maritimeCourseModal').classList.remove('show');
      editingMaritimeCourseId = null;
    }

    async function saveMaritimeCourseFromModal(e) {
      e.preventDefault();
      const newData = {
        name: document.getElementById('maritimeCourseNameModal').value,
        category: document.getElementById('maritimeCourseCategoryModal').value,
        method: document.getElementById('maritimeCourseMethodModal').value,
        description: document.getElementById('maritimeCourseDescriptionModal').value,
        keywords: Array.from(document.querySelectorAll('#maritimeKeywordListModal input')).map(i => i.value.trim()).filter(v => v)
      };

      const idx = maritimeCourses.findIndex(x => x.id === editingMaritimeCourseId);
      if (idx >= 0) {
        maritimeCourses[idx] = { ...maritimeCourses[idx], ...newData };
        await saveMaritimeCourses();
        showMaritimeMessage('âœ… èª²ç¨‹æ›´æ–°æˆåŠŸ', 'success');
        closeMaritimeCourseModal();
        displayMaritimeCourses();
        displayManageMaritimeCourses();
      }
    }

    async function deleteMaritimeCourseFromModal() {
      if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹èª²ç¨‹å—ï¼Ÿ')) {
        maritimeCourses = maritimeCourses.filter(x => x.id !== editingMaritimeCourseId);
        await saveMaritimeCourses();
        showMaritimeMessage('âœ… èª²ç¨‹å·²åˆªé™¤', 'success');
        closeMaritimeCourseModal();
        displayMaritimeCourses();
        displayManageMaritimeCourses();
      }
    }

    // å„²å­˜ï¼ˆå«è¡çªæª¢æŸ¥ï¼‰
    async function saveMaritimeCourses() {
      localStorage.setItem('maritimeCourses', JSON.stringify(maritimeCourses));

      if (typeof syncManager !== 'undefined') {
        syncManager.markAsChanged();
        const result = await syncManager.saveToBackendSafe();
        if (result.conflict) {
          showConflictDialog(result);
        }
      } else if (typeof api !== 'undefined') {
        await api.save('maritimeCourses', maritimeCourses);
      }
    }

    // çµ±è¨ˆåˆ†æ - ä½¿ç”¨å›ºå®šæ¼”ç¤ºæ•¸æ“š
    function displayMaritimeStats() {
      // å›ºå®šçš„çµ±è¨ˆæ•¸æ“š
      const demoStats = {
        totalCourses: 5,
        totalKeywords: 57,
        popularCategory: '04èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´',
        categories: {
          '01': { name: 'èˆ¹èˆ¶æ“ç¸±èˆ‡èˆªè¡Œå¯¦å‹™è¨“ç·´', count: 0, color: '#4f46e5' },
          '02': { name: 'é ˜å°çµ±å¾¡èˆ‡æª¢æŸ¥æ‡‰å°ç®¡ç†', count: 0, color: '#06b6d4' },
          '03': { name: 'äº‹æ•…æ¡ˆä¾‹åˆ†æèˆ‡æ‡‰è®Šè™•ç½®è¨“ç·´', count: 0, color: '#10b981' },
          '04': { name: 'èˆ¹èˆ¶è¨­å‚™æ“ä½œèˆ‡æŠ€è¡“çŸ¥èƒ½è¨“ç·´', count: 3, color: '#f59e0b' },
          '05': { name: 'åœ‹éš›æ³•è¦èˆ‡ç’°å¢ƒåˆè¦çŸ¥è­˜', count: 2, color: '#ef4444' },
          '06': { name: 'èˆ¹èˆ¶è²¨ç‰©è£å¸ä½œæ¥­å¯¦å‹™', count: 0, color: '#8b5cf6' },
          '07': { name: 'èˆ¹å“¡ç¶“é©—äº¤æµèˆ‡è·èƒ½å›é¥‹', count: 0, color: '#f97316' },
          '08': { name: 'è·ç´šè½‰æ›èˆ‡å£“åŠ›èª¿é©', count: 0, color: '#84cc16' },
          '09': { name: 'å…¶ä»–', count: 0, color: '#ec4899' }
        },
        methods: {
          'æ··åˆèª²ç¨‹': { count: 5, percentage: 100.0 }
        }
      };

      // é ‚éƒ¨çµ±è¨ˆå¡ç‰‡
      document.getElementById('maritimeTotalCourses').innerText = demoStats.totalCourses;
      document.getElementById('maritimeTotalKeywords').innerText = demoStats.totalKeywords;
      document.getElementById('maritimePopularCategory').innerText = demoStats.popularCategory;

      // åˆ†é¡çµ±è¨ˆ - æ¢ç‹€åœ–
      const catHtml = Object.keys(demoStats.categories).map(code => {
        const cat = demoStats.categories[code];
        const percentage = (cat.count / demoStats.totalCourses) * 100;
        return `
          <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
            <div style="font-size:12px; width:140px; color: #1d1d1f;">${code} ${cat.name}</div>
            <div style="flex:1; background:#e5e5ea; height:8px; border-radius:4px; overflow: hidden;">
              <div style="width:${percentage}%; background:${cat.color}; height:100%; border-radius:4px; transition: width 0.3s;"></div>
            </div>
            <div style="font-size:13px; font-weight:600; width:30px; text-align:right;">${cat.count}</div>
          </div>
        `;
      }).join('');
      document.getElementById('maritimeCategoryStats').innerHTML = catHtml;

      // åœ“é¤…åœ–è§’åº¦è¨ˆç®— (åªé¡¯ç¤ºæœ‰èª²ç¨‹çš„åˆ†é¡)
      const activeCategories = Object.keys(demoStats.categories).filter(code => demoStats.categories[code].count > 0);
      let currentAngle = 0;
      const pieChart = document.getElementById('maritimePieChart');

      activeCategories.forEach((code, index) => {
        const cat = demoStats.categories[code];
        const percentage = (cat.count / demoStats.totalCourses) * 360;
        currentAngle += percentage;
        pieChart.style.setProperty(`--angle${parseInt(code)}`, `${currentAngle}deg`);
      });

      // åœ“é¤…åœ–åœ–ä¾‹
      const legend = document.getElementById('maritimeChartLegend');
      legend.innerHTML = activeCategories.map(code => {
        const cat = demoStats.categories[code];
        const percentage = ((cat.count / demoStats.totalCourses) * 100).toFixed(1);
        return `
          <div style="display: flex; align-items: center; gap: 10px; padding: 8px; border-radius: 8px; transition: background 0.2s;">
            <div style="width: 14px; height: 14px; border-radius: 50%; background: ${cat.color}; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.12);"></div>
            <div style="flex: 1; font-size: 13px;">${cat.name}</div>
            <div style="font-size: 12px; color: #86868b;">${cat.count} é–€èª²ç¨‹ (${percentage}%)</div>
          </div>
        `;
      }).join('');

      // æˆèª²æ–¹å¼çµ±è¨ˆ
      const methodColors = { å¯¦é«”èª²ç¨‹: '#3b82f6', ç·šä¸Šèª²ç¨‹: '#10b981', æ··åˆèª²ç¨‹: '#f59e0b', æœªè¨­å®š: '#6b7280' };
      const methodIcons = { å¯¦é«”èª²ç¨‹: 'ğŸ«', ç·šä¸Šèª²ç¨‹: 'ğŸ’»', æ··åˆèª²ç¨‹: 'ğŸ”„', æœªè¨­å®š: 'â“' };

      document.getElementById('maritimeMethodStats').innerHTML = Object.entries(demoStats.methods).map(([method, data]) => {
        const angle = (data.count / demoStats.totalCourses) * 360;
        return `
          <div class="method-card">
            <div class="donut-chart" style="--color: ${methodColors[method]}; --angle: ${angle}deg; margin: 0 auto 16px;">
              <div class="donut-chart-label">${data.count}</div>
            </div>
            <div style="font-size: 32px; margin-bottom: 8px;">${methodIcons[method]}</div>
            <h4 style="font-weight: 600; color: #1d1d1f; margin-bottom: 4px;">${method}</h4>
            <p style="font-size: 13px; color: #6e6e73;">${data.percentage}% çš„èª²ç¨‹</p>
            <p style="font-size: 12px; color: #86868b; margin-top: 4px;">å…± ${data.count} é–€èª²ç¨‹</p>
          </div>
        `;
      }).join('');

      // ç†±é–€é—œéµå­—
      const keywords = [
        { text: 'CO2é‹¼ç“¶', count: 2 },
        { text: 'Black out', count: 2 },
        { text: 'BVS', count: 2 },
        { text: 'æ°£è±¡å°èˆª', count: 2 },
        { text: 'è·¨æ´‹', count: 2 },
        { text: 'PFOS', count: 1 },
        { text: 'BWM', count: 1 },
        { text: 'OWS', count: 1 },
        { text: 'å£“è‰™æ°´', count: 1 },
        { text: 'å£“è‰™æ°´', count: 1 },
        { text: 'CC', count: 1 },
        { text: 'æ³¡æ²«æ»…ç«å™¨', count: 1 },
        { text: 'æ¶²ä½è¨ˆ', count: 1 },
        { text: 'å‰©é¤˜é¢¨éšª', count: 1 },
        { text: 'Residue risk', count: 1 },
        { text: 'Condition of Class', count: 1 },
        { text: 'æ£˜', count: 1 },
        { text: 'BWMS', count: 1 },
        { text: 'é›»å­ç´€éŒ„ç°¿', count: 1 }
      ];

      document.getElementById('maritimeKeywordsCloud').innerHTML = keywords.map(kw => `
        <div style="
          background: linear-gradient(135deg, #007aff 0%, #0051d5 100%);
          color: white;
          padding: 10px 16px;
          border-radius: 12px;
          font-size: 14px;
          font-weight: 500;
          cursor: pointer;
          box-shadow: 0 2px 8px rgba(0, 122, 255, 0.3);
          transition: all 0.2s ease;
          display: flex;
          align-items: center;
          gap: 8px;
        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 12px rgba(0, 122, 255, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 2px 8px rgba(0, 122, 255, 0.3)'">
          <span>${kw.text}</span>
          <span style="
            background: rgba(255, 255, 255, 0.25);
            padding: 2px 8px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
          ">${kw.count}</span>
        </div>
      `).join('');
    }

    // è¨Šæ¯æç¤º
    function showMaritimeMessage(message, type = 'info') {
      const div = document.createElement('div');
      div.style.cssText = `
        position: fixed; top: 20px; right: 20px; padding: 16px 24px; border-radius: 12px;
        color: white; z-index: 10000; font-size: 14px; font-weight: 600;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15); animation: slideIn 0.3s ease;
        background: ${type === 'success' ? 'linear-gradient(135deg, #34c759 0%, #248a3d 100%)' : 'linear-gradient(135deg, #007aff 0%, #0051d5 100%)'};
      `;
      div.textContent = message;
      document.body.appendChild(div);

      setTimeout(() => {
        div.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => div.remove(), 300);
      }, 3000);
    }

    // è¡çªå°è©±æ¡†
    function showConflictDialog(result) {
      const div = document.createElement('div');
      div.className = 'modal-backdrop show';
      div.innerHTML = `
        <div class="conflict-dialog">
          <h2 style="margin: 0 0 10px 0; font-size: 20px; color: #ff9500;">âš ï¸ è³‡æ–™è¡çªè­¦å‘Š</h2>
          <p style="color: #374151; margin: 10px 0;">${result.message || 'å¾Œç«¯æœ‰è¼ƒæ–°çš„è³‡æ–™'}</p>
          ${result.activeSessions && result.activeSessions.length > 0 ? `
            <div class="conflict-user-list">
              <p style="font-size: 12px; color: gray; margin-bottom: 5px;">ç·šä¸Šä½¿ç”¨è€…ï¼š</p>
              ${result.activeSessions.map(s => `
                <div class="conflict-user-item">
                  <div style="font-size: 13px; font-weight: 600;">${s.userName || 'è¨ªå®¢'}</div>
                  <button onclick="kickUser('${s.sessionId}', '${s.userName}')" style="border: none; background: #ff3b30; color: white; padding: 4px 10px; border-radius: 12px; font-size: 12px; cursor: pointer;">è¸¢å‡º</button>
                </div>
              `).join('')}
            </div>` : ''}
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button onclick="this.closest('.modal-backdrop').remove()" class="secondary-btn">ç¨å¾Œè™•ç†</button>
            <button onclick="window.location.reload()" class="primary-btn">é‡æ–°æ•´ç†</button>
          </div>
        </div>
      `;
      document.body.appendChild(div);
    }

    async function kickUser(sid, name) {
      if(confirm(`ç¢ºå®šè¸¢å‡º ${name}?`)) {
        try {
          await sessionManager.kickUser(sid);
          showMaritimeMessage('âœ… å·²è¸¢å‡ºä½¿ç”¨è€…', 'success');
        } catch(e) {
          showMaritimeMessage('âŒ è¸¢å‡ºå¤±æ•—', 'error');
        }
      }
    }

    // å‹•ç•«
    const style = document.createElement('style');
    style.textContent = `
      @keyframes slideIn {
        from { opacity: 0; transform: translateX(100px); }
        to { opacity: 1; transform: translateX(0); }
      }
      @keyframes slideOut {
        from { opacity: 1; transform: translateX(0); }
        to { opacity: 0; transform: translateX(100px); }
      }
    `;
    document.head.appendChild(style);

    window.addEventListener('DOMContentLoaded', initMaritimeCourseSystem);
  </script>
</body>
</html>
